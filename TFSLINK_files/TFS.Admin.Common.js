//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d};define(["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/Resources/TFS.Resources.Admin","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.Host.UI","Presentation/Scripts/TFS/TFS.UI.Controls.Grids","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.UI.Controls.Menus","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.UI.Controls.Data"],function(K,e,g,d,b,F,I,D,f,i,q,C,k,J,h,j,E){var a=J.domElem,x=k.TfsContext.getDefault().configuration,m=k.TfsContext,y=k.TfsContext.getDefault(),c=d.delegate,H=0;e.EmptyGuidString="00000000-0000-0000-0000-000000000000";$("body").addClass("resizeTarget");$(window).bind("resize",function(){$("body").triggerHandler("resize")});$.widget("TFS.AutoTextArea",{_create:function(){this.element.bind("keyup scroll",c(this,this.resize));this.element.bind("blur",c(this,this._onBlur));this.resize()},resize:function(){var a=this.element.outerHeight()-this.element.innerHeight();this.element.height(this.element[0].scrollHeight+a)},_onBlur:function(){d.delay(this,100,function(){this.element.height(0);this.resize()})}});$.widget("TFS.HorizontalPanel",{_create:function(){var d=this,c,b,a;this.controlId=++H;this.element.closest(".resizeTarget").bind("resize."+this.controlId,function(){d._updateLayout()});for(b=0;b<this.options.panels.length;b++){a=this.options.panels[b];if(this.options.useExisting)a.panelElement=this.element.children("#"+a.id);else{c='<div class="layoutPanelHorizontal" />';a.panelElement=$(c).appendTo(this.element);a.id&&a.panelElement.attr("id",a.id)}}this._updateLayout()},destroy:function(){this.element.closest(".resizeTarget").unbind("resize."+this.controlId);$.Widget.prototype.destroy.apply(this,arguments)},_getPanelSize:function(a){return a.size?{type:a.size.indexOf("%")!==a.size.length-1?"fixed":"variable",size:parseInt(a.size,10)}:a.maxsize?{type:"variable",size:parseInt(a.maxsize,10),isMaxSize:true}:{type:"auto",size:a.panelElement.outerHeight(true)}},_updateLayout:function(){var c,b,a,d;c=this.element.height();for(b=0;b<this.options.panels.length;b++){a=this.options.panels[b];a.panelSize=this._getPanelSize(a);if(a.panelSize.type==="fixed"){a.panelElement.height(a.panelSize.size);c-=a.panelSize.size}else if(a.panelSize.type==="auto")c-=a.panelSize.size}for(b=0;b<this.options.panels.length;b++){a=this.options.panels[b];if(a.panelSize.type==="variable"){a.panelElement.css("height","");d=Math.min(c,a.panelSize.size*c/100);if(a.panelSize.isMaxSize)d=Math.min(d,a.panelElement.outerHeight(true));a.panelElement.height(d)}}}});$.widget("TFS.IdentityInput",{options:{filterList:true,searchHotkey:{altKey:false,ctrlKey:true,which:75},searchParams:{},getItemFromIdentity:function(a){return{text:a.DisplayName||a.SubHeader,value:a.TeamFoundationId,data:a}},allowFreeType:true,_sequenceId:0},addItem:function(a,b){this.options._dropdownControl.add({text:a,value:b})},removeItem:function(a){this.options._dropdownControl._removeItem(null,{value:a});this._inputElement.val("")},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.element.empty()},focus:function(a){d.delay(this,$.browser.msie?50:0,function(){if(this.element.data("TFS-Dropdown"))if(a)this.element.data("TFS-Dropdown").options._elements._input.Watermark("focus");else this.element.data("TFS-Dropdown").options._elements._input.focus()})},getCurrentValue:function(){return this.element.find(".dropdown-input-name").val()},select:function(c,b){var a=this.element.data("TFS-Dropdown");return a.select(c,b)},disable:function(){$.Widget.prototype.disable.apply(this,arguments);this._inputElement.attr("disabled","disabled")},enable:function(){$.Widget.prototype.enable.apply(this,arguments);this._inputElement.attr("disabled",null)},getInputElement:function(){return this._inputElement},_create:function(){this.element.bind("filterItem",this,function(b,a){if(b.data.options.existingIdentities)a.deny=d.ArrayUtils.contains(b.data.options.existingIdentities,a.item.value)});this.options._dropdownControl=this.element.Dropdown(this.options).data("TFS-Dropdown");this.element.bind("querySearch",this,function(a,b){a.data._querySearch(a,b)});this._inputElement=this.element.find(".dropdown-input-name");this._inputElement.bind("keydown",this,function(a){if(a.keyCode===$.ui.keyCode.ENTER){var b=$(this).val();if(b){a.data.options._dropdownControl.hideList(true);a.data.element.trigger("newItemAdded",{text:b});a.preventDefault();a.stopPropagation()}}});this.options.inputControlId&&this._inputElement.attr("id",this.options.inputControlId);this.element.bind("newItemAdded itemSelected",this,function(a){a.data.options._dropdownControl.cancelSearch()});$(".dropdown-input-list",this.element).mousedown(this,function(a){a.data._inputElement.focus();return false});this.element.bind("focusout",this,function(a){d.delay(a.data,100,function(){$(document.activeElement).closest(this.element).length===0&&this.options._dropdownControl.cancelSearch()})})},_init:function(){var a,b,c;this.options._sequenceId++;this.options._dropdownControl.cancelSearch();this.options._dropdownControl.clear();if(this.options.items){this.options._dropdownControl.options.dynamicSearch=false;a=[];for(b=0;b<this.options.items.length;b++){c=this.options.items[b];a.push(this.options.getItemFromIdentity(c))}this._disambiguate(a);this.options._dropdownControl.add(a)}else this.options._dropdownControl.options.dynamicSearch=true;this.options._dropdownControl._updateStateIcon()},_disambiguate:function(i){for(var a,c,e,h=false,g,f=0;f<i.length;f++){a=i[f];c=i[f+1];e=c&&a.text.toLowerCase()===c.text.toLowerCase();if(e||h){if(a.data.IsProjectLevel&&(e&&a.data.SubHeader.toLowerCase()===c.data.SubHeader.toLowerCase()||h&&g&&a.data.SubHeader.toLowerCase()===g.data.SubHeader.toLowerCase()))a.text=d.StringUtils.format("{0} <{1}> <{2}>",a.text,a.data.SubHeader,b.Project);else a.text=d.StringUtils.format("{0} <{1}>",a.text,a.data.SubHeader);h=e;g=a}}},_querySearch:function(d,c){var a=this,b=++this.options._sequenceId;i.logTracePoint("TFS.IdentityInput.SearchPending");h.getMSJSON(a.options.identityListAction,$.extend({searchQuery:c.value},a.options.searchParams),function(f){if(b===a.options._sequenceId&&a.options._dropdownControl.options._searchActive){for(var e,c=[],d=0;d<f.identities.length;d++){e=f.identities[d];c.push(a.options.getItemFromIdentity(e))}a._disambiguate(c);a.options._dropdownControl.add(c);a.options._dropdownControl.completeSearch()}},null,{tracePoint:"TFS.IdentityInput.SearchComplete"})}});function G(b){var c=$(a("div"));function e(c,e,f){var d,b;d=$(a("ul")).appendTo(e).addClass("dialog-errors");for(b=0;b<c.length;b++)f?$(a("li")).appendTo(d).html(c[b]):$(a("li")).appendTo(d).text(c[b])}function d(c,f){var e,b,d;e=$(a("ul")).appendTo(f).addClass("dialog-errors");for(b=0;b<c.length;b++){d=c[b];$(a("li")).appendTo(e).text(d.Errors[0])}}b.GeneralErrors.length>0&&e(b.GeneralErrors,c,false);b.LicenceErrors&&b.LicenceErrors.length>0&&e(b.LicenceErrors,c,true);b.FailedAddedIdentities.length>0&&d(b.FailedAddedIdentities,c);b.FailedDeletedIdentities.length>0&&d(b.FailedDeletedIdentities,c);return c}e.parseErrors=G;$.widget("TFS.IdentitySearchControl",{options:{identityList:{},searchParams:{},watermarkText:b.Search},_init:function(){var d=this,e=function(a){return function(b){if(b.keyCode===$.ui.keyCode.ENTER||b.keyCode===$.ui.keyCode.SPACE){a();return false}}};this.options.identityList._options.searchControl=this;this.element.addClass("identity-search-control");this.searchLabel=$(a("label")).addClass("hidden").attr("for","identitySearchBox").text(b.SearchIdentities);this.searchInput=$('<input class="search-input" type="text" />').attr("name","identitySearchBox");$(a("div")).addClass("search-input-wrapper").append(this.searchLabel).append(this.searchInput).appendTo(this.element);this.searchInput.Watermark({watermarkText:this.options.watermarkText});this.cancelButton=$(a("span")).addClass("cancel-button").appendTo(this.element).attr("tabindex","0").hide().click(c(this,this._onCancelButton)).keydown(e(c(this,this._onCancelButton)));this.searchButton=$(a("span")).addClass("search-button").appendTo(this.element).attr("tabindex","0").click(c(this,this._onSearchButton)).keydown(e(c(this,this._onSearchButton)));this.goButton=$(a("span")).addClass("go-button").appendTo(this.element).hide().click(c(this,this._onGoButton)).keydown(e(c(this,this._onGoButton)));if(!this.options.identityList._initialized){this.disable();this.options.identityList._element.bind("initialized",function(){d.enable();i.logTracePoint("IdentitySearchControl._init.complete")})}else i.logTracePoint("IdentitySearchControl._init.complete");this.searchInput.keydown(function(a){var b;if(a.keyCode===$.ui.keyCode.ESCAPE&&d.options.identityList._options.isSearching){d.cancelSearch();a.preventDefault();a.stopPropagation()}else if(a.keyCode===$.ui.keyCode.ENTER){if(d.options.identityList.hasMore){b=$(this).val();if(b.length>0)d.fullSearch(b);else d.cancelSearch()}a.preventDefault();a.stopPropagation()}});this.searchInput.bind("keyup",function(b){var a;if(b.keyCode!==$.ui.keyCode.ESCAPE&&b.keyCode!==$.ui.keyCode.ENTER){a=$(this).val();if(d.options.lastSearchQuery!==a){d.options.lastSearchQuery=a;d.filterSearchResults()}}})},fullSearch:function(b){var a=this;this.disable();this.showCancelButton();this.element.trigger("searchQueryChanged",b);h.getMSJSON(a.options.identityList._options.identityListAction,$.extend({searchQuery:b},a.options.identityList._options.searchParams),function(b){a.options.identityList.fullSearch(b.identities);a.fullSearchCallback()},null,{wait:a.options.identityList._options.waitObject})},fullSearchCallback:function(){this.enable();this.searchInput.focus()},filterSearchResults:function(){if(this.options.lastSearchQuery&&this.options.lastSearchQuery.length>0)if(this.options.identityList.hasMore)this.showGoButton();else{this.showCancelButton();this.options.identityList.localSearch(this.options.lastSearchQuery);this.element.trigger("searchQueryChanged",this.options.lastSearchQuery)}else this.cancelSearch()},disable:function(){$.Widget.prototype.disable.apply(this,arguments);this.searchInput.attr("disabled","disabled")},enable:function(){$.Widget.prototype.enable.apply(this,arguments);this.searchInput.attr("disabled",null)},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.element.empty()},showSearchButton:function(){this.searchButton.show();this.cancelButton.hide();this.goButton.hide()},showCancelButton:function(){this.options.identityList._options.isSearching=true;this.searchButton.hide();this.cancelButton.show();this.goButton.hide()},showGoButton:function(){this.searchButton.hide();this.cancelButton.hide();this.goButton.show()},cancelSearch:function(){this.options.identityList._options.isSearching=false;this.searchInput.val("");this.options.lastSearchQuery="";this.cancelButton.is(":visible")&&this.options.identityList.cancelSearch();this.element.trigger("searchQueryCancelled");this.showSearchButton();this.focus()},focus:function(){this.searchInput.Watermark("focus")},_onSearchButton:function(){!this.options.disabled&&this.searchInput.focus()},_onCancelButton:function(){if(!this.options.disabled){this.cancelSearch();this.searchInput.focus()}},_onGoButton:function(){var a=jQuery.Event("keydown");a.keyCode=$.ui.keyCode.ENTER;this.searchInput.trigger(a)}});var l=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({autoResize:true},a))};a.prototype.initialize=function(){b.prototype.initialize.call(this);this.redraw();this._options.autoResize&&this._element.closest(".resizeTarget").bind("resize."+this._getId(),c(this,this.redraw))};a.prototype.redraw=function(){var c=0,b=0,a;this._header=this._element.children(".fixed-header");this._footer=this._element.children(".fixed-footer");this._content=this._element.children(".fill-content");a=this._element.css("position");a!=="relative"&&a!=="absolute"&&this._element.css("position","relative");if(this._header.length)c=this._header.outerHeight(true);if(this._footer.length){b=this._footer.outerHeight(true);this._footer.css({position:"absolute",right:0,bottom:0,left:0})}this._content.css({position:"absolute",top:c,right:0,bottom:b,left:0,overflow:"auto"})};a._typeName="tfs.admin.VerticalFillLayout";return a}(f.BaseControl);e.VerticalFillLayout=l;g.initClassPrototype(l,{_header:null,_footer:null,_content:null});f.Enhancement.registerEnhancement(l,".vertical-fill-layout");var z=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initialize=function(){c.prototype.initialize.call(this);this._infoMessage=$(a("div")).addClass("identity-info-message").appendTo($(".grid-canvas",this._element))};b.prototype.checkForNoData=function(b){if(this._dataSource.length===0){this._infoMessage.show().empty();$(a("span")).appendTo(this._infoMessage).text(b)}else this._infoMessage.hide()};b.prototype.getSelectedItem=function(){return this._dataSource[this._selectedIndex]};b._typeName="tfs.admin.AdminGrid";return b}(D.Grid);e.AdminGrid=z;g.initClassPrototype(z,{_infoMessage:null});var p=function(f){__extends(e,f);function e(a){f.call(this,a)}e.prototype.initializeOptions=function(a){f.prototype.initializeOptions.call(this,$.extend({allowMultiSelect:false,gutter:false,cssClass:"identity-grid",sharedMeasurements:false,source:[]},a))};e.prototype.initialize=function(){f.prototype.initialize.call(this);this._options.waitObject={image:x.getResourcesFile("big-progress.gif"),message:d.StringUtils.htmlEncode(b.ProgressPleaseWait),target:this._options.host};this.populate()};e.prototype.populate=function(){i.logTracePoint("IdentityGrid.IdentityListAction.Pending");h.getMSJSON(this._options.identityListAction,this._options.searchParams,c(this,this._completeInitialize),null,{tracePoint:"IdentityGrid.IdentityListAction.Complete",wait:this._options.waitObject})};e.prototype._completeInitialize=function(a){for(var d=[],e,c=0;c<a.identities.length;c++){e=a.identities[c];d[c]=[e]}this._options.source=d;this._originalData=d;this.hasMore=a.hasMore;this.totalIdentityCount=a.totalIdentityCount;this.initializeDataSource();this.getSelectedRowIntoView();this.checkForNoData(b.NoIdentitiesFound);this._element.trigger("initialized")};e.prototype.setSelectedRowIndex=function(a){f.prototype.setSelectedRowIndex.call(this,a);this.getSelectedRowIntoView()};e.prototype.fullSearch=function(c){for(var d=[],a=0;a<c.length;a++)d.push([c[a]]);this._options.source=d;this.initializeDataSource();this.checkForNoData(b.NoIdentitiesMatchSearch)};e.prototype.localSearch=function(f){for(var a,e=[],d,c=0;c<this._originalData.length;c++){a=this._originalData[c][0];d=[a.FriendlyDisplayName,a.SubHeader];d.join("\n").toLocaleLowerCase().indexOf(f.toLocaleLowerCase())>-1&&e.push([a])}this._options.source=e;this.initializeDataSource();this.checkForNoData(b.NoIdentitiesMatchSearch)};e.prototype.cancelSearch=function(){this._options.source=this._originalData;this.initializeDataSource();this.checkForNoData(b.NoIdentitiesFound)};e.prototype.cacheRows=function(e,d,c){if(this.hasMore&&this._dataSource.length>0&&c.length===0&&!this._options.isSearching){var a=this,b;b=this._dataSource[this._dataSource.length-1][0];this.hasMore=false;this._options.searchControl.disable();h.getMSJSON(this._options.identityListAction,$.extend({lastSearchResult:b.DisplayName},this._options.searchParams),function(c){for(var d=[],b=0;b<c.identities.length;b++)d[b]=[c.identities[b]];a._originalData=a._originalData.concat(d);a._options.source=a._originalData;a._resetScroll=false;a.initializeDataSource();a._resetScroll=true;a.hasMore=c.hasMore;a._options.searchControl.enable()},null,{wait:a._options.waitObject})}};e.prototype._createIdentityCell=function(j,g,h,k,e,i,f){var c,b;b=this.getColumnValue(g,0,f);c=$(a("div")).addClass("grid-cell identity-cell");c.width(e.width||20);I.identityImageElement(y,b.TeamFoundationId).addClass("identity-image").appendTo(c).attr("alt",d.StringUtils.format(F.ImageOf,b.DisplayName));$(a("span")).appendTo(c).addClass("identity-name").text(b.FriendlyDisplayName);e.maxLength=Math.max(e.maxLength||0,b.FriendlyDisplayName.length+4);if(b.IdentityType==="user"&&b.SubHeader)c.attr("title",b.SubHeader);else c.attr("title",b.DisplayName);e.rowCss&&c.addClass(e.rowCss);return c};e.prototype._updateRow=function(a,b,d,c,e){f.prototype._updateRow.call(this,a,b,d,c,e);if(this._dataSource[b][0].isRemoved)a.row.addClass("removed-identity");else a.row.removeClass("removed-identity")};e._typeName="tfs.admin.identitygrid";return e}(z);e.IdentityGrid=p;g.initClassPrototype(p,{hasMore:false,_originalData:null,totalIdentityCount:0});var A=function(e){__extends(c,e);function c(a){e.call(this,a)}c.prototype.initializeOptions=function(a){e.prototype.initializeOptions.call(this,$.extend({allowMoveColumns:false},a))};c.prototype.onDeleteKey=function(a){if(a&&a.rowInfo&&a.rowInfo.row&&a.event&&a.event.altKey===false&&a.event.ctrlKey===false&&a.event.shiftKey===false){var b=a.rowInfo.row.find(".remove-identity-link");if(b.length>0){b.click();return false}}};c.prototype.onEnterKey=function(a){if(a&&a.rowInfo&&a.rowInfo.row){var c=a.rowInfo.row.find(".add-identity-link"),b=a.rowInfo.row.find(".remove-identity-link");if(c.length>0){c.click();return false}else if(b.length>0){b.click();return false}}};c.prototype.onRowDoubleClick=function(b){if(b&&b.rowInfo){var a=this._dataSource[b.rowInfo.dataIndex][0];a&&(a.IdentityType==="group"||a.IdentityType==="team")&&!a.IsAadGroup&&!a.IsWindowsGroup&&this._element.trigger("open-group-details",a)}};c.prototype._completeInitialize=function(c){var f;f=[{text:b.DisplayName,width:200,headerCss:"identity-grid-display-name",getCellContents:this._createIdentityCell,canSortBy:!c.hasMore,comparer:function(f,g,c,e){var a=c[0],b=e[0];return d.StringUtils.localeIgnoreCaseComparer(a.FriendlyDisplayName,b.FriendlyDisplayName)}},{text:b.UsernameOrScope,width:200,getColumnValue:function(b,d,a){var c=this.getColumnValue(b,0,a);return c.SubHeader},canSortBy:!c.hasMore,comparer:function(f,g,c,e){var a=c[0],b=e[0];return d.StringUtils.localeIgnoreCaseComparer(a.SubHeader,b.SubHeader)}},{text:"",width:100,canSortBy:false,getCellContents:function(l,i,j,m,f,k,h){var d,e,g,c;d=$(a("div")).addClass("grid-cell");d.width(f.width||20);e=this.getColumnValue(i,0,h);g=$(a("div"));c=$(a("span")).appendTo(g);if(!this._options.preventEdit)if(e.isRemoved)if(e.inProgress)c.text(b.UndoInProgress);else $(a("a")).appendTo(c).addClass("add-identity-link").text(b.Undo).click(function(a){$(a.target).trigger("add-identity-event")});else if(e.inProgress)c.text(b.RemoveInProgress);else $(a("a")).appendTo(c).addClass("remove-identity-link").text(b.RemoveAction).click(function(a){$(a.target).trigger("remove-identity-event")});f.maxLength=Math.max(f.maxLength||0,c.text().length+4);d.html(g);d.addClass("manage-membership-action-cell");return d}}];this._options.columns=f;e.prototype._completeInitialize.call(this,c)};c._typeName="tfs.admin.membershipidentitygrid";return c}(p);e.MembershipIdentityGrid=A;var v=function(m){__extends(g,m);function g(a){m.call(this,a)}g.prototype._onMenuItemClick=function(b){var a=this._getCommandName(b);switch(a){case"add-members":this._checkAddPermission(c(this,function(){q.menuManager.executeCommand(new Sys.CommandEventArgs("add-members-dialog",{saveCallback:c(this,this._saveIdentitiesCallback),isTeam:this._options.isTeam,tfsContext:this._options.tfsContext},null))}));return false;case"add-groups":this._checkAddPermission(c(this,function(){q.menuManager.executeCommand(new Sys.CommandEventArgs("add-groups-dialog",{saveCallback:c(this,this._saveIdentitiesCallback),joinGroupTfid:this._options.joinToGroupTfid,showAllGroupsIfCollection:this._options.showAllGroupsIfCollection,tfsContext:this._options.tfsContext},null))}));return false;case"join-group":q.menuManager.executeCommand(new Sys.CommandEventArgs("join-group-dialog",{saveCallback:c(this,this._saveIdentitiesCallback)},null));return false;case"refresh":this.refreshIdentityGrid();return false;case"search":this._showSearchBox();return false}};g.prototype._getCommandName=function(a){return a.get_commandName()};g.prototype._getActionItems=function(){var a=[],f=[],c,d,e;if(this._options.editMembers){if(this._options.tfsContext.isHosted)c={id:"add-members",noIcon:true,text:b.AddMembers};else c={id:"add-members",noIcon:true,text:b.AddWindowsMembers};d={id:"add-groups",noIcon:true,text:k.TfsContext.getDefault().isHosted?b.AddTfsGroupHosted:b.AddTfsGroup};if(this._options.preventAdd){c.disabled=true;d.disabled=true;c.title=this._options.restrictionReason;d.title=this._options.restrictionReason}f.push(c);f.push(d);a.push({id:"manage-actions",idIsAction:false,text:b.AddMenuItem,noIcon:true,childItems:f})}else{e={id:"join-group",noIcon:true,text:b.JoinGroup};if(this._options.preventJoin){e.disabled=true;e.title=this._options.restrictionReason}a.push(e)}a.push({separator:true});a.push({id:"refresh",text:b.Refresh,showText:false,icon:"icon-refresh"});if(this._options.includeSearch!==false){a.push({separator:true});a.push({id:"search",noIcon:true,text:b.Search})}return a};g.prototype.initialize=function(){var b=this;m.prototype.initialize.call(this);this._setupActionUrls();var d;this._element.addClass("vertical-fill-layout");this._verticalFillLayout=f.Enhancement.ensureEnhancement(l,this._element);d=$(a("div")).addClass("membership-control-header fixed-header").appendTo(this._element);this._errorPane=f.BaseControl.createIn(C.MessageAreaControl,d);this._errorPane._element.bind(C.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){b._verticalFillLayout.redraw()});this._setupActions(d);this._gridContainer=$(a("div")).addClass("manage-membership-grid fill-content").appendTo(this._element).bind("initialized",c(this,this._fireMemberCountChangedEvent)).bind("initialized",c(this,this._gridInitialized));this._prepareInitialize();this._notificationPane=$(a("div")).appendTo(this._element).addClass("fixed-footer manage-membership-notifications");$(a("div")).appendTo(this._notificationPane).addClass("icon icon-delete").css("float","right").css("cursor","pointer").click(function(){b._closeNotification()}).hide();this._notificationContent=$(a("span")).html("&nbsp;").appendTo(this._notificationPane);this._verticalFillLayout.redraw();this._notificationPane.hide();this._element.bind("add-identity-event remove-identity-event",function(d){var a,c;a=b._options.identityGrid.getSelectedRowIndex();i.assert(a!==-1,"selected index is -1");c=b._options.identityGrid._dataSource[a][0];b._removeIdentity(c.TeamFoundationId,a,d.type==="add-identity-event")});this.refreshIdentityGrid()};g.prototype.setFocus=function(){this._menuBar&&this._menuBar.activate()};g.prototype.refreshIdentityGrid=function(){if(this._options.identityGrid){$.extend(this._options.identityGrid._options,this._options.gridOptions);this._options.identityGrid.populate()}else{this._options.identityGrid=f.Enhancement.enhance(A,this._gridContainer,this._options.gridOptions);this._identitySearchControl=this._searchControl.IdentitySearchControl({identityList:this._options.identityGrid,watermarkText:b.FindMembers}).data("TFS-IdentitySearchControl")}};g.prototype._setupActionUrls=function(){if(!this._options.actionUrls)this._options.actionUrls={canAddMemberToGroup:this._options.tfsContext.getActionUrl("CanAddMemberToGroup","identity",{area:"api"}),readGroupMembers:this._options.tfsContext.getActionUrl("ReadGroupMembers","identity",{area:"api"}),editMembership:this._options.tfsContext.getActionUrl("EditMembership","identity",{area:"api"}),addIdentities:this._options.tfsContext.getActionUrl("AddIdentities","identity",{area:"api"})}};g.prototype._checkAddPermission=function(a){var c=this;if(this._options.joinToGroupTfid||this._options.customGroupId)h.getMSJSON(this._options.actionUrls.canAddMemberToGroup,{groupId:this._options.joinToGroupTfid||this._options.customGroupId},function(d){if(d.canEdit)a();else c._errorPane.setMessage(b.MissingAddPermission,2)});else a()};g.prototype._setupActions=function(d){var b=$(a("div")).appendTo(d).addClass("membership-control-actions toolbar");this._menuBar=f.BaseControl.createIn(q.MenuBar,b,{items:this._getActionItems(),executeAction:c(this,this._onMenuItemClick),showIcon:true});this._searchControl=$(a("div")).appendTo(b).addClass("identity-grid-search").css("display","inline-block").hide();return b};g.prototype._prepareInitialize=function(){var a=this._prepareActionParams();this._options.gridOptions={identityListAction:a.actionUrl,searchParams:a.params,preventEdit:this._options.editMembers&&this._options.preventAdd||!this._options.editMembers&&this._options.preventJoin,host:this._element}};g.prototype._prepareActionParams=function(){return{actionUrl:this._options.actionUrls.readGroupMembers,params:{scope:this._options.joinToGroupTfid||this._options.customGroupId,readMembers:this._options.editMembers}}};g.prototype._showSearchBox=function(){this._menuBar.getItem("search").hideElement();this._searchControl.show();this._identitySearchControl.focus()};g.prototype._prepareRemoveIdentity=function(){return{actionUrl:this._options.actionUrls.editMembership,params:{groupId:this._options.joinToGroupTfid||this._options.customGroupId}}};g.prototype._removeIdentity=function(d,c,g){var a=this,k=this._prepareRemoveIdentity(),f=k.params,i;f.editMembers=this._options.editMembers;if(g)f.addItemsJson=j.stringifyMSJSON([d]);else f.removeItemsJson=j.stringifyMSJSON([d]);i=this._options.identityGrid._dataSource[c][0];i.inProgress=true;this._options.identityGrid.updateRow(c);h.postMSJSON(k.actionUrl,f,function(i){var j,h,f;if(i.HasErrors){j=e.parseErrors(i);if(a._options.editMembers)a._errorPane.setError({header:b.ErrorRemoving,content:j},null);else a._errorPane.setError({header:b.ErrorLeaving,content:j},null)}a._membersModified=true;if(a._options.identityGrid._dataSource[c][0].TeamFoundationId!==d){c=null;for(f=0;f<a._options.identityGrid._dataSource.length;f++)if(a._options.identityGrid._dataSource[f][0].TeamFoundationId===d){c=f;break}}if(c!==null){h=a._options.identityGrid._dataSource[c][0];if(!i.HasErrors){h.isRemoved=!g;if(g)a._options.identityGrid.totalIdentityCount++;else a._options.identityGrid.totalIdentityCount--}h.inProgress=false;a._options.identityGrid.updateRow(c)}a._fire("member-removed");a._fireMemberCountChangedEvent()},null,{tracePoint:"EditMembership.RemoveIdentity.Done"})};g.prototype._fireMemberCountChangedEvent=function(){this._fire("member-count-changed",{TeamFoundationId:this._options.joinToGroupTfid,MemberCount:this._options.identityGrid.totalIdentityCount})};g.prototype._gridInitialized=function(){this._options.setInitialFocus&&this.setFocus()};g.prototype._setNotification=function(b,a){this._notificationContent.text(b);this._notificationPane.slideDown();if(a===undefined)a=6e3;a>0&&this.delayExecute("setNotification",a,true,function(){this._notificationPane.slideUp()})};g.prototype._closeNotification=function(){this.cancelDelayedFunction("setNotification");this._notificationPane.slideUp()};g.prototype._prepareSaveIdentities=function(a){var b;a.existingUsers=$.map(a.existingUsers,function(a){return a.tfid});if(this._options.editMembers)b={newUsersJson:j.stringifyMSJSON(a.newUsers),existingUsersJson:j.stringifyMSJSON(a.existingUsers),groupsToJoinJson:j.stringifyMSJSON([this._options.joinToGroupTfid||this._options.customGroupId])};else b={newUsersJson:j.stringifyMSJSON(a.newUsers),existingUsersJson:j.stringifyMSJSON([this._options.joinToGroupTfid||this._options.customGroupId]),groupsToJoinJson:j.stringifyMSJSON(a.existingUsers)};return{actionUrl:this._options.actionUrls.addIdentities,params:b}};g.prototype._saveIdentitiesCallback=function(g){var a=this,f=this._prepareSaveIdentities(g),c=this;this._requestContext=h.postMSJSON(f.actionUrl,f.params,function(f){var i,g,h;if(f.HasErrors){i=e.parseErrors(f);if(a._options.editMembers)g=f.FailedAddedIdentities.length===1?b.ErrorAddingOne:d.StringUtils.format(b.ErrorAdding,f.FailedAddedIdentities.length);else g=f.FailedAddedIdentities.length===1?b.ErrorJoiningOne:d.StringUtils.format(b.ErrorJoining,f.FailedAddedIdentities.length);a._errorPane.setError({header:g,content:i},null)}if(f.AddedIdentities.length>0){d.delay(c,1e3,function(){if(c._options.editMembers)h=f.AddedIdentities.length===1?b.SuccessAddingOne:d.StringUtils.format(b.SuccessAdding,f.AddedIdentities.length);else h=f.AddedIdentities.length===1?b.SuccessJoiningOne:d.StringUtils.format(b.SuccessJoining,f.AddedIdentities.length);c._setNotification(h)});a._fire("member-added")}a._menuBar.activate();a.refreshIdentityGrid()},null,{tracePoint:"AddIdentityDialog.SaveChanges.Success",wait:{image:x.getResourcesFile("big-progress.gif"),message:d.StringUtils.htmlEncode(b.ProgressPleaseWait),target:this._element}})};g._typeName="tfs.admin.membershipcontrol";return g}(f.BaseControl);e.MembershipControl=v;g.initClassPrototype(v,{_menuBar:null,_verticalFillLayout:null,_identitySearchControl:null,_errorPane:null,_searchControl:null,_gridContainer:null,_notificationPane:null,_membersModified:false,_requestContext:null,_notificationContent:null});g.classExtend(v,m.ControlExtensions);var B=function(c){__extends(a,c);function a(a){c.call(this,a)}a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({header:false,delayWindowsGroups:false},a))};a.prototype.initialize=function(){this._options.columns=[{text:"",width:"100%",canSortBy:false,getCellContents:this._createIdentityCell,getColumnValue:function(c,d,b){var a=this.getColumnValue(c,0,b);return a.TeamFoundationId?a.FriendlyDisplayName:a}}];c.prototype.initialize.call(this)};a.prototype.initializeDataSource=function(e){var a,b,d=this._options.identityToSelect;if(this._options.isTeam&&!this._options.isSearching)this._populateSourceForTeams();else this._populateSourceWithBuckets();if(d)for(a=0;a<this._options.source.length;a++){b=this._options.source[a][0];if(b.TeamFoundationId===d){this._selectedIndex=a;break}}else if(!e)for(a=0;a<this._options.source.length;a++){b=this._options.source[a][0];if(b.TeamFoundationId){this._selectedIndex=a;break}}this._options.keepSelection=true;c.prototype.initializeDataSource.call(this)};a.prototype.expandNode=function(d){var a=this,b=this._dataSource[d],g=b.hasMore,f=b.actionUrl,e=b.actionParams;if(g){b.hasMore=false;h.getMSJSON(f,e,function(c){a.hasMore=c.hasMore;for(var d=[],b=0;b<c.identities.length;b++)d[b]=[c.identities[b]];a._originalData=a._originalData.concat(d);a._options.source=a._originalData;a.initializeDataSource(true)})}c.prototype.expandNode.call(this,d)};a.prototype.cacheRows=function(b,a,d){this._options.canPage&&c.prototype.cacheRows.call(this,b,a,d)};a.prototype.getCurrentIdentity=function(){var a=this.getSelectedDataIndex();return a>-1&&a<this._dataSource.length?this._dataSource[a][0]:null};a.prototype.selectedIndexChanged=function(b,a){if(b>-1&&this._dataSource.length>a){this._fire("identitySelected",this._dataSource[a][0]);i.logTracePoint("IdentityGrid.SelectedIndexChanged")}else this._fire("identitySelected",null)};a.prototype._createIdentityCell=function(f,a,b,h,g,e,d){var i,j;j=this._dataSource[a][0];if(j.TeamFoundationId)return this._dataSource[a].isNode?this._drawCell(f,a,b,h,g,e,d):c.prototype._createIdentityCell.call(this,f,a,b,h,g,e,d);else{i=this._drawCell(f,a,b,h,g,e,d);this._dataSource[a].isEmpty&&i.addClass("empty-cell");return i}};a.prototype._populateSourceForTeams=function(){var f,e,d=[],a=[],h,g,c;if(this._options.source.length>0){e=this._options.source[0][0];c=[e];c.isNode=true;if(this.hasMore&&this._options.source.length===1){d[a.length]=-1;c.hasMore=true;c.actionUrl=this._options.tfsContext.getActionUrl("ReadScopedTeamJson","identity",{area:"api"});c.actionParams={force:true};a.push(c);d[a.length]=0;h=[b.LoadingInProgress];h.isEmpty=true;a.push(h);this._options.canPage=false}else{a.push(c);if(this._options.source.length>1){d[0]=this._options.source.length-1;for(f=1;f<this._options.source.length;f++){e=this._options.source[f][0];a.push([e])}}else{d[0]=1;d[1]=0;g=[b.NoMembers];g.isEmpty=true;a.push(g)}this._options.canPage=true}}this._options.source=a;this._options.expandStates=d};a.prototype._populateSourceWithBuckets=function(){var h,e,f=[],d=[],i=0,l,c,a,g,j;a={tfsTeams:{name:b.Teams,items:[]},tfsGroups:{name:k.TfsContext.getDefault().isHosted?b.TfsGroupsHosted:b.TfsGroupsHosted,items:[]},windowsGroups:{name:b.WindowsGroups,items:[],hasMore:this._options.delayWindowsGroups&&!this._options.isSearching&&this.hasMore,actionUrl:this._options.tfsContext.getActionUrl("ReadIdentitiesPageJson","identity",{area:"api"}),actionParams:{membershipType:"windowsGroups"}},users:{name:b.Users,items:[],hasMore:this._options.delayUsers&&!this._options.isSearching&&this.hasMore,actionUrl:this._options.tfsContext.getActionUrl("ReadIdentitiesPageJson","identity",{area:"api"}),actionParams:{membershipType:"users"}}};for(h=0;h<this._options.source.length;h++){e=this._options.source[h][0];if(e.IdentityType==="user"){a.users.items.push([e]);a.users.hasMore=false}else if(e.IsWindowsGroup){a.windowsGroups.items.push([e]);a.windowsGroups.hasMore=false}else if(e.IdentityType==="team")a.tfsTeams.items.push([e]);else a.tfsGroups.items.push([e])}this._options.canPage=this._options.delayWindowsGroups||this._options.delayUsers;for(l in a)if(a.hasOwnProperty(l)){c=a[l];if(c.hasMore){i+=2;f[d.length]=-1;g=[c.name];g.hasMore=true;g.actionUrl=c.actionUrl;g.actionParams=c.actionParams;d.push(g);f[d.length]=0;j=[b.LoadingInProgress];j.isEmpty=true;d.push(j);this._options.canPage=false}else if(c.items.length){i++;f[d.length]=c.items.length;c.items.unshift([c.name]);d=d.concat(c.items)}}if(i===1){d.shift();f=null}this._options.source=d;this._options.expandStates=f};a._typeName="tfs.admin.mainidentitygrid";return a}(p);e.MainIdentityGrid=B;g.classExtend(B,m.ControlExtensions);var o=function(d){__extends(b,d);function b(a){d.call(this,a)}b.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({allowRemove:true},a))};b.prototype.initialize=function(){d.prototype.initialize.call(this);this._membersList=$(a("div")).attr("id","members-list").appendTo(this._element)};b.prototype.addIdentity=function(c,f,e,g,h){var b,d;if(e){b=$(a("div")).addClass("resolved-member existing-user");d=$(a("span")).appendTo(b).addClass("resolved-member-name").text(c);this._drawRemoveElement(b);$('<input type="hidden" />').appendTo(b).addClass("tfid").val(e)}else{b=$(a("div")).addClass("resolved-member new-user");d=$(a("span")).appendTo(b).addClass("resolved-member-name").text(c);this._drawRemoveElement(b);$('<input type="hidden" />').appendTo(b).addClass("username").val(f)}b.attr("title",g||c);h&&b.hide();this._membersList.append(b);this._fire("identityListChanged")};b.prototype.hideRemoveElement=function(){};b.prototype.clear=function(){for(var b=this.getTfids(),a=0;a<b.length;a++)this.removeIdentity(b[a]);this.quickClear()};b.prototype.quickClear=function(){this._membersList.empty()};b.prototype.getTfids=function(){var a=[];$("input.tfid",this._membersList).each(function(){a.push($(this).val())});return a};b.prototype._onItemRemoved=function(e){var a,d,c,b;a=$(e.target).closest(".resolved-member");d=a.find("input.tfid").val();c=a.find(".resolved-member-name").text();if($.isFunction(this._options.beforeRemove)){b=this._options.beforeRemove.call(this,{tfid:d,name:c});if(b===false)return}this._removeIdentity(a);return false};b.prototype.removeIdentity=function(b){var a=this._membersList.find('input[value="'+b+'"]').closest(".resolved-member");a.length&&this._removeIdentity(a)};b.prototype.getDisplayNames=function(){var a=[];this._membersList.find(".resolved-member-name").each(function(){a.push($(this).text())});return a};b.prototype.getPendingChanges=function(c){var b=[],a=[];$("input.username",this._membersList).each(function(){b.push(this.value)});$("input.tfid",this._membersList).each(function(e,b){if($(this).closest(".existing-user").length>0)if(c){var d={tfid:this.value,name:$(b).closest(".existing-user").find(".resolved-member-name").text()};a.push(d)}else a.push(this.value)});return{newUsers:b,existingUsers:a}};b.prototype._drawRemoveElement=function(b){$(a("div")).appendTo(b).addClass("icon icon-delete").attr("id","remove-action").click(c(this,this._onItemRemoved)).accessible()};b.prototype._removeIdentity=function(a){var b,c=a.find("input.tfid").val();if(c)b=a.find(".resolved-member-name").text();else b=a.find("input.username").val();a.remove();this._element.trigger("identityListChanged",{name:b,tfid:c})};b._controlType="tfs.admin.identityListControl";return b}(f.BaseControl);e.IdentityListControl=o;g.initClassPrototype(o,{_membersList:null});var u=function(c){__extends(a,c);function a(a){c.call(this,a);this.existingGroups=a.existingGroups||[];this.host=a.host;this.currentCheckedItem=undefined;if(a.multiSelect===undefined||a.multiSelect)this.multiSelect=true;else this.multiSelect=false}a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({allowMultiSelect:false,gutter:false,sharedMeasurements:false,columns:[{text:b.DisplayName,width:250},{text:b.UserName,width:150}]},a))};a.prototype.initialize=function(){var a=this;c.prototype.initialize.call(this);this._pendingAdds=[];this._pendingDeletes=[];this._originalDataIntitialized=false;this._originalData=[];this._identityInfoMap=[];this.host=this._options.host;this.existingGroups=this._options.existingGroups||[];this.hasMore=false;this._options.waitObject={image:x.getResourcesFile("big-progress.gif"),message:d.StringUtils.htmlEncode(b.ProgressPleaseWait),target:this._options.host};if(this._options.gridItems){a.setInitialGridItems(a._options.gridItems);a._element.trigger("initialized");i.logTracePoint("CheckedIdentityGrid.initialize.complete")}else h.getMSJSON(this._options.identityListAction,this._options.searchParams,function(b){a.hasMore=b.hasMore;a.setInitialGridItems(b.identities);a._element.trigger("initialized")},null,{tracePoint:"CheckedIdentityGrid.initialize.complete",wait:this._options.waitObject})};a.prototype.setInitialGridItems=function(b){var c,a,e,f=[],g=[],h=0;if(!b)b=$.map(this._dataSource,function(a){return{FriendlyDisplayName:a[1],TeamFoundationId:a[3],SubHeader:a[2]}});for(c=0;c<b.length;c++){a=b[c];if(this._options.omitWindowsGroups&&a.IsWindowsGroup)continue;e=d.ArrayUtils.contains(this.existingGroups,a.TeamFoundationId);e&&f.push(h);g.push({id:h++,values:[a.FriendlyDisplayName,a.SubHeader,a.TeamFoundationId,e]})}this.setGridItems(g,f);if(!this._originalDataIntitialized){this._originalData=this._dataSource;this._originalDataIntitialized=true}};a.prototype.setGridItems=function(b,a){c.prototype.setGridItems.call(this,b,a);this.setSelectedRowIndex(this.getSelectedRowIndex())};a.prototype.addToGridItems=function(h){for(var b,e,f=[],g=[],i=this._dataSource.length,c,a=0;a<this._dataSource.length;a++){c=this._dataSource[a];c[0]&&f.push(a);c.splice(0,1);g.push({id:a,values:c})}for(a=0;a<h.length;a++){b=h[a];if(this._options.omitWindowsGroups&&b.IsWindowsGroup)continue;e=d.ArrayUtils.contains(this.existingGroups,b.TeamFoundationId);e&&f.push(i+a);g.push({id:i+a,values:[b.FriendlyDisplayName,b.SubHeader,b.TeamFoundationId,e]})}this.setGridItems(g,f);this._originalData=this._dataSource};a.prototype.fullSearch=function(f){for(var a,c,g=[],e=[],b=0;b<f.length;b++){a=f[b];c=d.ArrayUtils.contains(this.existingGroups,a.TeamFoundationId);if(c&&!d.ArrayUtils.contains(this._pendingDeletes,a.TeamFoundationId))e.push(b);else d.ArrayUtils.contains(this._pendingAdds,a.TeamFoundationId)&&e.push(b);g.push({id:b,values:[a.FriendlyDisplayName,a.SubHeader,a.TeamFoundationId,c]})}this.setGridItems(g,e)};a.prototype.localSearch=function(f){var b,a,e=[],d=[],c;c=$(this._originalData);for(b=0;b<c.length;b++){a=c[b];if(a.slice(1,3).join("\n").toLocaleLowerCase().indexOf(f.toLocaleLowerCase())>-1){e.push({id:a[-1],values:a.slice(1)});a[0]&&d.push(a[-1])}}this.setGridItems(e,d)};a.prototype.cancelSearch=function(){var b,a,f,g=[],c=[],e;e=$(this._originalData);for(b=0;b<e.length;b++){a=e[b];g.push({id:a[-1],values:a.slice(1)});if(this.hasMore){f=a[4];if(f&&!d.ArrayUtils.contains(this._pendingDeletes,a[3]))c.push(b);else d.ArrayUtils.contains(this._pendingAdds,a[3])&&c.push(b)}else a[0]&&c.push(a[-1])}this.setGridItems(g,c)};a.prototype.cacheRows=function(e,d,c){if(this.hasMore&&c.length===0&&!this._options.isSearching){var a=this,b;b=this._dataSource[this._dataSource.length-1][1];this.hasMore=false;this._options.searchControl.disable();h.getMSJSON(this._options.identityListAction,$.extend({lastSearchResult:b},this._options.searchParams),function(b){a.addToGridItems(b.identities);a.hasMore=b.hasMore;a._options.searchControl.enable()},null,{wait:this._options.waitObject})}};a.prototype.setCheckboxState=function(b,e){var d=false,a;if(!this.multiSelect){if(this.currentCheckedItem&&this._dataSource[b]!==this.currentCheckedItem){this._pendingAdds=[];for(a=0;a<this._dataSource.length;a++)if(this.currentCheckedItem[-1]===this._dataSource[a][-1]&&a!==b){c.prototype.setCheckboxState.call(this,a,false);d=true;break}if(!d&&!this.hasMore)this._originalData[this.currentCheckedItem[-1]][0]=false}if(e)this.currentCheckedItem=this._dataSource[b];else this.currentCheckedItem=undefined}c.prototype.setCheckboxState.call(this,b,e)};a.prototype._drawHeaderCellValue=function(a){return a.index!==E.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX?c.prototype._drawHeaderCellValue.call(this,a):$("<div/>").addClass("title")};a.prototype._setCheckboxStateData=function(g,h){var b,a,f,d,e;c.prototype._setCheckboxStateData.call(this,g,h);b=this._dataSource[g];if(!this.hasMore)this._originalData[b[-1]][0]=h;f=b[4];d=b[0];a=b[3];if(!this._identityInfoMap[a])this._identityInfoMap[a]=b[1];if(d&&!f)this._pendingAdds.push(a);else if(!d&&f)this._pendingDeletes.push(a);else if(d&&f){e=$.inArray(a,this._pendingDeletes);e>-1&&this._pendingDeletes.splice(e,1)}else if(!d&&!f){e=$.inArray(a,this._pendingAdds);e>-1&&this._pendingAdds.splice(e,1)}this.updateRow(g);this._fire("checkedStateChanged",{tfid:a,name:b[1],state:d});this._fire("pendingChanged",{pendingAdds:this._pendingAdds,pendingDeletes:this._pendingDeletes,totalCheckedCount:this.existingGroups.length-this._pendingDeletes.length+this._pendingAdds.length})};a._typeName="tfs.admin.checkedidentitygrid";return a}(D.CheckboxSelectionGrid);e.CheckedIdentityGrid=u;g.initClassPrototype(u,{currentCheckedItem:null,multiSelect:false,hasMore:null,existingGroups:null,host:null,_pendingAdds:null,_pendingDeletes:null,_originalData:null,_identityInfoMap:null});var s=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initialize=function(){c.prototype.initialize.call(this);var g,e,b,d;g=$(a("div")).appendTo(this._element).addClass("identity-browse-search-wrapper fixed-header");e=$(a("div")).appendTo(g).addClass("identity-browse-search");b=$(a("div")).appendTo(this._element).addClass("fill-content");d=$.extend({height:"100%",host:b},this._options);this._identityGrid=f.BaseControl.createIn(u,b,d);e.IdentitySearchControl({identityList:this._identityGrid});this.setFocusOnSearchBox();f.Enhancement.enhance(l,this._element,{autoResize:this._options.autoResize});this._identityGrid.layout()};b.prototype.getIdentityGrid=function(){return this._identityGrid};b.prototype.setCheckedIdentities=function(a){this._identityGrid.existingGroups=a||[];this._identityGrid.setInitialGridItems();this._identityGrid.getSelectedRowIntoView(true)};b.prototype.setFocusOnSearchBox=function(){var a=$(".identity-browse-search",this._element);a.IdentitySearchControl("focus")};b._controlType="tfs.admin.BrowseIdentitiesControl";return b}(f.BaseControl);e.BrowseIdentitiesControl=s;g.initClassPrototype(s,{_identityGrid:null});var t=function(g){__extends(e,g);function e(){g.apply(this,arguments)}e.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({identityListAction:y.getActionUrl("ReadIdentitiesPageJson","identity",{area:"api"}),searchParams:{membershipType:"addableUsers"},allowMultiSelect:true,showCheckName:true,allowCheckName:true,allowFreeType:true,allowArbitraryEmailAddresses:true,constrainToTfsUsersOnly:false,comboOnly:false,onListRetrieved:null,onReady:null,filterList:true,isHosted:k.TfsContext.getDefault().isHosted,watermarkTo:null},a))};e.prototype.initialize=function(){var d=this,e,f=this;g.prototype.initialize.call(this);this._element.addClass("identity-picker-control");this._mainControl=$(a("div")).appendTo(this._element).addClass("identity-picker-main");this._createIdentityListControl();this._identityInputWrapper=$(a("div")).appendTo(this._mainControl).addClass("identity-input-wrapper").keyup(function(a){if(!d._identityInputControl.option("disabled")&&a.keyCode!==$.ui.keyCode.ENTER)d._validate(d._identityInputControl._inputElement.val())&&d._identityListControl._fire("identityListChanged")});$('<div class="identity-input" />').appendTo(this._identityInputWrapper);this._actionDiv=$(a("div")).appendTo(this._mainControl).addClass("add-identities-actions-section actions-section");this._actionUl=$(a("ul")).appendTo(this._actionDiv);e=$(a("li")).appendTo(this._actionUl);$(a("a")).appendTo(e).attr("id","browse-identities-action").addClass("linkAction").attr("href","#").text(b.Browse).click(c(this,this._onBrowseOpen));e=$(a("li")).appendTo(this._actionUl);this._checkNameAction=$(a("a")).appendTo(e).attr("id","check-name-action").attr("href","#").addClass("linkAction").text(b.CheckName).click(c(this,this._onCheckName));this._options.items&&$.each(this._options.items,function(e,b){var c=$(a("li")).appendTo(d._actionUl);$(a("a")).appendTo(c).attr("id",b.id).attr("href","#").addClass("linkAction").text(b.text).click(function(){d._options.executeAction&&d._options.executeAction(b.id);return false})});this._identityInputError=$(a("div")).appendTo(this._mainControl).addClass("identity-input-error").hide();if(this._options.showBrowse!==false){this._browsePopup=$(a("div")).appendTo(this._element).attr("tabindex","0").addClass("browse-identities-popup").hide().click(function(a){a.preventDefault();a.stopPropagation()}).keydown(function(a){if(a.keyCode===$.ui.keyCode.ESCAPE){f._onBrowseClose();return false}return true});this._browseContent=$(a("div")).appendTo(this._browsePopup).addClass("browse-identities-content");$(a("a")).appendTo(this._browsePopup).addClass("linkAction browse-identities-popup-close").attr("href","#").text(b.Close).click(c(this,this._onBrowseClose))}$(this._element).bind("itemSelected",c(this,this._onItemSelected));$(this._element).bind("newItemAdded",c(this,this._onNewItemAdded));$(this._element).bind("checkedStateChanged",c(this,this._onCheckedStateChanged));$(this._element).bind("identityListChanged",c(this,this._onIdentityListChanged));!this._options.delayInit&&this.initializeIdentityList()};e.prototype.getDefaultInput=function(){return this._identityInputControl.getInputElement()};e.prototype.initializeIdentityList=function(){var a=this,b;if(typeof this._options.setFocusOnInitializeList==="undefined")b=true;else b=this._options.setFocusOnInitializeList;this._clearIdentityInputError();this._identityListControl.quickClear();this._identityListData=null;this._identityInputControl&&this._identityInputControl._inputElement.val("");this._refreshIdentityInput(b);if(this._options.showCheckName&&this._options.allowCheckName)$("#check-name-action",this._element).closest("li").removeClass("invisible");else $("#check-name-action",this._element).closest("li").addClass("invisible");if(this._options.showBrowse===false)$("#browse-identities-action",this._element).closest("li").addClass("invisible");else $("#browse-identities-action",this._element).closest("li").removeClass("invisible");i.logTracePoint("IdentityPickerControl.InitializeIdentities.Pending");h.getMSJSON(this._options.identityListAction,this._options.searchParams,function(c){var b,d;if(c.hasMore)a._identityListData=null;else{a._identityListData=[];for(b=0;b<c.identities.length;b++){d=c.identities[b];a._identityListData.push(d)}}if(a._options.onListRetrieved)a._options.onListRetrieved(a._identityListData);a._refreshIdentityInput(false);if(a._options.onReady)a._options.onReady(a);i.logTracePoint("IdentityPickerControl.InitializeIdentities.Complete")},null,this._options.wait)};e.prototype._onIdentityListChanged=function(c,a){if(this._options.comboOnly)return;if(a&&a.tfid){this._identityInputControl.options.existingIdentities=this.getPendingChanges().existingUsers;this._identityInputControl.addItem(a.name,a.tfid)}if(!this._options.allowMultiSelect&&!this._options.comboOnly){var b=this._getPendingChanges();if(b.existingUsers.length+b.newUsers.length>0){this._identityInputWrapper.hide();this._actionDiv.hide();this._identityInputError.hide()}else{this._identityInputWrapper.show();this._actionDiv.show();this._identityInputControl.focus()}}};e.prototype.removeIdentity=function(a){this._identityListControl.removeIdentity(a)};e.prototype.addResolvedIdentity=function(b,a,c){this.removeIdentity(c||a);!this._options.allowMultiSelect&&this._identityListControl.clear();!this._options.comboOnly&&this._identityInputControl.removeItem(b);this._identityListControl.addIdentity(b,a,c,"",this._options.comboOnly);if(!this._options.comboOnly)this._identityInputControl.options.existingIdentities=this.getPendingChanges().existingUsers;this._clearIdentityInputError();i.logTracePoint("AddIdentityDialog.ResolvedIdentity.Added")};e.prototype.getDisplayNames=function(){return this._identityListControl.getDisplayNames()};e.prototype._getPendingChanges=function(d){var a,c=this._identityListControl.getPendingChanges(d),b;if(this._identityInputControl&&!this._options.comboOnly){a=this._identityInputControl._inputElement.val();if(a&&this._validate(a))b=a}return{newUsers:c.newUsers,existingUsers:c.existingUsers,inputText:b}};e.prototype.getPendingChanges=function(b){var a=this._getPendingChanges(b);a.inputText&&a.newUsers.push(a.inputText);return a};e.prototype.getTfids=function(){return this._identityListControl.getTfids()};e.prototype.getPendingUserInput=function(){var a="";if(this._identityInputControl)a=this._identityInputControl._inputElement.val();return a};e.prototype.select=function(b,a){return this._identityInputControl?this._identityInputControl.select(b,a):false};e.prototype._setIdentityInputError=function(a){if(!this._options.errorHandler){this._identityInputError.show().text(a);this._identityInputControl.element.addClass("invalid")}else this._options.errorHandler(a,this._options.errorOptions)};e.prototype._clearIdentityInputError=function(){this._identityInputError.hide();this._identityInputControl&&this._identityInputControl.element.removeClass("invalid")};e.prototype._createIdentityListControl=function(){this._identityListControl=f.BaseControl.createIn(o,this._mainControl)};e.prototype._onItemSelected=function(d,b){var a=b.item.text,c=b.item.value;this.addResolvedIdentity(a,a,c)};e.prototype._onNewItemAdded=function(c,b){var a=b.text.trim();this._checkName(a)};e.prototype._validate=function(a){if(!this._options.allowFreeType)return false;else if(a.length===0||!this._options.isHosted||this._isEmailAddress(a)){this._clearIdentityInputError();return true}else{this._setIdentityInputError(b.InvalidEmail);return false}};e.prototype._isEmailAddress=function(a){return a&&e._emailRegex.test(a.trim())&&a.indexOf(";")===-1?true:false};e.prototype._refreshIdentityInput=function(c){var a;if(!this._options.watermarkTo)a=this._options.isHosted?d.StringUtils.htmlEncode(b.IdentityInputWatermarkHosted):d.StringUtils.htmlEncode(b.IdentityInputWatermarkOnPremise);else a=this._options.watermarkTo;this._identityInputControl=$(".identity-input",this._identityInputWrapper).IdentityInput({inputControlId:this._options.inputControlId,watermarkText:a,items:this._identityListData,identityListAction:this._options.identityListAction,searchParams:this._options.searchParams,allowFreeType:this._options.allowFreeType,id:this._options.inputTextElementId,comboOnly:this._options.comboOnly,filterList:this._options.filterList}).data("TFS-IdentityInput");c!==false&&this._identityInputControl.focus(c)};e.prototype._onCheckedStateChanged=function(b,a){if(a.state)this.addResolvedIdentity(a.name,a.name,a.tfid);else this.removeIdentity(a.tfid)};e.prototype._onBrowseClose=function(){var a=$(":tabbable",this._browsePopup),b=a.filter(":first"),c=a.filter(":last");c.unbind("keydown",this._navigateToFirst);b.unbind("keydown",this._navigateToLast);$(document).unbind("click.browse-identities-popup");$(":tabbable",this._element).filter(":first").focus();this._browsePopup.hide();i.logTracePoint("IdentityPickerControl.BrowseIdentitiesPopup.Close");return false};e.prototype._onBrowseOpen=function(b){var a=this._identityListControl.getTfids();if(this._options.browseAction)this._options.browseAction.call(this,b,a);else this._showBrowsePopup.call(this,b,a);return false};e.prototype._showBrowsePopup=function(g,e){var a,b,d;this._browsePopup.show();if(this._identityBrowser){this._identityBrowser.setCheckedIdentities(e);this._identityBrowser.setFocusOnSearchBox()}else this._identityBrowser=f.Enhancement.enhance(s,this._browseContent,{identityListAction:this._options.identityListAction,searchParams:this._options.searchParams,existingGroups:e,gridItems:this._identityListData,multiSelect:this._options.allowMultiSelect,autoResize:false});$(document).bind("click.browse-identities-popup",c(this,this._onBrowseClose));a=$(":tabbable",this._browsePopup);b=a.filter(":first");d=a.filter(":last");d.keydown({target:b},this._navigateToFirst);b.keydown({target:d},this._navigateToLast);g.stopPropagation();g.preventDefault()};e.prototype._navigateToFirst=function(a){if(a.keyCode===$.ui.keyCode.TAB&&!a.shiftKey&&!a.ctrlKey&&!a.altKey){a.data.target.focus();return false}return true};e.prototype._navigateToLast=function(a){if(a.keyCode===$.ui.keyCode.TAB&&a.shiftKey){a.data.target.focus();return false}return true};e.prototype._onCheckName=function(){var a=this._identityInputControl.getCurrentValue().trim();this._checkName(a);return false};e.prototype._checkName=function(c){var a=this;if(this._options.allowCheckName&&this._checkNameAction&&!this._checkNameAction.hasClass("admin-disabled-link")&&c.length){if(this._options.allowArbitraryEmailAddresses&&this._isEmailAddress(c)){this.addResolvedIdentity(c,c);return}this._identityInputControl.disable();this._checkNameAction.text(b.CheckNameInProgress).addClass("admin-disabled-link");i.logTracePoint("AddIdentityDialog.checkName.pending");h.getMSJSON(y.getActionUrl("CheckName","identity",{area:"api"}),{name:c},function(d){a._checkNameAction.text(b.CheckName).removeClass("admin-disabled-link");a._identityInputControl.enable();a._identityInputControl.focus();if(d.identity)a.addResolvedIdentity(d.identity.DisplayName,d.identity.DisplayName,d.identity.TeamFoundationId);else if(d.resolvedName)if(a._options.constrainToTfsUsersOnly)a._setIdentityInputError(b.NoTfsUserError);else a.addResolvedIdentity(d.resolvedName,c);else a._setIdentityInputError(b.NoTfsUserError)},function(c){a._checkNameAction.text(b.CheckName).removeClass("admin-disabled-link");a._identityInputControl.enable();a._identityInputControl.focus();a._setIdentityInputError(c.message)},{tracePoint:"AddIdentityDialog.checkName.complete"})}};e._typeName="tfs.admin.identityPickerControl";e._emailRegex=/^(\S+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;return e}(f.BaseControl);e.IdentityPickerControl=t;g.classExtend(t,m.ControlExtensions);var r=function(e){__extends(d,e);function d(a){e.call(this,a)}d.prototype.hideRemoveElement=function(){this._removeElement&&this._removeElement.hide()};d.prototype._drawRemoveElement=function(f){var e,d;this._removeElement=$(a("div")).appendTo(f).addClass("change-owner-action actions-section");e=$(a("ul")).appendTo(this._removeElement);d=$(a("li")).appendTo(e);$(a("a")).appendTo(d).addClass("linkAction").attr("href","#").text(b.ChangeOwner).click(c(this,this._onItemRemoved))};d._controlType="tfs.admin.ownerIdentityListControl";return d}(o);e.OwnerIdentityListControl=r;g.initClassPrototype(r,{_removeElement:null});var n=function(g){__extends(e,g);function e(a){g.call(this,a)}e.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({allowMultiSelect:false,allowFreeType:false},a))};e.prototype.initialize=function(){g.prototype.initialize.call(this);this._statusDiv=$(a("div")).appendTo(this._mainControl).addClass("status-section");this._successIcon=$(a("div")).appendTo(this._statusDiv).addClass("icon icon-tfs-build-status-succeeded").hide();this._failureIcon=$(a("div")).appendTo(this._statusDiv).addClass("icon icon-tfs-build-status-failed").hide();this._progressIcon=$(a("div")).appendTo(this._statusDiv).addClass("icon status-progress").attr("title",b.SavingProgress).hide();this._currentDisplayName=this._options.displayName;this._currentResolvedName=this._options.displayName;this._currentTfid=this._options.tfid;this._options.displayName&&this.addResolvedIdentity(this._options.displayName,this._options.displayName,this._options.tfid,false);this._element.closest(".resizeTarget").resize()};e.prototype._onIdentityListChanged=function(b,a){g.prototype._onIdentityListChanged.call(this,b,a);this._successIcon.hide();this._failureIcon.hide()};e.prototype._setIdentityInputError=function(a){g.prototype._setIdentityInputError.call(this,a);this._element.closest(".resizeTarget").resize()};e.prototype._clearIdentityInputError=function(){g.prototype._clearIdentityInputError.call(this);this._element.closest(".resizeTarget").resize()};e.prototype.addResolvedIdentity=function(d,a,c,b){g.prototype.addResolvedIdentity.call(this,d,a,c);if(typeof b==="undefined")b=true;!this._cancelButton&&this._addCancelButton();if(b)(this._currentTfid!==c||this._currentResolvedName!==a)&&this._commitOwner(d,a,c)};e.prototype._createIdentityListControl=function(){this._identityListControl=f.BaseControl.createIn(r,this._mainControl)};e.prototype._addCancelButton=function(){var e=this,d=$(a("li")).appendTo(this._actionUl);this._cancelButton=$(a("a")).appendTo(d).addClass("linkAction").text(b.Cancel).attr("tabindex","0").click(c(this,this._onCancel)).keydown(function(a){(a.keyCode===$.ui.keyCode.ENTER||a.keyCode===$.ui.keyCode.SPACE)&&e._onCancel()})};e.prototype._commitOwner=function(e,c,f){var a=this;this._successIcon.hide();this._failureIcon.hide();this._progressIcon.show();h.postMSJSON(this._options.tfsContext.getActionUrl("CommitQueryItemOwner","security",{area:"api"}),{tfid:f,name:c,queryItemId:this._options.itemId},function(g){a._progressIcon.hide();if(g.error){a.addResolvedIdentity(a._currentDisplayName,a._currentResolvedName,a._currentTfid);a._failureIcon.show().attr("title",g.error)}else{a._currentDisplayName=e;a._currentResolvedName=c;a._currentTfid=f;a._successIcon.show().attr("title",d.StringUtils.format(b.CommitOwnerSuccess,e))}})};e.prototype._onCancel=function(){this.addResolvedIdentity(this._currentDisplayName,this._currentResolvedName,this._currentTfid);$(window).resize()};e._controlType="tfs.admin.ownerIdentityControl";return e}(t);e.OwnerIdentityControl=n;g.initClassPrototype(n,{_statusDiv:null,_successIcon:null,_failureIcon:null,_progressIcon:null,_currentDisplayName:null,_currentResolvedName:null,_currentTfid:null,_cancelButton:null});g.classExtend(n,m.ControlExtensions);f.Enhancement.registerEnhancement(n,".owner-identity-control");var w=function(e){__extends(d,e);function d(a){e.call(this,a)}d.prototype.initialize=function(){e.prototype.initialize.call(this);this._createProgressElement=this._element};d.prototype.startMonitoring=function(){this._monitorProgress()};d.prototype.stopMonitoring=function(){this.cancelDelayedFunction("monitorProgress")};d.prototype._renderProgressResponse=function(a){switch(a.State){case 0:this._renderProgress(0,this._options.notStartedText);break;case 1:this._renderProgress(a.PercentComplete,this._options.inProgressText);break;case 2:this._renderComplete();break;case 3:this._renderFailure()}};d.prototype.renderErrorRetrievingProgress=function(f){var e,d,h,g;e=$(a("div"));d=$(a("div")).addClass("create-warning-box").appendTo(e);$(a("span")).text(b.ErrorRetrievingProgressMessage).appendTo(d);if(f){h=f&&f.message||f;$(a("br")).appendTo(d);$(a("br")).appendTo(d);$(a("span")).text(b.ErrorRetrievingProgressDetailsHeader).appendTo(d);$(a("br")).appendTo(d);$(a("span")).addClass("admin-exception-message").text(h).appendTo(d)}$(a("br")).appendTo(e);g=$(a("div")).appendTo(e);$(a("a")).attr("href","#").text(b.ProgressRefreshLink).appendTo(g).click(c(this,this._monitorProgress));this._createProgressElement.html(e)};d.prototype._monitorProgress=function(){h.getMSJSON(this._options.tfsContext.getActionUrl("MonitorJobProgress","job",{area:"api"}),{jobId:this._options.jobId},c(this,this._renderProgressResponse),c(this,this.renderErrorRetrievingProgress),{showGlobalProgressIndicator:false});return false};d.prototype._renderProgress=function(c,e){var b,d;this._createProgressElement.empty();b=$(a("div")).addClass("progress-container").appendTo(this._createProgressElement);c&&$(a("div")).addClass("completed").css("width",c+"%").appendTo(b);$(a("div")).addClass("remaining").css("width",NaN-c).appendTo(b);d=$(a("div")).appendTo(this._createProgressElement);$(a("span")).addClass("getting-started-lighttext").text(e).appendTo(d);this._fire("render-progress");this.delayExecute("monitorProgress",5e3,true,this._monitorProgress)};d.prototype._renderComplete=function(){var b;this._createProgressElement.empty();if(this._options.completeText){b=$(a("div")).addClass("create-done-box");$(a("span")).text(this._options.completeText).appendTo(b);this._createProgressElement.append(b)}this._fire("render-complete")};d.prototype._renderFailure=function(){var b,e,d;b=$(a("div"));e=$(a("div")).addClass("create-error-box").appendTo(b);$(a("span")).text(this._options.failureText).appendTo(e);$(a("br")).appendTo(b);d=$(a("div")).appendTo(b);$(a("a")).attr("href","#").text(this._options.retryActionText).appendTo(d).click(c(this,this._onRetryAfterFailure));this._createProgressElement.html(b);this._fire("render-failure")};d.prototype._onRetryAfterFailure=function(){this._fire("retry-after-failure");return false};d._controlType="MonitorJobControl";return d}(f.BaseControl);e.MonitorJobControl=w;g.initClassPrototype(w,{_createProgressElement:null});g.classExtend(w,m.ControlExtensions);g.tfsModuleLoaded("TFS.Admin.Common",e)});
// SIG // Begin signature block
// SIG // MIIaqwYJKoZIhvcNAQcCoIIanDCCGpgCAQExCzAJBgUr
// SIG // DgMCGgUAMGcGCisGAQQBgjcCAQSgWTBXMDIGCisGAQQB
// SIG // gjcCAR4wJAIBAQQQEODJBs441BGiowAQS9NQkAIBAAIB
// SIG // AAIBAAIBAAIBADAhMAkGBSsOAwIaBQAEFMnjJeJpbTJh
// SIG // 40f/igostnBRQq1UoIIVejCCBLswggOjoAMCAQICEzMA
// SIG // AABZ1nPNUY7wIsUAAAAAAFkwDQYJKoZIhvcNAQEFBQAw
// SIG // dzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0
// SIG // b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1p
// SIG // Y3Jvc29mdCBDb3Jwb3JhdGlvbjEhMB8GA1UEAxMYTWlj
// SIG // cm9zb2Z0IFRpbWUtU3RhbXAgUENBMB4XDTE0MDUyMzE3
// SIG // MTMxNVoXDTE1MDgyMzE3MTMxNVowgasxCzAJBgNVBAYT
// SIG // AlVTMQswCQYDVQQIEwJXQTEQMA4GA1UEBxMHUmVkbW9u
// SIG // ZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9u
// SIG // MQ0wCwYDVQQLEwRNT1BSMScwJQYDVQQLEx5uQ2lwaGVy
// SIG // IERTRSBFU046RjUyOC0zNzc3LThBNzYxJTAjBgNVBAMT
// SIG // HE1pY3Jvc29mdCBUaW1lLVN0YW1wIFNlcnZpY2UwggEi
// SIG // MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDGbE7P
// SIG // aFP974De6IvEsfB+B84ePOwMjDWHTOlROry2sJZ3Qvr/
// SIG // PM/h2uKJ+m5CAJlbFt0JZDjiUvvfjvqToz27h49uuIfJ
// SIG // 0GBPz5yCkW2RG3IQs9hDfFlKYF3GsFXQJ9vy9r3yIMYi
// SIG // LJ5riy1s6ngEyUvBcAnnth2vmowGP3hw+nbu0iQUdrKu
// SIG // ICiDHKnwSJI/ooX3g8rFUdCVIAN50le8E7VOuLRsVh9T
// SIG // HhW7zzA//TsBzV9yaPfK85lmM6hdIo8dbsraZdIrHCSs
// SIG // n3ypEIqF4m0uXEr9Sbl7QLFTxt9HubMjTiJHHNPBuUl2
// SIG // QnLOkIYOJPXCPLkJNj+oU1xW/l9hAgMBAAGjggEJMIIB
// SIG // BTAdBgNVHQ4EFgQUWygas811DWM9/Zn1mxUCSBrLpqww
// SIG // HwYDVR0jBBgwFoAUIzT42VJGcArtQPt2+7MrsMM1sw8w
// SIG // VAYDVR0fBE0wSzBJoEegRYZDaHR0cDovL2NybC5taWNy
// SIG // b3NvZnQuY29tL3BraS9jcmwvcHJvZHVjdHMvTWljcm9z
// SIG // b2Z0VGltZVN0YW1wUENBLmNybDBYBggrBgEFBQcBAQRM
// SIG // MEowSAYIKwYBBQUHMAKGPGh0dHA6Ly93d3cubWljcm9z
// SIG // b2Z0LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0VGltZVN0
// SIG // YW1wUENBLmNydDATBgNVHSUEDDAKBggrBgEFBQcDCDAN
// SIG // BgkqhkiG9w0BAQUFAAOCAQEAevAN9EVsNJYOd/DiwEIF
// SIG // YfeI03r9iNWn9fd/8gj21f3LynR82wmp39YVB5m/0D6H
// SIG // hGJ7wgaOyoto4j3fnlrFjLKpXP5ZYib11/l4tm60CpBl
// SIG // ZulRCPF8yaO3BDdGxeeCPihc709xpOexJVrlQ1QzCH+k
// SIG // sFUt0YJwSBEgDSaBDu8GJXSrhcPDjOIUX+gFVI+6homq
// SIG // lq6UYiX5r2mICgyxUcQJ77iAfFOQebvpj9BI8GLImfFl
// SIG // NDv3zrX7Zpi5olmZXT6VnxS/NbT7mHIkKQzzugR6gjn7
// SIG // Rs3x4LIWvH0g+Jw5FSWhJi3Wi4G9xr2wnVT+RwtfLU4q
// SIG // 9IfqtQ+1t+2SKTCCBOwwggPUoAMCAQICEzMAAADKbNUy
// SIG // EjXE4VUAAQAAAMowDQYJKoZIhvcNAQEFBQAweTELMAkG
// SIG // A1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAO
// SIG // BgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29m
// SIG // dCBDb3Jwb3JhdGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0
// SIG // IENvZGUgU2lnbmluZyBQQ0EwHhcNMTQwNDIyMTczOTAw
// SIG // WhcNMTUwNzIyMTczOTAwWjCBgzELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjENMAsGA1UECxMETU9QUjEeMBwGA1UEAxMVTWlj
// SIG // cm9zb2Z0IENvcnBvcmF0aW9uMIIBIjANBgkqhkiG9w0B
// SIG // AQEFAAOCAQ8AMIIBCgKCAQEAlnFd7QZG+oTLnVu3Rsew
// SIG // 4bQROQOtsRVzYJzrp7ZuGjw//2XjNPGmpSFeVplsWOSS
// SIG // oQpcwtPcUi8MZZogYUBTMZxsjyF9uvn+E1BSYJU6W7lY
// SIG // pXRhQamU4K0mTkyhl3BJJ158Z8pPHnGERrwdS7biD8XG
// SIG // J8kH5noKpRcAGUxwRTgtgbRQqsVn0fp5vMXMoXKb9CU0
// SIG // mPhU3xI5OBIvpGulmn7HYtHcz+09NPi53zUwuux5Mqnh
// SIG // qaxVTUx/TFbDEwt28Qf5zEes+4jVUqUeKPo9Lc/PhJiG
// SIG // cWURz4XJCUSG4W/nsfysQESlqYsjP4JJndWWWVATWRhz
// SIG // /0MMrSvUfzBAZwIDAQABo4IBYDCCAVwwEwYDVR0lBAww
// SIG // CgYIKwYBBQUHAwMwHQYDVR0OBBYEFB9e4l1QjVaGvko8
// SIG // zwTop4e1y7+DMFEGA1UdEQRKMEikRjBEMQ0wCwYDVQQL
// SIG // EwRNT1BSMTMwMQYDVQQFEyozMTU5NStiNDIxOGYxMy02
// SIG // ZmNhLTQ5MGYtOWM0Ny0zZmM1NTdkZmM0NDAwHwYDVR0j
// SIG // BBgwFoAUyxHoytK0FlgByTcuMxYWuUyaCh8wVgYDVR0f
// SIG // BE8wTTBLoEmgR4ZFaHR0cDovL2NybC5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jcmwvcHJvZHVjdHMvTWljQ29kU2lnUENB
// SIG // XzA4LTMxLTIwMTAuY3JsMFoGCCsGAQUFBwEBBE4wTDBK
// SIG // BggrBgEFBQcwAoY+aHR0cDovL3d3dy5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jZXJ0cy9NaWNDb2RTaWdQQ0FfMDgtMzEt
// SIG // MjAxMC5jcnQwDQYJKoZIhvcNAQEFBQADggEBAHdc69eR
// SIG // Pc29e4PZhamwQ51zfBfJD+0228e1LBte+1QFOoNxQIEJ
// SIG // ordxJl7WfbZsO8mqX10DGCodJ34H6cVlH7XPDbdUxyg4
// SIG // Wojne8EZtlYyuuLMy5Pbr24PXUT11LDvG9VOwa8O7yCb
// SIG // 8uH+J13oxf9h9hnSKAoind/NcIKeGHLYI8x6LEPu/+rA
// SIG // 4OYdqp6XMwBSbwe404hs3qQGNafCU4ZlEXcJjzVZudiG
// SIG // qAD++DF9LPSMBZ3AwdV3cmzpTVkmg/HCsohXkzUAfFAr
// SIG // vFn8/hwpOILT3lKXRSkYTpZbnbpfG6PxJ1DqB5XobTQN
// SIG // OFfcNyg1lTo4nNTtaoVdDiIRXnswggW8MIIDpKADAgEC
// SIG // AgphMyYaAAAAAAAxMA0GCSqGSIb3DQEBBQUAMF8xEzAR
// SIG // BgoJkiaJk/IsZAEZFgNjb20xGTAXBgoJkiaJk/IsZAEZ
// SIG // FgltaWNyb3NvZnQxLTArBgNVBAMTJE1pY3Jvc29mdCBS
// SIG // b290IENlcnRpZmljYXRlIEF1dGhvcml0eTAeFw0xMDA4
// SIG // MzEyMjE5MzJaFw0yMDA4MzEyMjI5MzJaMHkxCzAJBgNV
// SIG // BAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYD
// SIG // VQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQg
// SIG // Q29ycG9yYXRpb24xIzAhBgNVBAMTGk1pY3Jvc29mdCBD
// SIG // b2RlIFNpZ25pbmcgUENBMIIBIjANBgkqhkiG9w0BAQEF
// SIG // AAOCAQ8AMIIBCgKCAQEAsnJZXBkwZL8dmmAgIEKZdlNs
// SIG // PhvWb8zL8epr/pcWEODfOnSDGrcvoDLs/97CQk4j1XIA
// SIG // 2zVXConKriBJ9PBorE1LjaW9eUtxm0cH2v0l3511iM+q
// SIG // c0R/14Hb873yNqTJXEXcr6094CholxqnpXJzVvEXlOT9
// SIG // NZRyoNZ2Xx53RYOFOBbQc1sFumdSjaWyaS/aGQv+knQp
// SIG // 4nYvVN0UMFn40o1i/cvJX0YxULknE+RAMM9yKRAoIsc3
// SIG // Tj2gMj2QzaE4BoVcTlaCKCoFMrdL109j59ItYvFFPees
// SIG // CAD2RqGe0VuMJlPoeqpK8kbPNzw4nrR3XKUXno3LEY9W
// SIG // PMGsCV8D0wIDAQABo4IBXjCCAVowDwYDVR0TAQH/BAUw
// SIG // AwEB/zAdBgNVHQ4EFgQUyxHoytK0FlgByTcuMxYWuUya
// SIG // Ch8wCwYDVR0PBAQDAgGGMBIGCSsGAQQBgjcVAQQFAgMB
// SIG // AAEwIwYJKwYBBAGCNxUCBBYEFP3RMU7TJoqV4ZhgO6gx
// SIG // b6Y8vNgtMBkGCSsGAQQBgjcUAgQMHgoAUwB1AGIAQwBB
// SIG // MB8GA1UdIwQYMBaAFA6sgmBAVieX5SUT/CrhClOVWeSk
// SIG // MFAGA1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwubWlj
// SIG // cm9zb2Z0LmNvbS9wa2kvY3JsL3Byb2R1Y3RzL21pY3Jv
// SIG // c29mdHJvb3RjZXJ0LmNybDBUBggrBgEFBQcBAQRIMEYw
// SIG // RAYIKwYBBQUHMAKGOGh0dHA6Ly93d3cubWljcm9zb2Z0
// SIG // LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0Um9vdENlcnQu
// SIG // Y3J0MA0GCSqGSIb3DQEBBQUAA4ICAQBZOT5/Jkav629A
// SIG // sTK1ausOL26oSffrX3XtTDst10OtC/7L6S0xoyPMfFCY
// SIG // gCFdrD0vTLqiqFac43C7uLT4ebVJcvc+6kF/yuEMF2nL
// SIG // pZwgLfoLUMRWzS3jStK8cOeoDaIDpVbguIpLV/KVQpzx
// SIG // 8+/u44YfNDy4VprwUyOFKqSCHJPilAcd8uJO+IyhyugT
// SIG // pZFOyBvSj3KVKnFtmxr4HPBT1mfMIv9cHc2ijL0nsnlj
// SIG // VkSiUc356aNYVt2bAkVEL1/02q7UgjJu/KSVE+Traeep
// SIG // oiy+yCsQDmWOmdv1ovoSJgllOJTxeh9Ku9HhVujQeJYY
// SIG // XMk1Fl/dkx1Jji2+rTREHO4QFRoAXd01WyHOmMcJ7oUO
// SIG // jE9tDhNOPXwpSJxy0fNsysHscKNXkld9lI2gG0gDWvfP
// SIG // o2cKdKU27S0vF8jmcjcS9G+xPGeC+VKyjTMWZR4Oit0Q
// SIG // 3mT0b85G1NMX6XnEBLTT+yzfH4qerAr7EydAreT54al/
// SIG // RrsHYEdlYEBOsELsTu2zdnnYCjQJbRyAMR/iDlTd5aH7
// SIG // 5UcQrWSY/1AWLny/BSF64pVBJ2nDk4+VyY3YmyGuDVyc
// SIG // 8KKuhmiDDGotu3ZrAB2WrfIWe/YWgyS5iM9qqEcxL5rc
// SIG // 43E91wB+YkfRzojJuBj6DnKNwaM9rwJAav9pm5biEKgQ
// SIG // tDdQCNbDPTCCBgcwggPvoAMCAQICCmEWaDQAAAAAABww
// SIG // DQYJKoZIhvcNAQEFBQAwXzETMBEGCgmSJomT8ixkARkW
// SIG // A2NvbTEZMBcGCgmSJomT8ixkARkWCW1pY3Jvc29mdDEt
// SIG // MCsGA1UEAxMkTWljcm9zb2Z0IFJvb3QgQ2VydGlmaWNh
// SIG // dGUgQXV0aG9yaXR5MB4XDTA3MDQwMzEyNTMwOVoXDTIx
// SIG // MDQwMzEzMDMwOVowdzELMAkGA1UEBhMCVVMxEzARBgNV
// SIG // BAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1JlZG1vbmQx
// SIG // HjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlvbjEh
// SIG // MB8GA1UEAxMYTWljcm9zb2Z0IFRpbWUtU3RhbXAgUENB
// SIG // MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
// SIG // n6Fssd/bSJIqfGsuGeG94uPFmVEjUK3O3RhOJA/u0afR
// SIG // TK10MCAR6wfVVJUVSZQbQpKumFwwJtoAa+h7veyJBw/3
// SIG // DgSY8InMH8szJIed8vRnHCz8e+eIHernTqOhwSNTyo36
// SIG // Rc8J0F6v0LBCBKL5pmyTZ9co3EZTsIbQ5ShGLieshk9V
// SIG // UgzkAyz7apCQMG6H81kwnfp+1pez6CGXfvjSE/MIt1Nt
// SIG // UrRFkJ9IAEpHZhEnKWaol+TTBoFKovmEpxFHFAmCn4Tt
// SIG // VXj+AZodUAiFABAwRu233iNGu8QtVJ+vHnhBMXfMm987
// SIG // g5OhYQK1HQ2x/PebsgHOIktU//kFw8IgCwIDAQABo4IB
// SIG // qzCCAacwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU
// SIG // IzT42VJGcArtQPt2+7MrsMM1sw8wCwYDVR0PBAQDAgGG
// SIG // MBAGCSsGAQQBgjcVAQQDAgEAMIGYBgNVHSMEgZAwgY2A
// SIG // FA6sgmBAVieX5SUT/CrhClOVWeSkoWOkYTBfMRMwEQYK
// SIG // CZImiZPyLGQBGRYDY29tMRkwFwYKCZImiZPyLGQBGRYJ
// SIG // bWljcm9zb2Z0MS0wKwYDVQQDEyRNaWNyb3NvZnQgUm9v
// SIG // dCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHmCEHmtFqFKoKWt
// SIG // THNY9AcTLmUwUAYDVR0fBEkwRzBFoEOgQYY/aHR0cDov
// SIG // L2NybC5taWNyb3NvZnQuY29tL3BraS9jcmwvcHJvZHVj
// SIG // dHMvbWljcm9zb2Z0cm9vdGNlcnQuY3JsMFQGCCsGAQUF
// SIG // BwEBBEgwRjBEBggrBgEFBQcwAoY4aHR0cDovL3d3dy5t
// SIG // aWNyb3NvZnQuY29tL3BraS9jZXJ0cy9NaWNyb3NvZnRS
// SIG // b290Q2VydC5jcnQwEwYDVR0lBAwwCgYIKwYBBQUHAwgw
// SIG // DQYJKoZIhvcNAQEFBQADggIBABCXisNcA0Q23em0rXfb
// SIG // znlRTQGxLnRxW20ME6vOvnuPuC7UEqKMbWK4VwLLTiAT
// SIG // UJndekDiV7uvWJoc4R0Bhqy7ePKL0Ow7Ae7ivo8KBciN
// SIG // SOLwUxXdT6uS5OeNatWAweaU8gYvhQPpkSokInD79vzk
// SIG // eJkuDfcH4nC8GE6djmsKcpW4oTmcZy3FUQ7qYlw/FpiL
// SIG // ID/iBxoy+cwxSnYxPStyC8jqcD3/hQoT38IKYY7w17gX
// SIG // 606Lf8U1K16jv+u8fQtCe9RTciHuMMq7eGVcWwEXChQO
// SIG // 0toUmPU8uWZYsy0v5/mFhsxRVuidcJRsrDlM1PZ5v6oY
// SIG // emIp76KbKTQGdxpiyT0ebR+C8AvHLLvPQ7Pl+ex9teOk
// SIG // qHQ1uE7FcSMSJnYLPFKMcVpGQxS8s7OwTWfIn0L/gHkh
// SIG // gJ4VMGboQhJeGsieIiHQQ+kr6bv0SMws1NgygEwmKkgk
// SIG // X1rqVu+m3pmdyjpvvYEndAYR7nYhv5uCwSdUtrFqPYmh
// SIG // dmG0bqETpr+qR/ASb/2KMmyy/t9RyIwjyWa9nR2HEmQC
// SIG // PS2vWY+45CHltbDKY7R4VAXUQS5QrJSwpXirs6CWdRrZ
// SIG // kocTdSIvMqgIbqBbjCW/oO+EyiHW6x5PyZruSeD3AWVv
// SIG // iQt9yGnI5m7qp5fOMSn/DsVbXNhNG6HY+i+ePy5VFmvJ
// SIG // E6P9MYIEnTCCBJkCAQEwgZAweTELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0IENvZGUgU2ln
// SIG // bmluZyBQQ0ECEzMAAADKbNUyEjXE4VUAAQAAAMowCQYF
// SIG // Kw4DAhoFAKCBtjAZBgkqhkiG9w0BCQMxDAYKKwYBBAGC
// SIG // NwIBBDAcBgorBgEEAYI3AgELMQ4wDAYKKwYBBAGCNwIB
// SIG // FTAjBgkqhkiG9w0BCQQxFgQUF9tS/l9qIDaUt/csMN+p
// SIG // nWXywzUwVgYKKwYBBAGCNwIBDDFIMEagLIAqAFQARgBT
// SIG // AC4AQQBkAG0AaQBuAC4AQwBvAG0AbQBvAG4AXwAyAC4A
// SIG // agBzoRaAFGh0dHA6Ly9taWNyb3NvZnQuY29tMA0GCSqG
// SIG // SIb3DQEBAQUABIIBAILPTqxnE5g34TutcT1JkRxGyJVB
// SIG // ofXMabtT3xWIBw5MA7FijIVv92JbQaUNGevCZBX7qstN
// SIG // pnwZWMfA0QJH0VVtje7Lauhl7/pJVeQfyqUhPacL+DWk
// SIG // r3FhSsWg3uCnqJ6uHEGjisJQPeXjMqYuGVo3iP1qFw9Q
// SIG // k6MXQHe5Jxv3EEUoo0vATTXxWYPdCWsoyqbWFND5teRt
// SIG // YA68skSnQfwmjCqPWr/vH7VzN8iSTdBhVFSc5THlqRga
// SIG // Q0/NC9Qpc/x4D9QiSD0bJU1A4DUzuV2XjGMKvfiaX+Aq
// SIG // 51fbML0b3d1cxyNTpoglZly3qYa9FYz4RT+CEs9ywC9Z
// SIG // 7jXWO3ChggIoMIICJAYJKoZIhvcNAQkGMYICFTCCAhEC
// SIG // AQEwgY4wdzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldh
// SIG // c2hpbmd0b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNV
// SIG // BAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlvbjEhMB8GA1UE
// SIG // AxMYTWljcm9zb2Z0IFRpbWUtU3RhbXAgUENBAhMzAAAA
// SIG // WdZzzVGO8CLFAAAAAABZMAkGBSsOAwIaBQCgXTAYBgkq
// SIG // hkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJ
// SIG // BTEPFw0xNDA3MjMwOTA4MDJaMCMGCSqGSIb3DQEJBDEW
// SIG // BBSweE4CDG24PROx55leMlajMHX0kTANBgkqhkiG9w0B
// SIG // AQUFAASCAQCfQv4omF7FpKGTZyCnnmgjRiIbKSPzaZvM
// SIG // kS4PJKw572FeG0on71gc00R5xMtZMhERY5kZy55ZY+m2
// SIG // +fxfidulmE2bjhyDajPFqb1ePx88M8W9x/2Jh2iJXidN
// SIG // k1S9oSn9JxhIMWJadIqYAC2UpVAKqQ1KvOzZXx8m0fib
// SIG // vhIBPjNwff9aJsF+DjrL9ijHb27d2rFJDDjEkav2t7w7
// SIG // m032V7BXPT13XdQ/iapq/oR6Jjtt0dAMWe59VUewHYai
// SIG // OjAzVnwwdF+E+4H+iWNQO9Rsn4PsUmwNUxVxN2/WlWg7
// SIG // Jz23uR9AQyWOoZlAX92hYdJczFeR5GzJN7LGUXdzEJ4m
// SIG // End signature block
