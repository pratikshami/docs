//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d};define(["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.OM","WorkItemTracking/Scripts/TFS.WorkItemTracking","Presentation/Scripts/TFS/Generated/TFS.WorkItemTracking.Constants","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/Generated/TFS.Common.Constants","Presentation/Scripts/TFS/Resources/TFS.Resources.WorkItemTracking","Presentation/Scripts/TFS/TFS.UI","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants"],function(T,c,h,b,e,s,d,Q,F,j,q,m,a,P,N){var S=P.domElem,E={},z=s.LinkingUtilities,R=F.TfsContext.getDefault(),r=b.delegate,i;(function(a){a.PREFERENCE_NAME="Microsoft.TeamFoundation.WorkItemTracking.Linking";a.LAST_SELECTED_WORK_ITEM_TYPE="LastSelectedWorkItemType";a.LAST_SELECTED_LINK_TYPE_EXISTING="LastSelectedLinkType.Existing";a.LAST_SELECTED_LINK_TYPE_NEW="LastSelectedLinkType.New"})(i||(i={}));var f=function(){function b(){}b.getRegisteredLinkName=function(d){var c;switch(d){case b.RegisteredLinkTypeRelated:c=a.LinksControlRelatedText;break;case b.RegisteredLinkTypeHyperlink:c=a.LinksControlHyperlinkText;break;case b.RegisteredLinkTypeChangeset:c=a.LinksControlChangesetText;break;case b.RegisteredLinkTypeVersionedItem:c=a.LinksControlVersionedItemText;break;case b.RegisteredLinkTypeCommit:if(s.FeatureAvailabilityService.isFeatureEnabled(N.FeatureAvailabilityFlags.SourceControlGit))c=a.LinksControlCommitText;else c=a.LinksControlUnknownLinkTypeText;break;case b.RegisteredLinkTypeResultAttachment:c=a.LinksControlResultAttachmentText;break;case b.RegisteredLinkTypeTestResult:c=a.LinksControlTestResultText;break;case b.RegisteredLinkTypeStoryboard:c=a.LinksControlStoryboardText;break;default:c=a.LinksControlUnknownLinkTypeText}return c};b.getLinkTypeRefName=function(a){if(a instanceof d.WorkItemLink){var b=a;return b.getLinkTypeEnd().immutableName}else return a.getArtifactLinkType()};b.getLinkTypeName=function(a){if(a instanceof d.WorkItemLink){var c=a;return c.getLinkTypeEnd().name}else return b.getRegisteredLinkName(a.getArtifactLinkType())};b.RegisteredLinkTypeRelated="Related Workitem";b.RegisteredLinkTypeHyperlink="Workitem Hyperlink";b.RegisteredLinkTypeChangeset="Fixed in Changeset";b.RegisteredLinkTypeVersionedItem="Source Code File";b.RegisteredLinkTypeCommit="Fixed in Commit";b.RegisteredLinkTypeResultAttachment="Result Attachment";b.RegisteredLinkTypeTestResult="Test Result";b.RegisteredLinkTypeStoryboard="Storyboard";return b}();c.LinkingUtils=f;var x=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype._createIn=function(a){return b.prototype._createIn.call(this,a)};a.prototype.update=function(i,b,g,h,e,f){var c,d,a=[];this._element.empty().removeAttr("class");a.push("link-visualization");a.push((i||"").toLocaleLowerCase());c=g===true?"multiplesrc":"singlesrc";d=h===true?"multipletgt":"singletgt";a.push(b?["image",d,c].join("-"):["image",c,d].join("-"));this._element.addClass(a.join(" "));$("<div />").addClass("text text-forward").text(b?e:f).appendTo(this._element);$("<div />").addClass("text text-reverse").text(b?f:e).appendTo(this._element)};a.prototype.disable=function(){this._element.addClass("invalid")};return a}(j.BaseControl),k=function(){function c(a){this._options=a}c.prototype.witFilterExists=function(){this._ensureWitFilters();return this._witFilterExists};c.prototype.linkTypeFilterExists=function(a){this._ensureLinkTypeFilters(a);return this._linkTypeFilterExists};c.prototype.isLinkFilteredOut=function(b,a){this._ensureLinkTypeFilters(a);return!this._getValidLinkType(b)};c.prototype.isLinkTypeFilteredOut=function(a,c,d){if(this._options.tfsContext.standardAccessMode===false&&a!==f.RegisteredLinkTypeHyperlink)return true;var b;this._ensureLinkTypeFilters(d);if(c===true)b=this._witLinkTypes[a];else b=this._regLinkTypes[a];return!b};c.prototype.isWitFilteredOut=function(g,f){var d,b,e,c,a=false;if(this._witFilterType==="includeAll")a=this._witFiltersProjectScoped&&f===false;else{this._ensureWitFilters();d=this._witFilters.length;b=this._witFilterType==="include";e=this._witFilterType==="exclude";if(d){c=$.inArray(g,this._witFilters)>=0;if(b)a=!c;else if(e)a=c}else if(b)a=true}return a};c.prototype.getValidLinkTypesForWorkItem=function(a,h){var i=this,c=[],g={};e.assert(a instanceof d.WorkItem,"workItem should be of type TFS.WorkItemTracking.WorkItem");if(a.store.getLinkTypes().length){$.each(a.getLinks(),function(){var a=this instanceof d.WorkItemLink?this.getLinkTypeEnd():null;if(a&&!a.isForwardLink&&a.linkType&&a.linkType.isOneToMany)g[a.immutableName]=true});$.each(a.store.getLinkTypeEnds(),function(){if(this.linkType&&this.linkType.isActive)if(!i.isLinkTypeFilteredOut(this.immutableName,true,a.store))if(this.immutableName in g)$.isArray(h)&&h.push(this.immutableName);else c.push(this.name)})}else c.push(f.RegisteredLinkTypeRelated);c.sort(b.StringUtils.localeIgnoreCaseComparer);return c};c.prototype.getValidWitsForProject=function(i,g,j){var k=this,a=[],c,f;e.assert(i instanceof d.Project,"project should be of type TFS.WorkItemTracking.Project");function h(){if($.isFunction(g)){a.sort(b.StringUtils.localeIgnoreCaseComparer);g.call(k,a)}}if(!this._witFiltersProjectScoped){this._ensureWitFilters();c=this._witFilterType;f={};$.each(this._witFilters,function(b,a){f[a]=true});i.beginGetVisibleWorkItemTypeNames(function(b){$.each(b,function(d,b){if(c==="includeAll")a.push(b);else if(b in f)c==="include"&&a.push(b);else c==="exclude"&&a.push(b)});h()},j)}else h()};c.prototype._ensureLinkTypeFilters=function(a){!this._witLinkTypes&&this._initializeLinkFilters(a)};c.prototype._ensureWitFilters=function(){!this._witFilters&&this._initializeWitFilters()};c.prototype._initializeLinkFilters=function(h){var b,d,c,j,e=[],k=h.getRegisteredLinkTypes()||[],g=[],l=h.getLinkTypeEnds()||[];for(b=0,d=k.length;b<d;b++){c=k[b];j=f.getRegisteredLinkName(c);j!==a.LinksControlUnknownLinkTypeText&&e.push({refName:c,name:f.getRegisteredLinkName(c)})}if(this._options.externalLinkFilters)e=this._getFilteredLinkTypes(h,e,{filters:this._options.externalLinkFilters});for(b=0,d=l.length;b<d;b++){c=l[b];g.push({refName:c.immutableName,name:c.name,isDisabled:!c.linkType.isActive})}if(this._options.workItemLinkFilters)g=this._getFilteredLinkTypes(h,g,{filterLinkTypes:true,filters:this._options.workItemLinkFilters});this._setGroupOrder(e,g);function i(a){var e={};for(b=0,d=a.length;b<d;b++){c=a[b];e[c.refName]=c}return e}this._regLinkTypes=i(e);this._witLinkTypes=i(g)};c.prototype._initializeWitFilters=function(){var b,d,c,a=this._options.workItemTypeFilters;this._witFilters=[];if(a){this._witFiltersProjectScoped=a.scope==="project";this._witFilterType=a.filterType||"includeAll";if($.isArray(a.filters))for(b=0,d=a.filters.length;b<d;b++){c=a.filters[b];c.workItemType&&this._witFilters.push(c.workItemType)}}else{this._witFiltersProjectScoped=false;this._witFilterType="includeAll"}this._witFilterExists=this._witFilterType!=="includeAll"||this._witFiltersProjectScoped};c.prototype._getFilteredLinkTypes=function(o,e,f){var a,g,c,i=[],d,n=f&&f.filterLinkTypes===true,b=f&&f.filters,m,k,l,j,h;if(b){d={};if(b.filterType!=="excludeAll"){if($.isArray(b.filters))for(a=0,g=b.filters.length;a<g;a++){c=b.filters[a];if(n){m=!c.filterOn||c.filterOn==="reversename";k=!c.filterOn||c.filterOn==="forwardname";try{h=o.findLinkType(c.linkType);if(k)d[h.forwardEnd.immutableName]=true;if(m&&h.isDirectional)d[h.reverseEnd.immutableName]=true}catch(p){}}else d[c.linkType]=true}j=b.filterType==="includeAll";l=j||b.filterType==="include";for(a=0,g=e.length;a<g;a++)(j||e[a].refName in d)===l&&i.push(e[a])}this._linkTypeFilterExists=this._linkTypeFilterExists||b.filterType!=="includeAll"}else i=e;return i};c.prototype._setGroupOrder=function(e,f){var a,d,c=e.concat(f);c.sort(function(a,c){return b.StringUtils.localeIgnoreCaseComparer(a.name,c.name)});for(a=0,d=c.length;a<d;a++)c[a].groupOrder=a};c.prototype._getGroupOrder=function(b){e.assert(b instanceof d.Link,"link should be of type TFS.WorkItemTracking.OM.Link");var a=this._getValidLinkType(b);return a?a.groupOrder:this._witLinkTypes.length+this._regLinkTypes.length+1};c.prototype._getValidLinkType=function(a){var b=f.getLinkTypeRefName(a);e.assert(a instanceof d.Link,"link should be of type TFS.WorkItemTracking.OM.Link");return a instanceof d.WorkItemLink?this._witLinkTypes[b]:this._regLinkTypes[b]};return c}();c.LinkFilterHelper=k;h.initClassPrototype(k,{_options:null,_witLinkTypes:null,_regLinkTypes:null,_witFiltersProjectScoped:null,_witFilterType:null,_witFilters:null,_witFilterExists:false,_linkTypeFilterExists:false});var y=function(){function c(a){this._options=a}c.getDefaultColumns=function(){return[{name:c.linkDescriptionColumnName},{name:c.linkCommentColumnName}]};c.isIdColumn=function(a){return a.toLocaleUpperCase()==="System.Id".toLocaleUpperCase()};c.isLinkTypeColumn=function(a){return a.toLocaleUpperCase()===c.linkTypeColumnName.toLocaleUpperCase()};c.isDescriptionColumn=function(b){var a=b.toLocaleUpperCase();return a==="System.Title".toLocaleUpperCase()||a===c.linkDescriptionColumnName.toLocaleUpperCase()};c.isCommentColumn=function(a){return a.toLocaleUpperCase()===c.linkCommentColumnName.toLocaleUpperCase()};c.getColumnIndexByName=function(c,b){var a,e,d=-1;b=(b||"").toLocaleUpperCase();for(a=0,e=c.length;a<e;a++)if(c[a].name.toLocaleUpperCase()===b){d=a;break}return d};c.getFieldColumnWidth=function(e,d){var a=c.defaultColumnWidth,b=d.getFieldDefinition(e);if(b)if(b.id===1)a=c.defaultTitleColumnWidth;else if(b.id===-3)a=c.defaultIdColumnWidth;else if(b.id===100)a=c.defaultLinkTypeColumnWidth;else if(b.id===80)a=c.defaultTagColumnWidth;else switch(b.type){case 1:a=c.defaultStringColumnWidth;break;case 10:a=c.defaultDoubleColumnWidth;break;case 2:a=c.defaultIntegerColumnWidth;break;case 3:a=c.defaultDateTimeColumnWidth;break;case 8:a=c.defaultTreePathColumnWidth}return a};c.prototype.getDisplayColumns=function(a){this._ensureDisplayColumns(a);return this._displayColumns};c.prototype.getSortColumns=function(){this._ensureSortColumns();return this._sortColumns};c.prototype.setSortColumns=function(a){this._sortColumns=a};c.prototype.sortColumnExists=function(){return this.getSortColumns().length>0};c.prototype.getWitColumns=function(a){var d,c=[],e=this.getDisplayColumns(a);$.each(e,function(){if(!b.StringUtils.startsWith(this.name,"System.Links.")){d=a.getFieldDefinition(this.name);d&&c.push(this.name)}});return c};c.prototype._ensureDisplayColumns=function(a){!this._displayColumns&&this._prepareDisplayColumns(a)};c.prototype._ensureSortColumns=function(){if(!this._sortColumns)this._sortColumns=[]};c.prototype._prepareDisplayColumns=function(g){var d,f,e,a,b=this._options.linkColumns;if($.isArray(b)&&b.length){a=[];for(d=0,f=b.length;d<f;d++){e=b[d];a.push({name:e.linkAttribute||e.refName})}}else a=c.getDefaultColumns();this._updateDisplayAttributes(a,g);this._displayColumns=a};c.prototype._updateDisplayAttributes=function(c,a){var b=this;$.each(c,function(){this.text=b._getColumnText(this.name,a);this.width=b._getColumnWidth(this.name,a)})};c.prototype._getColumnText=function(d,e){var b="";if(d===c.linkDescriptionColumnName)b=a.LinksControlDescriptionColumnText;else if(d===c.linkCommentColumnName)b=a.LinksControlCommentColumnText;else if(d===c.linkTypeColumnName)b=a.LinksControlLinkTypeColumnText;else if(d===c.linkImageColumnName)b="";else b=this._getFieldColumnText.call(this,d,e);return b};c.prototype._getFieldColumnText=function(d,c){var a="",b=c.getFieldDefinition(d);if(b)a=b.name;return a};c.prototype._getColumnWidth=function(b,d){var a=c.defaultColumnWidth;if(b===c.linkImageColumnName)a=c.defaultImageColumnWidth;else if(b===c.linkDescriptionColumnName)a=c.defaultColumnWidth*3;else a=c.getFieldColumnWidth(b,d);return a};c.prototype._prepareSortColumns=function(){};c.defaultImageColumnWidth=18;c.defaultColumnWidth=75;c.defaultDateTimeColumnWidth=120;c.defaultDoubleColumnWidth=75;c.defaultIdColumnWidth=70;c.defaultIntegerColumnWidth=50;c.defaultLinkTypeColumnWidth=80;c.defaultStringColumnWidth=75;c.defaultTagColumnWidth=200;c.defaultTitleColumnWidth=450;c.defaultTreePathColumnWidth=300;c.linkImageColumnName="System.LinksControl.ImageColumn";c.linkDescriptionColumnName="System.Links.Description";c.linkCommentColumnName="System.Links.Comment";c.linkTypeColumnName="System.Links.LinkType";return c}();c.LinkColumnHelper=y;h.initClassPrototype(y,{_options:null,_displayColumns:null,_sortColumns:null});var l=function(){function a(a){e.assert(a.workItem instanceof d.WorkItem,"options.workItem should be of type TFS.WIT.OM.WorkItem");this._workItem=a.workItem}a.prototype.isMyLinkType=function(){return false};a.prototype.getCacheKey=function(){return null};a.prototype.resetDuplicateCache=function(){this._duplicateCache=null};a.prototype.isDuplicate=function(a){this._ensureDuplicateCache();return(""+a).toLocaleUpperCase()in this._duplicateCache};a.prototype._ensureDuplicateCache=function(){if(!this._duplicateCache)this._duplicateCache=this._createDuplicateCache()};a.prototype._createDuplicateCache=function(){var d={},a,f,b,c,e=this._workItem.getLinks();for(a=0,f=e.length;a<f;a++){b=e[a];if(this.isMyLinkType(b)){c=this.getCacheKey(b);if(c)d[(""+c).toLocaleUpperCase()]=true}}return d};return a}();c.LinkValidator=l;h.initClassPrototype(l,{_workItem:null,_duplicateCache:null});var K=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.isMyLinkType=function(a){return a instanceof d.Hyperlink};a.prototype.getCacheKey=function(a){return a.getLocation()};return a}(l),o=function(b){__extends(a,b);function a(a){b.call(this,a)}a.isValidUncPath=function(a){e.assertIsNotNull(a,"UNC path is null");return this._uncPathRegex.test(a)};a.isValidHttpUrl=function(a){e.assertIsNotNull(a,"URL is null");return this._httpUrlRegex.test(a)};a.isValidFileUrl=function(a){e.assertIsNotNull(a,"URL is null");return this._fileUrlRegex.test(a)};a.isValidStoryboardPath=function(a){e.assertIsNotNull(a,"Storyboard link is null");return this.isValidUncPath(a)||this.isValidFileUrl(a)||this.isValidHttpUrl(a)};a.normalizeNetworkFilePathToFileUrl=function(a){e.assertIsNotNull(a,"path is null");if(this.isValidUncPath(a))a=a.replace(/^\\\\/,this.SAFE_FILE_SCHEME).replace(/\\/g,"/");else if(this.isValidFileUrl(a))a=a.replace(/^file:(\/|\\)+/i,this.SAFE_FILE_SCHEME).replace(/\\/g,"/");return a};a.prototype.isMyLinkType=function(a){return a instanceof d.ExternalLink};a.prototype.getCacheKey=function(b){var a=z.decodeUri(b.getLinkedArtifactUri());return a&&a.type===m.ArtifactTypeNames.Storyboard&&a.tool===m.ToolNames.Requirements?a.id:null};a._uncPathRegex=/^(\\{2})([^<>:"\/\\|?*]+)(\\)([^<>:"\/\\|?*]+[$$]?(\\)?)/i;a._httpUrlRegex=/^((http|https):\/\/)([^<>:"\/\\|?*]+)(:(6553[0-5]|655[0-2]\d|65[0-4]\d{2}|6[0-4]\d{3}|[1-5]\d{4}|[1-9]\d{0,3}))?[\/\\]([^<>:"\/\\|?*]+)/i;a._fileUrlRegex=/^file:(.+)/i;a.SAFE_FILE_SCHEME="file://///";return a}(l);c.StoryboardLinkValidator=o;var I=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.isMyLinkType=function(a){return a instanceof d.ExternalLink};a.prototype.getCacheKey=function(a){return a.getLinkedArtifactUri()};return a}(l);c.ExternalLinkValidator=I;var t=function(b){__extends(a,b);function a(a){b.call(this,a);this._linkTypeEnd=a.linkTypeEnd;this._parentCount=0}a.prototype.isMyLinkType=function(a){return a instanceof d.WorkItemLink&&a.getLinkTypeEnd().immutableName===this._linkTypeEnd.immutableName};a.prototype.getCacheKey=function(a){return a.getTargetId()};a.prototype.beginParentCount=function(){this._parentCount=0};a.prototype.getParentCount=function(){return this._parentCount};a.prototype.setLinkTypeEnd=function(a){if(this._linkTypeEnd!==a){this._linkTypeEnd=a;this.resetDuplicateCache();this.beginParentCount()}};a.prototype.isSelf=function(a){return this._workItem.id===a};a.prototype.isMultipleParent=function(){if(this._linkTypeEnd!==null&&this._linkTypeEnd.topology==="Tree"&&!this._linkTypeEnd.isForward)this._parentCount+=1;return this._parentCount>1};return a}(l);h.initClassPrototype(t,{_linkTypeEnd:null,_parentCount:null});function M(b,a){c.registerLinkFormAsnyc(b,function(b){b(a)})}c.registerLinkForm=M;function J(a,b){a=a.toUpperCase();E[a]=b}c.registerLinkFormAsnyc=J;function L(b,c){var a;b=b.toUpperCase();a=E[b];if(a)a(c);else c(null)}var g=function(c){__extends(b,c);function b(a){c.call(this,a);e.assert(a.workItem instanceof d.WorkItem,"options.workItem should be of type TFS.WIT.OM.WorkItem");this._workItem=a.workItem}b.createTitleElement=function(c,a){var b=$("<label/>").text(c);a&&b.attr("for",a);return b};b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"link-dialog-form"},a))};b.prototype._createComment=function(){this._element.append(b.createTitleElement(a.LinkDialogCommentTitle));this._element.append($("<input>").attr("type","text").addClass("textbox").attr("id","comment").css("width","100%"))};b.prototype.getComment=function(){return $.trim(this._element.find("#comment").val())};b.prototype.getLinkResult=function(){return null};b.prototype.unload=function(){this.dispose();this._workItem=null;this._validator=null};return b}(j.BaseControl);c.LinkForm=g;h.initClassPrototype(g,{_workItem:null,_validator:null});var C=function(c){__extends(b,c);function b(a){c.call(this,a);this._validator=new K(a)}b.prototype.initialize=function(){c.prototype.initialize.call(this);this._element.append(g.createTitleElement(a.LinkDialogHyperlinkAddressTitle));this.$address=$("<input>").attr("type","text").addClass("textbox").attr("id","address").css("width","100%").appendTo(this._element);this._createComment();this._element.trigger("buttonStatusChange",[{enabled:true}])};b.prototype.getLinkResult=function(){var c,b=$.trim(this.$address.val());if(!b.length)alert(a.LinksControlEnterUrl);else if(this._validator.isDuplicate(b))alert(a.LinksControlDuplicateHyperlink);else if(!F.urlHelper.isSafeProtocol(b))alert(a.LinksControlUnsafeUrl);else c={linkType:"Hyperlink",comment:this.getComment(),links:[{location:b}]};return c};return b}(g);h.initClassPrototype(C,{$address:null});c.registerLinkForm(f.RegisteredLinkTypeHyperlink,C);var O=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initialize=function(){c.prototype.initialize.call(this);$("<p class='test-result'/>").text(a.LinkFormTestResultMessage).appendTo(this._element)};return b}(g);c.registerLinkForm(f.RegisteredLinkTypeTestResult,O);var G=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initialize=function(){c.prototype.initialize.call(this);$("<p class='test-result'/>").text(a.LinkFormResultAttachmentMessage).appendTo(this._element)};return b}(g);c.registerLinkForm(f.RegisteredLinkTypeResultAttachment,G);var w=function(d){__extends(c,d);function c(a){d.call(this,a);this._validator=new o(a)}c.prototype.initialize=function(){d.prototype.initialize.call(this);this._element.append(g.createTitleElement(a.LinkDialogStoryboardLinkAddressTitle));this.$address=$("<input>").attr("type","text").addClass("textbox").attr("id","address").css("width","100%").appendTo(this._element);this.$address.focus();this._createComment();this._element.trigger("buttonStatusChange",[{enabled:true}])};c.prototype.getLinkResult=function(){var d,c=$.trim(this.$address.val());if(!c.length)alert(a.LinksControlEnterStoryboardUrl);else if(this._validator.isDuplicate(c))alert(b.StringUtils.format(a.LinksControlDuplicateStoryboard,c));else if(!o.isValidStoryboardPath(c))alert(b.StringUtils.format(a.StoryboardLinkInvalid,c));else d={linkType:f.RegisteredLinkTypeStoryboard,comment:this.getComment(),links:[{artifactUri:z.encodeUri({tool:m.ToolNames.Requirements,type:m.ArtifactTypeNames.Storyboard,id:c})}]};return d};return c}(g);h.initClassPrototype(w,{$address:null});c.registerLinkForm(f.RegisteredLinkTypeStoryboard,w);function u(a){return a.$descriptionArea.empty()}function D(b,a){b._apiError=a;u(b).append($("<li />").addClass("duplicate").text(a))}function p(f,e){var d,c;d=f._element.find("#wi_"+e);if(!d.length)d=$("<li />").attr("id","wi_"+e).appendTo(f.$descriptionArea);d.removeAttr("class");c=f._workItemCache[e];if(c)if(c.duplicate){c.text=b.StringUtils.format(a.LinksFormDuplicateWorkItemLink,e);d.addClass("duplicate")}else if(c.notFound){c.text=b.StringUtils.format(a.LinkFormWorkItemNotFound,e);d.addClass("notfound")}else if(c.selfLink){c.text=b.StringUtils.format(a.LinksControlSelfWorkItemLink,e);d.addClass("selflink")}else if(c.filtered){c.text=b.StringUtils.format(a.LinksControlWorkItemTypeFiltered,e);d.addClass("filtered")}else c.text=b.StringUtils.format(a.LinkFormWorkItemDetails,c[1],c[0],c[2],c[3]);else{c={text:b.StringUtils.format(a.LinksControlFetchingWorkItem,e)};d.addClass("fetching")}d.text(c.text)}var A=function(d){__extends(c,d);function c(a){d.call(this,a);this._multipleTarget=a.multipleTarget===true}c.prototype.initialize=function(){var b=this._element;d.prototype.initialize.call(this);this._workItemCache={};this._validator=new t(this._options);b.append(g.createTitleElement(a.LinkDialogWorkItemIdsTitle));this.$ids=$("<input>").attr("type","text").addClass("textbox").attr("id","work-item-ids").css("width","100%").appendTo(b).bind("mouseup keyup",r(this,this._onIdChange));this.$descriptionArea=$("<ul>").attr("id","description").addClass("link-dialog-workitem-description").appendTo(b);this._linkVisualization=j.BaseControl.createIn(x,b);this._createComment();this._element.trigger("buttonStatusChange",[{enabled:true}])};c.prototype.linkTypeChanged=function(a){if(a!==this._currentLinkType){this._currentLinkType=a;this._currentLinkTypeInfo=this._getLinkTypeInfo(a);this._validator.setLinkTypeEnd(this._currentLinkTypeInfo);this._updateLinkVisualization();this._element.find("input[id='work-item-ids']").trigger("change")}};c.prototype.getLinkResult=function(){var i,c="",d,g,h,f,j=this._workItemCache,e=this._validIds||[];if(this.$ids.attr("validating")==="true")c=a.LinkFormValidationInProgress;if(!c.length&&this._apiError&&this._apiError.length)c=this._apiError;if(!c.length&&!e.length)c=a.LinkFormNoWorkItemSpecified;if(!c.length&&this._validator.getParentCount()>1)c=b.StringUtils.format(a.LinkDialogMultipleParentsNotAllowed,this._currentLinkType);if(!c.length){f=[];for(d=0,g=e.length;d<g;d++){h=j[e[d]];if(h.invalid){c=h.text;break}f.push({id:e[d]})}if(d===g)i={linkType:"WorkItemLink",linkTypeEnd:this._currentLinkTypeInfo,comment:this.getComment(),links:f}}c.length&&alert(c);return i};c.prototype.unload=function(){d.prototype.unload.call(this);this._workItemCache=null;this._validIds=null;this._linkVisualization.dispose();this.$descriptionArea.remove();this.$descriptionArea=null};c.prototype._getTargetText=function(){var c=this._workItem;if(!this._workItemText)if(c.id===0)this._workItemText=b.StringUtils.format(a.LinkFormNewWorkItemDetails,c.workItemType.name,c.getTitle());else this._workItemText=b.StringUtils.format(a.LinkFormWorkItemDetails,c.workItemType.name,c.id,c.getState(),c.getTitle());return this._workItemText};c.prototype._getLinkTypeInfo=function(b){var c=this._workItem,a=c.store.findLinkTypeEnd(b);return{immutableName:a.immutableName,topology:a.linkType.topology,isForward:a.isForwardLink}};c.prototype._disableLinkVisualization=function(){this._linkVisualization.disable()};c.prototype._updateLinkVisualization=function(){var e=this._validIds,h=this._workItemCache,g=true,b,c,d=0,f=a.LinkDialogNoItemsSelected;if(e)for(c=0,d=e.length;c<d;c++){b=h[e[c]];if(b){if(c===0)f=b.text;if(b&&b.invalid===true){g=false;break}}}if(d>1)f=a.LinkDialogMultipleWorkItemsSelected;if(g)this._linkVisualization.update(this._currentLinkTypeInfo.topology,this._currentLinkTypeInfo.isForward,d>1,this._multipleTarget,f,this._getTargetText());else this._disableLinkVisualization()};c.prototype._onIdChange=function(){var a=this.$ids,b=$.trim(a.val());this.cancelDelayedFunction("onIdChange");if(b.length){a.attr("validating","true");this.delayExecute("onIdChange",500,true,function(){this._validateWorkItems(a,b)})}else this._validateWorkItems(a,"")};c.prototype._validateWorkItems=function(s,q){var f=this,l,n,c,g=[],o=this._validIds=[],e=[],d=this._workItemCache,m=this._options.workItemTypeFilters?new k(this._options):null,r=this._workItem.project.name.toLocaleUpperCase(),h=true,i=this._validator;function j(a){if(!a)f._disableLinkVisualization();else f._updateLinkVisualization();s.attr("validating","false")}this._apiError=null;i.beginParentCount();u(this);$.each(q.split(","),function(b,a){a=isNaN(a)?0:parseInt(a,10);a>0&&g.push(a)});g=b.ArrayUtils.unique(g);for(l=0,n=g.length;l<n;l++){c=g[l];if(c){o.push(c);if(!(c in d))if(i.isSelf(c))d[c]={selfLink:true,invalid:true};else if(i.isDuplicate(c))d[c]={duplicate:true,invalid:true};else e.push(c);if(i.isMultipleParent()){j(false);D(f,b.StringUtils.format(a.LinkDialogMultipleParentsNotAllowed,this._currentLinkType));return}h=h&&(!(c in d)||d[c].invalid!==true);p(this,c)}}if(e.length)this._workItem.store.beginPageWorkItems(e,["System.Id","System.WorkItemType","System.State","System.Title","System.TeamProject"],function(a){$.each(a.rows,function(b,a){e.splice($.inArray(a[0],e),1);d[a[0]]=a;if(m&&m.isWitFilteredOut(a[1],r!==a[4].toLocaleUpperCase())){d[a[0]]={filtered:true,invalid:true};h=false}p(f,a[0])});$.each(e,function(b,a){d[a]={notFound:true,invalid:true};p(f,a)});j(h&&e.length===0)},function(a){D(f,a&&a.message||"Unknown error");j(false)});else j(h&&g.length>0)};return c}(g);h.initClassPrototype(A,{_workItemCache:null,_validIds:null,_multipleTarget:null,_workItemText:null,_linkVisualization:null,_currentLinkType:null,_currentLinkTypeInfo:null,_apiError:null,$ids:null,$descriptionArea:null});c.registerLinkForm("WorkItemLink",A);var n=function(f){__extends(c,f);function c(a){f.call(this,a);e.assert(a.workItem instanceof d.WorkItem,"options.workItem should be of type TFS.WIT.OM.WorkItem");this._workItem=a.workItem;this._multipleTarget=a.multipleTarget===true}c.prototype.initializeOptions=function(a){f.prototype.initializeOptions.call(this,$.extend({resizable:false,width:490,cssClass:"link-dialog"},a))};c.prototype.getLastSelectedLinkType=function(){return""};c.prototype.setLastSelectedLinkType=function(){};c.prototype.getInitialFocusElement=function(){var a=$("input:not([disabled])",this._element);e.assertIsObject(a,"no enabled inputs found on the page.");return a};c.prototype.initialize=function(){var a=this,b;function c(c){a._preferences=c;a._decorate();a._populateLinkTypes();b=a.getInitialFocusElement();a.setFormFocusDelayed(b)}f.prototype.initialize.call(this);s.Preferences.beginGetPreferenceStore(this._options.tfsContext,8,i.PREFERENCE_NAME,c,c)};c.prototype._loadForm=function(b,a){$.isFunction(a)&&a.call(this)};c.prototype._unloadForm=function(){if(this._currentForm){this._currentForm.unload();this._currentForm=null}this.$formContainer&&this.$formContainer.empty()};c.prototype._unloadLinkDialog=function(){this._unloadForm();this._workItem=null;this._validLinkTypes=null};c.prototype.onLinkTypeChange=function(b){var c=this,a;if(b>=0){a=this._validLinkTypes[b];this._loadForm(a,function(){c._fireLinkTypeChanged(a)})}else this._unloadForm()};c.prototype.onClose=function(a){this._unloadLinkDialog();f.prototype.onClose.call(this,a)};c.prototype._decorate=function(){var c=this._element,b;c.append($("<p/>").text(a.LinkToExistingDialogDescription));b=$("<div/>").appendTo(c).addClass("link-types-container");b.append($("<label/>").text(a.LinkToExistingDialogLinkTypeTitle));this.$linkTypes=j.BaseControl.createIn(q.Combo,b,{allowEdit:false,indexChanged:r(this,this.onLinkTypeChange)});this.$formContainer=$("<div />").addClass("link-dialog-form-container").appendTo(c)};c.prototype._getRegisteredLinkTypes=function(){return[]};c.prototype._getWorkItemLinkTypes=function(){return[]};c.prototype._populateLinkTypes=function(){var c=this,d=this._workItem,a=[];d.store.beginGetLinkTypes(function(h,g){var d,f;a=a.concat(c._getRegisteredLinkTypes(g));a=a.concat(c._getWorkItemLinkTypes(h));c._validLinkTypes=a||[];if(a.length){a.sort(b.StringUtils.localeIgnoreCaseComparer);c.$linkTypes.setSource(a);f=c.getLastSelectedLinkType();if(f&&$.inArray(f,a)>=0)d=f;else d=a[0];c.$linkTypes.setText(d);c._loadForm(d,function(){c._fireLinkTypeChanged(d)})}e.logTracePoint("LinkDialog._populateLinkTypes.complete")})};c.prototype._fireLinkTypeChanged=function(a){this._currentForm&&$.isFunction(this._currentForm.linkTypeChanged)&&this._currentForm.linkTypeChanged(a)};return c}(q.ModalDialog);c.LinkDialog=n;h.initClassPrototype(n,{_preferences:null,_workItem:null,_multipleTarget:null,$formContainer:null,$linkTypes:null,_currentForm:null,_validLinkTypes:null});var v=function(d){__extends(c,d);function c(a){d.call(this,a);this._rawOptions=a}c.prototype.getTitle=function(){var d="",c=this._workItem;if(c)if(this._multipleTarget)d=a.LinkToExistingDialogTitleMultiple;else if(c.id===0)d=b.StringUtils.format(a.LinkToExistingDialogTitleNew,c.workItemType.name,c.getTitle());else d=b.StringUtils.format(a.LinkToExistingDialogTitle,c.workItemType.name,c.id,c.getTitle());return d};c.prototype.getLastSelectedLinkType=function(){return this._preferences.getValue(i.LAST_SELECTED_LINK_TYPE_EXISTING)};c.prototype.setLastSelectedLinkType=function(){return this._preferences.setValue(i.LAST_SELECTED_LINK_TYPE_EXISTING,$.trim(this.$linkTypes.getText()))};c.prototype.getDialogResult=function(){if(this._currentForm){this.setLastSelectedLinkType();return this._currentForm.getLinkResult()}};c.prototype._unloadForm=function(){d.prototype._unloadForm.call(this);this._currentFormName=null};c.prototype._unloadLinkDialog=function(){d.prototype._unloadLinkDialog.call(this);this._linkFormNames=null;this._linkTypeNames=null};c.prototype._ensureFormHash=function(){if(!this._linkFormNames)this._linkFormNames={};if(!this._linkTypeNames)this._linkTypeNames={}};c.prototype._getRegisteredLinkTypes=function(d){var b=this,a=[],e=this._workItem,c=new k(this._options);this._ensureFormHash();$.each(d,function(h,d){var g=f.getRegisteredLinkName(d);if(d!==f.RegisteredLinkTypeRelated&&!c.isLinkTypeFilteredOut(d,false,e.store)){a.push(g);b._linkFormNames[g]=d;b._linkTypeNames[g]=d}});return a};c.prototype._getWorkItemLinkTypes=function(){var d=this,b=[],a,c=this._workItem,e=new k(this._options);a=e.getValidLinkTypesForWorkItem(c);this._ensureFormHash();$.each(a,function(f,e){var a=c.store.findLinkTypeEnd(e);b.push(a.name);d._linkFormNames[a.name]="WorkItemLink";d._linkTypeNames[a.name]=a.immutableName});return b};c.prototype._loadForm=function(g,f){var c=this,d=this._linkFormNames[g];function h(a){a._unloadForm();a.updateOkButton(false)}function e(){$.isFunction(f)&&f.call(this)}if(d!==this._currentFormName)L(d,function(f){var i;h(c);if(f){i=$.extend({workItem:c._workItem},$.extend(c._rawOptions,{width:"100%"}));c._currentForm=j.BaseControl.createIn(f,c.$formContainer,i);c._currentFormName=d}else c.$formContainer.append($("<p/>").text(b.StringUtils.format(a.LinkToExistingDialogFormNotFound,g)));e()});else e()};c._typeName="LinkToExistingDialog";return c}(n);c.LinkToExistingDialog=v;h.initClassPrototype(v,{_linkFormNames:null,_linkTypeNames:null,_currentFormName:null});var B=function(f){__extends(c,f);function c(a){f.call(this,a);e.assert(a.workItem instanceof d.WorkItem,"options.workItem should be of type TFS.WIT.OM.WorkItem");this._workItem=a.workItem;this._multipleTarget=a.multipleTarget===true}c.prototype.initializeOptions=function(a){f.prototype.initializeOptions.call(this,$.extend({coreCssClass:"link-dialog-form"},a))};c.prototype.getLastSelectedWorkItemType=function(){return this._options.preferences.getValue(i.LAST_SELECTED_WORK_ITEM_TYPE)};c.prototype.setLastSelectedWorkItemType=function(){return this._options.preferences.setValue(i.LAST_SELECTED_WORK_ITEM_TYPE,$.trim(this.$workItemTypes.getText()))};c.prototype.initialize=function(){f.prototype.initialize.call(this);this._element.append(g.createTitleElement(a.NewLinkedWorkItemTypeTitle));this.$workItemTypes=j.BaseControl.createIn(q.Combo,this._element,{allowEdit:false});this._element.append(g.createTitleElement(a.NewLinkedWorkItemTitle));this._element.append($("<input />").attr("type","text").addClass("textbox").addClass("initial-focus").attr("id","dialog-label").css("width","100%").bind("change",r(this,this._onTitleChange)));this.$description=$("<div />").attr("id","description").addClass("message");this._element.append(this.$description);this._linkVisualization=j.BaseControl.createIn(x,this._element);this._createComment();this._populateWits()};c.prototype.linkTypeChanged=function(a){if(a!==this._currentLinkType){this._currentLinkType=a;this._currentlinkTypeInfo=this._getLinkTypeInfo(a);this._updateLinkVisualization()}};c.prototype.getWorkItemResult=function(){return{linkTypeEnd:this._currentLinkType,workItemType:this.$workItemTypes.getText(),title:$.trim(this._element.find("#dialog-label").val()),comment:$.trim(this._element.find("#comment").val())}};c.prototype._createComment=function(){this._element.append(g.createTitleElement(a.LinkDialogCommentTitle));this._element.append($("<input>").attr("type","text").addClass("textbox").attr("id","comment").css("width","100%"))};c.prototype.unload=function(){this.$workItemTypes.dispose();this.$workItemTypes=null;this.$description.remove();this.$description=null;this._workItem=null;this._workItemText=null;this._linkVisualization=null;this._currentLinkType=null;this._linkTypeInfo=null;this.dispose()};c.prototype._onTitleChange=function(){this._updateLinkVisualization()};c.prototype._getLinkTypeInfo=function(b){var c=this._workItem,a=c.store.findLinkTypeEnd(b);return{topology:a.linkType.topology,isForward:a.isForwardLink}};c.prototype._updateLinkVisualization=function(){var c=$.trim($("input[id='title']").val()),d=c?b.StringUtils.format(a.LinkDialogNewWorkItemWithType,this.$workItemTypes.getText(),c):a.LinkDialogNewWorkItem;this._linkVisualization.update(this._currentlinkTypeInfo.topology,this._currentlinkTypeInfo.isForward,false,this._multipleTarget,d,this._getTargetText())};c.prototype._populateWits=function(){var b=this,d,c,e=new k(this._options);e.getValidWitsForProject(this._workItem.project,function(e){if(e.length){b.$workItemTypes.setSource(e);c=b.getLastSelectedWorkItemType();if(c&&$.inArray(c,e)>=0)d=c;else d=e[0];b.$workItemTypes.setText(d);b._element.trigger("buttonStatusChange",[{enabled:true}])}else b.$description.text(a.LinkDialogErrorWorkItemTypesToAdd)})};c.prototype._getTargetText=function(){var c=this._workItem;if(!this._workItemText)this._workItemText=b.StringUtils.format(a.LinkFormWorkItemDetails,c.workItemType.name,c.id,c.getState(),c.getTitle());return this._workItemText};return c}(j.BaseControl);h.initClassPrototype(B,{_workItem:null,_multipleTarget:null,$workItemTypes:null,$description:null,_workItemText:null,_linkVisualization:null,_currentLinkType:null,_linkTypeInfo:null,_currentlinkTypeInfo:null});var H=function(d){__extends(c,d);function c(a){d.call(this,a)}c.prototype.getTitle=function(){var d="",c=this._workItem;if(c)if(this._multipleTarget)d=a.NewLinkedWorkItemTitleMultiple;else d=b.StringUtils.format(a.NewLinkedWorkItemDialogTitle,c.workItemType.name,c.id,c.getTitle());return d};c.prototype.getLastSelectedLinkType=function(){return this._preferences.getValue(i.LAST_SELECTED_LINK_TYPE_NEW)};c.prototype.setLastSelectedLinkType=function(){return this._preferences.setValue(i.LAST_SELECTED_LINK_TYPE_NEW,$.trim(this.$linkTypes.getText()))};c.prototype.getInitialFocusElement=function(){var a=$("input.initial-focus:not([disabled])",this._element);e.assertIsObject(a,"no enabled inputs marked for initial-focus found on the page.");return a};c.prototype.getDialogResult=function(){this.setLastSelectedLinkType();this._currentForm.setLastSelectedWorkItemType();return this._currentForm.getWorkItemResult()};c.prototype._getWorkItemLinkTypes=function(){var b=[],a,d=new k(this._options),c=this._workItem,e=this._multipleTarget;a=d.getValidLinkTypesForWorkItem(c);$.each(a,function(f,d){var a=c.store.findLinkTypeEnd(d);(!e||a.linkType.topology!=="Tree"||!a.isForwardLink)&&b.push(a.name)});return b};c.prototype._loadForm=function(c,b){var a;if(!this._currentForm){a=$.extend($.extend({workItem:this._workItem,preferences:this._preferences},this._options),{width:"100%"});this._currentForm=j.BaseControl.createIn(B,this.$formContainer,a)}$.isFunction(b)&&b.call(this)};c._typeName="NewLinkedWorkItemDialog";return c}(n);c.NewLinkedWorkItemDialog=H;h.tfsModuleLoaded("TFS.WorkItemTracking.Linking",c)});
// SIG // Begin signature block
// SIG // MIIaywYJKoZIhvcNAQcCoIIavDCCGrgCAQExCzAJBgUr
// SIG // DgMCGgUAMGcGCisGAQQBgjcCAQSgWTBXMDIGCisGAQQB
// SIG // gjcCAR4wJAIBAQQQEODJBs441BGiowAQS9NQkAIBAAIB
// SIG // AAIBAAIBAAIBADAhMAkGBSsOAwIaBQAEFH0EBSSW72uC
// SIG // P1LpomwQW000CiSEoIIVgjCCBMMwggOroAMCAQICEzMA
// SIG // AABMoehNzLR0ezsAAAAAAEwwDQYJKoZIhvcNAQEFBQAw
// SIG // dzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0
// SIG // b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1p
// SIG // Y3Jvc29mdCBDb3Jwb3JhdGlvbjEhMB8GA1UEAxMYTWlj
// SIG // cm9zb2Z0IFRpbWUtU3RhbXAgUENBMB4XDTEzMTExMTIy
// SIG // MTEzMVoXDTE1MDIxMTIyMTEzMVowgbMxCzAJBgNVBAYT
// SIG // AlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQH
// SIG // EwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29y
// SIG // cG9yYXRpb24xDTALBgNVBAsTBE1PUFIxJzAlBgNVBAsT
// SIG // Hm5DaXBoZXIgRFNFIEVTTjpDMEY0LTMwODYtREVGODEl
// SIG // MCMGA1UEAxMcTWljcm9zb2Z0IFRpbWUtU3RhbXAgU2Vy
// SIG // dmljZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
// SIG // ggEBALHY+hsGK3eo5JRdfA/meqaS7opUHaT5hHWFl8zL
// SIG // XJbQ13Ut2Qj7W9LuLSXGNz71q34aU+VXvmvov8qWCtxG
// SIG // 8VoePgLSsuAmjgBke748k/hYMnmH0hpdI7ycUcQPEPoE
// SIG // WLUWdm7svMblvvytrMFB26rOefUcsplBp3olK/+reA1Y
// SIG // OrFeUN5kTODKFSrfpun+pGYvWxAJCSYh1D8NL23S+HeQ
// SIG // A2zeFBKljOc2H/SHpbBBF2/jTXRmwv2icUY1UcxrF1Fj
// SIG // +hWUkppfSyi65hZFSekstf6Lh6/8pW1D3KYw+iko75sN
// SIG // LFyD3hKNarTbce9cFFoqIyj/gXBX8YwHmhPYKlMCAwEA
// SIG // AaOCAQkwggEFMB0GA1UdDgQWBBS5Da2zTfTanxqyJyZV
// SIG // DSBE2Jji9DAfBgNVHSMEGDAWgBQjNPjZUkZwCu1A+3b7
// SIG // syuwwzWzDzBUBgNVHR8ETTBLMEmgR6BFhkNodHRwOi8v
// SIG // Y3JsLm1pY3Jvc29mdC5jb20vcGtpL2NybC9wcm9kdWN0
// SIG // cy9NaWNyb3NvZnRUaW1lU3RhbXBQQ0EuY3JsMFgGCCsG
// SIG // AQUFBwEBBEwwSjBIBggrBgEFBQcwAoY8aHR0cDovL3d3
// SIG // dy5taWNyb3NvZnQuY29tL3BraS9jZXJ0cy9NaWNyb3Nv
// SIG // ZnRUaW1lU3RhbXBQQ0EuY3J0MBMGA1UdJQQMMAoGCCsG
// SIG // AQUFBwMIMA0GCSqGSIb3DQEBBQUAA4IBAQAJik4Gr+jt
// SIG // gs8dB37XKqckCy2vmlskf5RxDFWIJBpSFWPikE0FSphK
// SIG // nPvhp21oVYK5KeppqbLV4wza0dZ6JTd4ZxwM+9spWhqX
// SIG // OCo5Vkb7NYG55D1GWo7k/HU3WFlJi07bPBWdc1JL63sM
// SIG // OsItwbObUi3gNcW5wVez6D2hPETyIxYeCqpZNyfQlVJe
// SIG // qH8/VPCB4dyavWXVePb3TDm73eDWNw6RmoeMc+dxZFL3
// SIG // PgPYxs1yuDQ0mFuM0/UIput4xlGgDQ5v9Gs8QBpgFiyp
// SIG // BlKdHBOQzm8CHup7nLP2+Jdg8mXR0R+HOsF18EKNeu2M
// SIG // crJ7+yyKtJFHVOIuacwWVBpZMIIE7DCCA9SgAwIBAgIT
// SIG // MwAAAMps1TISNcThVQABAAAAyjANBgkqhkiG9w0BAQUF
// SIG // ADB5MQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGlu
// SIG // Z3RvbjEQMA4GA1UEBxMHUmVkbW9uZDEeMBwGA1UEChMV
// SIG // TWljcm9zb2Z0IENvcnBvcmF0aW9uMSMwIQYDVQQDExpN
// SIG // aWNyb3NvZnQgQ29kZSBTaWduaW5nIFBDQTAeFw0xNDA0
// SIG // MjIxNzM5MDBaFw0xNTA3MjIxNzM5MDBaMIGDMQswCQYD
// SIG // VQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4G
// SIG // A1UEBxMHUmVkbW9uZDEeMBwGA1UEChMVTWljcm9zb2Z0
// SIG // IENvcnBvcmF0aW9uMQ0wCwYDVQQLEwRNT1BSMR4wHAYD
// SIG // VQQDExVNaWNyb3NvZnQgQ29ycG9yYXRpb24wggEiMA0G
// SIG // CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCWcV3tBkb6
// SIG // hMudW7dGx7DhtBE5A62xFXNgnOuntm4aPD//ZeM08aal
// SIG // IV5WmWxY5JKhClzC09xSLwxlmiBhQFMxnGyPIX26+f4T
// SIG // UFJglTpbuVildGFBqZTgrSZOTKGXcEknXnxnyk8ecYRG
// SIG // vB1LtuIPxcYnyQfmegqlFwAZTHBFOC2BtFCqxWfR+nm8
// SIG // xcyhcpv0JTSY+FTfEjk4Ei+ka6Wafsdi0dzP7T00+Lnf
// SIG // NTC67HkyqeGprFVNTH9MVsMTC3bxB/nMR6z7iNVSpR4o
// SIG // +j0tz8+EmIZxZRHPhckJRIbhb+ex/KxARKWpiyM/gkmd
// SIG // 1ZZZUBNZGHP/QwytK9R/MEBnAgMBAAGjggFgMIIBXDAT
// SIG // BgNVHSUEDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQUH17i
// SIG // XVCNVoa+SjzPBOinh7XLv4MwUQYDVR0RBEowSKRGMEQx
// SIG // DTALBgNVBAsTBE1PUFIxMzAxBgNVBAUTKjMxNTk1K2I0
// SIG // MjE4ZjEzLTZmY2EtNDkwZi05YzQ3LTNmYzU1N2RmYzQ0
// SIG // MDAfBgNVHSMEGDAWgBTLEejK0rQWWAHJNy4zFha5TJoK
// SIG // HzBWBgNVHR8ETzBNMEugSaBHhkVodHRwOi8vY3JsLm1p
// SIG // Y3Jvc29mdC5jb20vcGtpL2NybC9wcm9kdWN0cy9NaWND
// SIG // b2RTaWdQQ0FfMDgtMzEtMjAxMC5jcmwwWgYIKwYBBQUH
// SIG // AQEETjBMMEoGCCsGAQUFBzAChj5odHRwOi8vd3d3Lm1p
// SIG // Y3Jvc29mdC5jb20vcGtpL2NlcnRzL01pY0NvZFNpZ1BD
// SIG // QV8wOC0zMS0yMDEwLmNydDANBgkqhkiG9w0BAQUFAAOC
// SIG // AQEAd1zr15E9zb17g9mFqbBDnXN8F8kP7Tbbx7UsG177
// SIG // VAU6g3FAgQmit3EmXtZ9tmw7yapfXQMYKh0nfgfpxWUf
// SIG // tc8Nt1THKDhaiOd7wRm2VjK64szLk9uvbg9dRPXUsO8b
// SIG // 1U7Brw7vIJvy4f4nXejF/2H2GdIoCiKd381wgp4Yctgj
// SIG // zHosQ+7/6sDg5h2qnpczAFJvB7jTiGzepAY1p8JThmUR
// SIG // dwmPNVm52IaoAP74MX0s9IwFncDB1XdybOlNWSaD8cKy
// SIG // iFeTNQB8UCu8Wfz+HCk4gtPeUpdFKRhOlludul8bo/En
// SIG // UOoHlehtNA04V9w3KDWVOjic1O1qhV0OIhFeezCCBbww
// SIG // ggOkoAMCAQICCmEzJhoAAAAAADEwDQYJKoZIhvcNAQEF
// SIG // BQAwXzETMBEGCgmSJomT8ixkARkWA2NvbTEZMBcGCgmS
// SIG // JomT8ixkARkWCW1pY3Jvc29mdDEtMCsGA1UEAxMkTWlj
// SIG // cm9zb2Z0IFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5
// SIG // MB4XDTEwMDgzMTIyMTkzMloXDTIwMDgzMTIyMjkzMlow
// SIG // eTELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0
// SIG // b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1p
// SIG // Y3Jvc29mdCBDb3Jwb3JhdGlvbjEjMCEGA1UEAxMaTWlj
// SIG // cm9zb2Z0IENvZGUgU2lnbmluZyBQQ0EwggEiMA0GCSqG
// SIG // SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCycllcGTBkvx2a
// SIG // YCAgQpl2U2w+G9ZvzMvx6mv+lxYQ4N86dIMaty+gMuz/
// SIG // 3sJCTiPVcgDbNVcKicquIEn08GisTUuNpb15S3GbRwfa
// SIG // /SXfnXWIz6pzRH/XgdvzvfI2pMlcRdyvrT3gKGiXGqel
// SIG // cnNW8ReU5P01lHKg1nZfHndFg4U4FtBzWwW6Z1KNpbJp
// SIG // L9oZC/6SdCnidi9U3RQwWfjSjWL9y8lfRjFQuScT5EAw
// SIG // z3IpECgixzdOPaAyPZDNoTgGhVxOVoIoKgUyt0vXT2Pn
// SIG // 0i1i8UU956wIAPZGoZ7RW4wmU+h6qkryRs83PDietHdc
// SIG // pReejcsRj1Y8wawJXwPTAgMBAAGjggFeMIIBWjAPBgNV
// SIG // HRMBAf8EBTADAQH/MB0GA1UdDgQWBBTLEejK0rQWWAHJ
// SIG // Ny4zFha5TJoKHzALBgNVHQ8EBAMCAYYwEgYJKwYBBAGC
// SIG // NxUBBAUCAwEAATAjBgkrBgEEAYI3FQIEFgQU/dExTtMm
// SIG // ipXhmGA7qDFvpjy82C0wGQYJKwYBBAGCNxQCBAweCgBT
// SIG // AHUAYgBDAEEwHwYDVR0jBBgwFoAUDqyCYEBWJ5flJRP8
// SIG // KuEKU5VZ5KQwUAYDVR0fBEkwRzBFoEOgQYY/aHR0cDov
// SIG // L2NybC5taWNyb3NvZnQuY29tL3BraS9jcmwvcHJvZHVj
// SIG // dHMvbWljcm9zb2Z0cm9vdGNlcnQuY3JsMFQGCCsGAQUF
// SIG // BwEBBEgwRjBEBggrBgEFBQcwAoY4aHR0cDovL3d3dy5t
// SIG // aWNyb3NvZnQuY29tL3BraS9jZXJ0cy9NaWNyb3NvZnRS
// SIG // b290Q2VydC5jcnQwDQYJKoZIhvcNAQEFBQADggIBAFk5
// SIG // Pn8mRq/rb0CxMrVq6w4vbqhJ9+tfde1MOy3XQ60L/svp
// SIG // LTGjI8x8UJiAIV2sPS9MuqKoVpzjcLu4tPh5tUly9z7q
// SIG // QX/K4QwXaculnCAt+gtQxFbNLeNK0rxw56gNogOlVuC4
// SIG // iktX8pVCnPHz7+7jhh80PLhWmvBTI4UqpIIck+KUBx3y
// SIG // 4k74jKHK6BOlkU7IG9KPcpUqcW2bGvgc8FPWZ8wi/1wd
// SIG // zaKMvSeyeWNWRKJRzfnpo1hW3ZsCRUQvX/TartSCMm78
// SIG // pJUT5Otp56miLL7IKxAOZY6Z2/Wi+hImCWU4lPF6H0q7
// SIG // 0eFW6NB4lhhcyTUWX92THUmOLb6tNEQc7hAVGgBd3TVb
// SIG // Ic6YxwnuhQ6MT20OE049fClInHLR82zKwexwo1eSV32U
// SIG // jaAbSANa98+jZwp0pTbtLS8XyOZyNxL0b7E8Z4L5UrKN
// SIG // MxZlHg6K3RDeZPRvzkbU0xfpecQEtNP7LN8fip6sCvsT
// SIG // J0Ct5PnhqX9GuwdgR2VgQE6wQuxO7bN2edgKNAltHIAx
// SIG // H+IOVN3lofvlRxCtZJj/UBYufL8FIXrilUEnacOTj5XJ
// SIG // jdibIa4NXJzwoq6GaIMMai27dmsAHZat8hZ79haDJLmI
// SIG // z2qoRzEvmtzjcT3XAH5iR9HOiMm4GPoOco3Boz2vAkBq
// SIG // /2mbluIQqBC0N1AI1sM9MIIGBzCCA++gAwIBAgIKYRZo
// SIG // NAAAAAAAHDANBgkqhkiG9w0BAQUFADBfMRMwEQYKCZIm
// SIG // iZPyLGQBGRYDY29tMRkwFwYKCZImiZPyLGQBGRYJbWlj
// SIG // cm9zb2Z0MS0wKwYDVQQDEyRNaWNyb3NvZnQgUm9vdCBD
// SIG // ZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMDcwNDAzMTI1
// SIG // MzA5WhcNMjEwNDAzMTMwMzA5WjB3MQswCQYDVQQGEwJV
// SIG // UzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMH
// SIG // UmVkbW9uZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBv
// SIG // cmF0aW9uMSEwHwYDVQQDExhNaWNyb3NvZnQgVGltZS1T
// SIG // dGFtcCBQQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
// SIG // ggEKAoIBAQCfoWyx39tIkip8ay4Z4b3i48WZUSNQrc7d
// SIG // GE4kD+7Rp9FMrXQwIBHrB9VUlRVJlBtCkq6YXDAm2gBr
// SIG // 6Hu97IkHD/cOBJjwicwfyzMkh53y9GccLPx754gd6udO
// SIG // o6HBI1PKjfpFzwnQXq/QsEIEovmmbJNn1yjcRlOwhtDl
// SIG // KEYuJ6yGT1VSDOQDLPtqkJAwbofzWTCd+n7Wl7PoIZd+
// SIG // +NIT8wi3U21StEWQn0gASkdmEScpZqiX5NMGgUqi+YSn
// SIG // EUcUCYKfhO1VeP4Bmh1QCIUAEDBG7bfeI0a7xC1Un68e
// SIG // eEExd8yb3zuDk6FhArUdDbH895uyAc4iS1T/+QXDwiAL
// SIG // AgMBAAGjggGrMIIBpzAPBgNVHRMBAf8EBTADAQH/MB0G
// SIG // A1UdDgQWBBQjNPjZUkZwCu1A+3b7syuwwzWzDzALBgNV
// SIG // HQ8EBAMCAYYwEAYJKwYBBAGCNxUBBAMCAQAwgZgGA1Ud
// SIG // IwSBkDCBjYAUDqyCYEBWJ5flJRP8KuEKU5VZ5KShY6Rh
// SIG // MF8xEzARBgoJkiaJk/IsZAEZFgNjb20xGTAXBgoJkiaJ
// SIG // k/IsZAEZFgltaWNyb3NvZnQxLTArBgNVBAMTJE1pY3Jv
// SIG // c29mdCBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eYIQ
// SIG // ea0WoUqgpa1Mc1j0BxMuZTBQBgNVHR8ESTBHMEWgQ6BB
// SIG // hj9odHRwOi8vY3JsLm1pY3Jvc29mdC5jb20vcGtpL2Ny
// SIG // bC9wcm9kdWN0cy9taWNyb3NvZnRyb290Y2VydC5jcmww
// SIG // VAYIKwYBBQUHAQEESDBGMEQGCCsGAQUFBzAChjhodHRw
// SIG // Oi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpL2NlcnRzL01p
// SIG // Y3Jvc29mdFJvb3RDZXJ0LmNydDATBgNVHSUEDDAKBggr
// SIG // BgEFBQcDCDANBgkqhkiG9w0BAQUFAAOCAgEAEJeKw1wD
// SIG // RDbd6bStd9vOeVFNAbEudHFbbQwTq86+e4+4LtQSooxt
// SIG // YrhXAstOIBNQmd16QOJXu69YmhzhHQGGrLt48ovQ7DsB
// SIG // 7uK+jwoFyI1I4vBTFd1Pq5Lk541q1YDB5pTyBi+FA+mR
// SIG // KiQicPv2/OR4mS4N9wficLwYTp2OawpylbihOZxnLcVR
// SIG // DupiXD8WmIsgP+IHGjL5zDFKdjE9K3ILyOpwPf+FChPf
// SIG // wgphjvDXuBfrTot/xTUrXqO/67x9C0J71FNyIe4wyrt4
// SIG // ZVxbARcKFA7S2hSY9Ty5ZlizLS/n+YWGzFFW6J1wlGys
// SIG // OUzU9nm/qhh6YinvopspNAZ3GmLJPR5tH4LwC8csu89D
// SIG // s+X57H2146SodDW4TsVxIxImdgs8UoxxWkZDFLyzs7BN
// SIG // Z8ifQv+AeSGAnhUwZuhCEl4ayJ4iIdBD6Svpu/RIzCzU
// SIG // 2DKATCYqSCRfWupW76bemZ3KOm+9gSd0BhHudiG/m4LB
// SIG // J1S2sWo9iaF2YbRuoROmv6pH8BJv/YoybLL+31HIjCPJ
// SIG // Zr2dHYcSZAI9La9Zj7jkIeW1sMpjtHhUBdRBLlCslLCl
// SIG // eKuzoJZ1GtmShxN1Ii8yqAhuoFuMJb+g74TKIdbrHk/J
// SIG // mu5J4PcBZW+JC33Iacjmbuqnl84xKf8OxVtc2E0bodj6
// SIG // L54/LlUWa8kTo/0xggS1MIIEsQIBATCBkDB5MQswCQYD
// SIG // VQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4G
// SIG // A1UEBxMHUmVkbW9uZDEeMBwGA1UEChMVTWljcm9zb2Z0
// SIG // IENvcnBvcmF0aW9uMSMwIQYDVQQDExpNaWNyb3NvZnQg
// SIG // Q29kZSBTaWduaW5nIFBDQQITMwAAAMps1TISNcThVQAB
// SIG // AAAAyjAJBgUrDgMCGgUAoIHOMBkGCSqGSIb3DQEJAzEM
// SIG // BgorBgEEAYI3AgEEMBwGCisGAQQBgjcCAQsxDjAMBgor
// SIG // BgEEAYI3AgEVMCMGCSqGSIb3DQEJBDEWBBQjYa5kWLph
// SIG // jwKdfyOx63ViDtTaSjBuBgorBgEEAYI3AgEMMWAwXqBE
// SIG // gEIAVABGAFMALgBXAG8AcgBrAEkAdABlAG0AVAByAGEA
// SIG // YwBrAGkAbgBnAC4ATABpAG4AawBpAG4AZwBfADIALgBq
// SIG // AHOhFoAUaHR0cDovL21pY3Jvc29mdC5jb20wDQYJKoZI
// SIG // hvcNAQEBBQAEggEAbtpnv+JZdH7Vq0IQ31ExP7gLdK5v
// SIG // Zr6VQXEf3LoJ8KNwJtxxmqnsXmY7YCaRXOHsLFMQiC9L
// SIG // 8Wp1htOXaqp0wDKMxIQWlkhNqwFp4c49VLesl7OSQ4X4
// SIG // i2H+EPLnllsc7//czY/sTzLNil1Tkl5ktGvjYA1L+2u0
// SIG // XHTBsC0vhjDZaxwGiColHU7Yh4s/qxX2rU7ZZQt2qns1
// SIG // 33PbrdLt0np8MIF1KFRevzA3NTh3qzRfHZD1nD1iYkrU
// SIG // XeMs+K/auHawZLFlD0RSfN1XnPmYn5HenWVbfPfFFh4x
// SIG // Q1gS3JkNKf8iiIHA1HxNW3F1F2T0zBvi3QXXQQEBwYE4
// SIG // ZBMNjqGCAigwggIkBgkqhkiG9w0BCQYxggIVMIICEQIB
// SIG // ATCBjjB3MQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2Fz
// SIG // aGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDEeMBwGA1UE
// SIG // ChMVTWljcm9zb2Z0IENvcnBvcmF0aW9uMSEwHwYDVQQD
// SIG // ExhNaWNyb3NvZnQgVGltZS1TdGFtcCBQQ0ECEzMAAABM
// SIG // oehNzLR0ezsAAAAAAEwwCQYFKw4DAhoFAKBdMBgGCSqG
// SIG // SIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkF
// SIG // MQ8XDTE0MDcyMzA5MTAyMlowIwYJKoZIhvcNAQkEMRYE
// SIG // FHeuAAV0IydBfxMICZ793R5TtZe/MA0GCSqGSIb3DQEB
// SIG // BQUABIIBABacELAWLVocVRL6RVEDKwrrA7fbEjEaT+59
// SIG // DRs+ZFDiG6ML2oiKaIp+gVJVqzx2/MZAF8xzRmpYKmXa
// SIG // sFTz9HzYfMhvHEI+YdXvDUhKb4qNI6X2yaXan5IxTMn7
// SIG // CPqVKigJVFevWMBwDKTuPrhrJwH37VcDyH/g9DLrGRyl
// SIG // 2WaXIHCwqDppV7nW9S2sYSdHRzfCsyMKHY1UWkeA4APS
// SIG // vVbx2NLvnLsJi+PezBH4HLSY6lC4sAcq5/DSUcIUEtg/
// SIG // JSMNZnntBM1AF0QyrhvEpSSIbnIk6p9DhgaFL77JBMZv
// SIG // zHkWEvUtdcF/HiaCPKdXNJyQlCSXXH3sF3oP/1NPNxk=
// SIG // End signature block
