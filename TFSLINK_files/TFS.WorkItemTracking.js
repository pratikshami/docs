//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d};define(["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/Generated/TFS.WorkItemTracking.Constants","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/Generated/TFS.Common.Constants","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/Resources/TFS.Resources.WorkItemTracking","Presentation/Scripts/TFS/Resources/TFS.Resources.WorkItemTracking.Common","Presentation/Scripts/TFS/TFS.OM","Presentation/Scripts/TFS/TFS.Html","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants"],function(cc,e,l,a,c,x,k,D,qb,d,g,h,q,Ub,Nb){var vb=l.queueCallbacks,m=l.queueRequest,Bb=a.delegate,i=l.handleError,cb=d.assert,B=d.fail,Mb=l.getErrorMessage,H=q.TeamAwarenessService,Tb=/^\{?([\dA-F]{8})-?([\dA-F]{4})-?([\dA-F]{4})-?([\dA-F]{4})-?([\dA-F]{12})\}?$/i,Fb=/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F-\u009F]/g,Db=/(^[\uD800-\uDFFF]$)|[^\uD800-\uDBFF](?=[\uDC00-\uDFFF])|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/g,V;(function(a){a.WorkItemBulkSaveException="TFS.WorkItemTracking.WorkItemBulkSaveException";a.ProjectDoesNotExistException="TFS.WorkItemTracking.ProjectDoesNotExistException";a.FieldDoesNotExistException="TFS.WorkItemTracking.FieldDoesNotExistException";a.LinkTypeEndDoesNotExistException="TFS.WorkItemTracking.LinkTypeEndDoesNotExistException";a.LinkTypeDoesNotExistException="TFS.WorkItemTracking.LinkTypeDoesNotExistException";a.WorkItemSaveFailedDueToInvalidStatusException="TFS.WorkItemTracking.WorkItemSaveFailedDueToInvalidStatusException";a.InvalidQuerySyntaxException="TFS.WorkItemTracking.InvalidQuerySyntaxException";a.InvalidQueryFilterRowException="TFS.WorkItemTracking.InvalidQueryFilterRowException";a.QueryItemAlreadyExistException="TFS.WorkItemTracking.QueryItemAlreadyExistException"})(e.Exceptions||(e.Exceptions={}));var p=e.Exceptions;(function(a){a[a.None=0]="None";a[a.ServerDateTime=1]="ServerDateTime";a[a.CallerIdentity=2]="CallerIdentity";a[a.RandomGuid=3]="RandomGuid"})(e.ServerDefaultValueType||(e.ServerDefaultValueType={}));var Vb=e.ServerDefaultValueType;(function(a){a.FieldChange="field-change";a.PreSave="pre-save";a.Saving="saving";a.SaveCompleted="save-completed";a.Saved="saved";a.Opened="opened";a.Created="created";a.Refresh="refresh";a.Reset="reset";a.ErrorChanged="error-changed";a.Discarded="discarded"})(e.WorkItemChangeType||(e.WorkItemChangeType={}));var n=e.WorkItemChangeType;Error.workItemBulkSave=function(b){var a=Error.create(g.WorkItemBulkSaveFailed,{name:p.WorkItemBulkSaveException,results:b});a.popStackFrame();return a};Error.projectDoesNotExist=function(b){var c=Error.create(a.StringUtils.format(g.ProjectDoesNotExist,b),{name:p.ProjectDoesNotExistException,projectName:b});c.popStackFrame();return c};Error.fieldDoesNotExist=function(b){var c=Error.create(a.StringUtils.format(g.WorkItemFieldDoesNotExist,b),{name:p.FieldDoesNotExistException,field:b});c.popStackFrame();return c};Error.linkTypeEndDoesNotExist=function(b){var c=Error.create(a.StringUtils.format(g.WorkItemLinkTypeEndDoesNotExist,b),{name:p.LinkTypeEndDoesNotExistException,linkTypeEnd:b});c.popStackFrame();return c};Error.linkTypeDoesNotExist=function(b){var c=Error.create(a.StringUtils.format(g.WorkItemLinkTypeDoesNotExists,b),{name:p.LinkTypeDoesNotExistException,linkType:b});c.popStackFrame();return c};Error.workItemSaveFailedDueToInvalidStatus=function(c){var b,a;a=c.getInfoText().text;b=Error.create(a,{name:p.WorkItemSaveFailedDueToInvalidStatusException,detail:a,workItem:c});b.popStackFrame();return b};Error.invalidQuerySyntax=function(b,c){var d=Error.create(a.StringUtils.format(g.InvalidQuerySyntax,b,c),{name:p.InvalidQuerySyntaxException,details:b,node:c});d.popStackFrame();return d};Error.invalidQueryFilterRow=function(d,b){var c=Error.create(a.StringUtils.format(d,b),{name:p.InvalidQueryFilterRowException,rowIndex:b});c.popStackFrame();return c};Error.queryItemAlreadyExist=function(c){var b=Error.create(a.StringUtils.format(g.QueryItemAlreadyExist,c),{name:p.QueryItemAlreadyExistException});b.popStackFrame();return b};var t;(function(b){function h(c){var d,f,e;if(c.children){c.children.sort(function(b,c){return a.StringUtils.localeIgnoreCaseComparer(b.name,c.name)});for(d=0,f=c.children.length;d<f;d++){e=c.children[d];e.parent=c;b.link(e)}}return c}b.link=h;function c(e,d){var a,c,b=e.children;if(b)for(a=0,c=b.length;a<c;a++)if(b[a].structure===d)return b[a];return null}b.findChildByStructure=c;function f(a,e){var c,f,d;if(a){if(a.id===e)return a;if(a.children)for(c=0,f=a.children.length;c<f;c++){d=b.findById(a.children[c],e);if(d)return d}}return null}b.findById=f;function e(k,f,i,j){var h=0,l=0,b,e,d,g,a,c;f=f.replace(/^(\s|\u00A0|\\)+|(\s|\u00A0|\\)+$/g,"");g=f.toUpperCase().split("\\");a=[k];while(a&&a.length>0&&h<g.length){d=null;if(l++===i){c=[];for(b=0,e=a.length;b<e;b++)if(a[b].structure===j){c=a[b].children||[];break}a=c;continue}c=null;for(b=0,e=a.length;b<e;b++)if(a[b].name.toUpperCase()===g[h]){d=a[b];c=d.children;h++;break}a=c}return d}b.findByPath=e;function d(a,c){var b=[];while(a){b.unshift(a.name);a=a.parent}typeof c==="number"&&b.splice(c,1);return b}b.getNodeSegments=d;function g(d,a){var c=b.getNodeSegments(d,a);return c.join("\\")}b.getPath=g})(t||(t={}));(function(a){a[a.Valid=0]="Valid";a[a.InvalidEmpty=1]="InvalidEmpty";a[a.InvalidNotEmpty=2]="InvalidNotEmpty";a[a.InvalidFormat=3]="InvalidFormat";a[a.InvalidListValue=4]="InvalidListValue";a[a.InvalidOldValue=5]="InvalidOldValue";a[a.InvalidNotOldValue=6]="InvalidNotOldValue";a[a.InvalidEmptyOrOldValue=7]="InvalidEmptyOrOldValue";a[a.InvalidNotEmptyOrOldValue=8]="InvalidNotEmptyOrOldValue";a[a.InvalidValueInOtherField=9]="InvalidValueInOtherField";a[a.InvalidValueNotInOtherField=10]="InvalidValueNotInOtherField";a[a.InvalidDate=11]="InvalidDate";a[a.InvalidTooLong=12]="InvalidTooLong";a[a.InvalidType=13]="InvalidType";a[a.InvalidComputedField=14]="InvalidComputedField";a[a.InvalidPath=15]="InvalidPath";a[a.InvalidCharacters=16]="InvalidCharacters";a[a.InvalidUnknown=17]="InvalidUnknown"})(e.FieldStatus||(e.FieldStatus={}));var Zb=e.FieldStatus;(function(a){a[a.None=0]="None";a[a.AllowsOldValue=64]="AllowsOldValue";a[a.HasFormats=16]="HasFormats";a[a.HasValues=4]="HasValues";a[a.InvalidCharacters=131072]="InvalidCharacters";a[a.InvalidComputedField=536870912]="InvalidComputedField";a[a.InvalidDate=8192]="InvalidDate";a[a.InvalidEmpty=524288]="InvalidEmpty";a[a.InvalidEmptyOrOldValue=33554432]="InvalidEmptyOrOldValue";a[a.InvalidFormat=2097152]="InvalidFormat";a[a.InvalidID=16384]="InvalidID";a[a.InvalidListValue=4194304]="InvalidListValue";a[a.InvalidMask=2147479552]="InvalidMask";a[a.InvalidNotEmpty=1048576]="InvalidNotEmpty";a[a.InvalidNotEmptyOrOldValue=67108864]="InvalidNotEmptyOrOldValue";a[a.InvalidNotOldValue=16777216]="InvalidNotOldValue";a[a.InvalidOldValue=8388608]="InvalidOldValue";a[a.InvalidPath=32768]="InvalidPath";a[a.InvalidRule=262144]="InvalidRule";a[a.InvalidTooLong=65536]="InvalidTooLong";a[a.InvalidType=4096]="InvalidType";a[a.InvalidValueInOtherField=134217728]="InvalidValueInOtherField";a[a.InvalidValueNotInOtherField=268435456]="InvalidValueNotInOtherField";a[a.LimitedToFormats=32]="LimitedToFormats";a[a.LimitedToValues=8]="LimitedToValues";a[a.ReadOnly=2]="ReadOnly";a[a.Required=1]="Required";a[a.SetByRule=128]="SetByRule";a[a.SetByDefaultRule=256]="SetByDefaultRule";a[a.SetByComputedRule=512]="SetByComputedRule"})(e.FieldStatusFlags||(e.FieldStatusFlags={}));var Wb=e.FieldStatusFlags,fb;(function(a){a[a.DefaultRules=1]="DefaultRules";a[a.CopyRules=2]="CopyRules";a[a.OtherRules=3]="OtherRules"})(fb||(fb={}));var bb;(function(b){function a(d){var b,c,e,a;for(c=0,e=d.length;c<e;c++){b=d[c];a=b.forwardEnd;if(a){a.linkType=b;a.oppositeEnd=b.reverseEnd}a=b.reverseEnd;if(a){a.linkType=b;a.oppositeEnd=b.forwardEnd}}}b.bindLinkTypeEnds=a})(bb||(bb={}));(function(a){a[a.None=0]="None";a[a.WorkItem=1]="WorkItem";a[a.WorkItemLink=2]="WorkItemLink";a[a.Tree=4]="Tree";a[a.WorkItemTypeExtension=8]="WorkItemTypeExtension"})(e.FieldUsages||(e.FieldUsages={}));var ac=e.FieldUsages;(function(a){a[a.None=0]="None";a[a.Sortable=1]="Sortable";a[a.Computed=2]="Computed";a[a.Editable=4]="Editable";a[a.Ignored=8]="Ignored";a[a.Queryable=16]="Queryable";a[a.Reportable=32]="Reportable";a[a.PersonField=64]="PersonField";a[a.Cloneable=128]="Cloneable";a[a.LongText=256]="LongText";a[a.SupportsTextQuery=512]="SupportsTextQuery"})(e.FieldFlags||(e.FieldFlags={}));var bc=e.FieldFlags;(function(a){a.NotSpace="NOT";a.OperatorAnd="AND";a.OperatorOr="OR";a.OperatorContains="CONTAINS";a.OperatorNotContains="NOT CONTAINS";a.OperatorContainsWords="CONTAINS WORDS";a.OperatorNotContainsWords="NOT CONTAINS WORDS";a.OperatorIn="IN";a.OperatorEver="EVER";a.OperatorNotEver="NOT EVER";a.OperatorUnder="UNDER";a.OperatorNotUnder="NOT UNDER";a.OperatorInGroup="IN GROUP";a.OperatorNotInGroup="NOT IN GROUP";a.OperatorEqualTo="=";a.OperatorNotEqualTo="<>";a.OperatorGreaterThan=">";a.OperatorLessThan="<";a.OperatorGreaterThanOrEqualTo=">=";a.OperatorLessThanOrEqualTo="<=";a.MacroStart="@";a.MacroToday="@today";a.MacroMe="@me";a.MacroProject="@project"})(e.WiqlOperators||(e.WiqlOperators={}));var b=e.WiqlOperators;(function(a){a[a.None=0]="None";a[a.Revision=1]="Revision";a[a.AddAttachment=2]="AddAttachment";a[a.DelAttachment=3]="DelAttachment";a[a.AddHyperLink=4]="AddHyperLink";a[a.DelHyperLink=5]="DelHyperLink";a[a.AddExternalLink=6]="AddExternalLink";a[a.DelExternalLink=7]="DelExternalLink";a[a.AddWorkItemLink=8]="AddWorkItemLink";a[a.DelWorkItemLink=9]="DelWorkItemLink"})(e.EditActionType||(e.EditActionType={}));var Yb=e.EditActionType;function jb(b){switch(b){case c.DalFields.AttachedFiles:return 2;case c.DalFields.LinkedFiles:return 4;case c.DalFields.BISURI:return 6;case c.DalFields.RelatedLinks:return 8}throw Error.invalidOperation(a.StringUtils.format("Unexpected link action (FieldId: {0}).",b));}(function(a){a[a.FieldChanges=1]="FieldChanges";a[a.AttachmentChanges=2]="AttachmentChanges";a[a.HyperLinkChanges=4]="HyperLinkChanges";a[a.ExternalLinkChanges=8]="ExternalLinkChanges";a[a.WorkItemLinkChanges=16]="WorkItemLinkChanges"})(e.EditActionFlags||(e.EditActionFlags={}));var Xb=e.EditActionFlags;(function(a){a.Unknown=0;a.WorkItems=1;a.LinksMustContain=2;a.LinksMayContain=3;a.LinksDoesNotContain=4;a.LinksRecursive=5;a.LinksRecursiveReturnMatchingChildren=6;function b(b){return(b||a.Unknown)>a.WorkItems}a.isLinkQuery=b;function c(b){return(b||a.Unknown)>=a.LinksRecursive}a.isTreeQuery=c})(e.LinkQueryMode||(e.LinkQueryMode={}));var w=e.LinkQueryMode,Ab;(function(a){a[a.WorkItemMissingOrUpdated=600122]="WorkItemMissingOrUpdated"})(Ab||(Ab={}));var O=function(){function a(b,a){this.project=b;if(a){this.id=a.id;this.name=a.name;this.parentId=a.parent}}a.prototype._populateClone=function(){};a.prototype.path=function(a,b){return D.calculateTreePath.call(this,a,b||"/","name","root")};a.prototype.beginRename=function(c,f,d){var b=this,e,a;if(this.parent)e=this.parent.findByPath(c);if(e&&e!==this)i(Error.queryItemAlreadyExist(c),d,this);else{a=$.extend({},this);a.name=c;this._populateClone(a);this.project.beginSaveQueries([a],function(){if(a.lastSaveFailure)i(a.lastSaveFailure,d,b);else{b.name=c;$(window).trigger("query-item-renamed",b);$.isFunction(f)&&f.call(b,b)}},d)}};a.prototype.beginMove=function(e,b,h,f){var c=this;d.assertParamIsStringNotEmpty(e,"newName");d.assertParamIsObject(b,"newParent");if(b.findByPath(e))i(Error.queryItemAlreadyExist(e),f,this);else{var a,g=this.parent;a=$.extend({},this);a.name=e;a.parent=b;a.parentId=b.id;this._populateClone(a);a.setPersonal(b.personal);this.project.beginSaveQueries([a],function(){if(a.lastSaveFailure)i(a.lastSaveFailure,f,c);else{var d={queryItem:c,oldParent:g};g.remove(c);c.name=e;c.parentId=b.id;c.setPersonal(b.personal);b.add(c);$(window).trigger("query-item-moved",d);$.isFunction(h)&&h.call(c,d)}},f)}};a.prototype.setPersonal=function(a){d.assertParamIsBool(a,"isPersonal");this.personal=a};a.prototype.beginDelete=function(a,c){var b=this;if(!this.id&&this.newQueryId){this.onDelete(true);$.isFunction(a)&&a.call(this,this);return}this.project.beginDeleteQueries([this],function(e,d){if(d[0])i(d[0],c,b);else{b.onDelete(true);$.isFunction(a)&&a.call(b,b)}},c)};a.prototype.onDelete=function(a){this.parent&&this.parent.remove(this);delete this.project.queryHierarchy.all[this.id];a&&$(window).trigger("query-item-removed",this)};return a}();e.QueryItem=O;l.initClassPrototype(O,{id:null,name:null,parent:null,parentId:null,personal:false,project:null,isDirty:false,sortModifier:1,sortPrefix:0});var y=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);if(a)this.queryText=a.query}a.defaultNewQueryWiql=function(){return a.DEFAULT_NEW_QUERY_WIQL};a.isMyWorkItems=function(b){return b.id.toUpperCase()===a.ASSIGNED_TO_ME_ID};a.isUnsavedWorkItems=function(b){return b.id.toUpperCase()===a.UNSAVED_WORKITEMS_ID};a.isCreatedByMeItems=function(b){return b.id.toUpperCase()===a.CREATED_BY_ME_WORKITEMS_ID};a.isSearchResults=function(b){return b.id.toUpperCase()===a.SEARCH_RESULTS_ID};a.isCustomWiqlQuery=function(b){return b.id.toUpperCase()===a.CUSTOM_WIQL_QUERY_ID};a.isCustomizableSpecialQuery=function(b){return b.specialQuery&&(a.isMyWorkItems(b)||a.isCreatedByMeItems(b))};a.isUneditableQuery=function(b){return b.specialQuery&&a.isUnsavedWorkItems(b)};a.prototype._populateClone=function(a){b.prototype._populateClone.call(this,a);a.queryText=this.queryText||this._originalQueryText||""};a.prototype.setQuery=function(a){if(this.queryText!==a){this._originalQueryText=this.queryText;this.queryText=a;this.isDirty=true}};a.DEFAULT_NEW_QUERY_WIQL="SELECT [System.Id], [System.WorkItemType], [System.Title], [System.AssignedTo], [System.State], [System.Tags] FROM Workitems WHERE [System.TeamProject] = @project AND [System.WorkItemType]<>'' AND [System.State]<>''";a.ASSIGNED_TO_ME_ID="A2108D31-086C-4FB0-AFDA-097E4CC46DF4";a.UNSAVED_WORKITEMS_ID="B7A26A56-EA87-4C97-A504-3F028808BB9F";a.CREATED_BY_ME_WORKITEMS_ID="53FB153F-C52C-42F1-90B6-CA17FC3561A8";a.SEARCH_RESULTS_ID="2CBF5136-1AE5-4948-B59A-36F526D9AC73";a.CUSTOM_WIQL_QUERY_ID="08E20883-D56C-4461-88EB-CE77C0C7936D";return a}(O);e.QueryDefinition=y;l.initClassPrototype(y,{queryText:null,_originalQueryText:null,specialQuery:false});var E=function(c){__extends(b,c);function b(b,a){c.call(this,b,a);this.children=[]}b.prototype.add=function(a,b){this.children.push(a);a.parent=this;if(b){if(a.id==="")this.project.queryHierarchy.all[a.name]=a;else this.project.queryHierarchy.all[a.id]=a;$(window).trigger("query-item-created",a)}};b.prototype.remove=function(b){a.ArrayUtils.remove(this.children,b)};b.prototype.findByPath=function(b){return D.findTreeNode.call(this,b,"/",a.StringUtils.localeIgnoreCaseComparer,"name")};b.prototype.clear=function(){this.children=[]};b.prototype.beginCreateNewFolder=function(e,f,c){var d=this,a;if(this.findByPath(e))i(Error.queryItemAlreadyExist(e),c,this);else{a=new b(this.project,{name:e,id:"",parent:this.id});a.personal=this.personal;a.queryText="";this.project.beginSaveQueries([a],function(){if(a.lastSaveFailure)i(a.lastSaveFailure,c,d);else{d.add(a,true);$.isFunction(f)&&f.call(d,a)}},c)}};b.prototype.beginCreateNewQuery=function(e,h,f,g,b){var c=this,a,d;d=this.findByPath(e);if(d&&!d.newQueryId)i(Error.queryItemAlreadyExist(e),b,this);else{a=new y(this.project,{name:e,id:"",parent:this.id,query:h});if(f)a.newQueryId=f;a.personal=this.personal;this.project.beginSaveQueries([a],function(){if(a.lastSaveFailure)i(a.lastSaveFailure,b,c);else{c.add(a,true);$.isFunction(g)&&g.call(c,a)}},b)}};b.prototype.onDelete=function(b){for(var a=this.children.length-1;a>=0;a--)this.children[a].onDelete(b);c.prototype.onDelete.call(this,b)};b.prototype.setPersonal=function(a){d.assertParamIsBool(a,"isPersonal");c.prototype.setPersonal.call(this,a);if(this.personal!==a)if(this.children)for(var b=0,e=this.children.length;b<e;b++)this.children[b].setPersonal(a)};return b}(O);e.QueryFolder=E;l.initClassPrototype(E,{children:null,specialFolder:false});var X=function(b){__extends(a,b);function a(a,c){b.call(this,a,{id:a.guid,name:a.name});this._load(c)}a.prototype.findQueryById=function(a){return this.all[a]};a.prototype.beginSave=function(e,d){var c=[],a,b;for(b in this.all)if(this.all.hasOwnProperty(b)){a=this.all[b];a instanceof y&&a.isDirty&&c.push(a)}this.project.beginSaveQueries(c,e,d)};a.prototype.beginRefresh=function(b,c){var a=this;k.getMSJSON(this.project.getApiLocation("queries"),{includeQueryTexts:true},function(c){a._load(c);$(window).trigger("query-hierarchy-refreshed",a);$.isFunction(b)&&b.call(a)},c)};a.prototype.updateNewQueryId=function(a,b){d.assertParamIsString(a,"oldId");d.assertParamIsString(b,"newId");this.all[b]=this.all[a];delete this.all[a]};a.prototype._load=function(d){var b={},f,a,e,c=this.project;function h(f,h){var e,g,a,d;if(f)for(e=0,g=f.length;e<g;e++){d=f[e];if(d.folder)a=new E(c,d);else a=new y(c,d);a.personal=h;b[a.id]=a}}if(c.store.getTfsContext().standardAccessMode===true){h(d.privateQueries,true);h(d.publicQueries,false);a=new y(c,d.assignedToMe);a.specialQuery=true;a.name=g.AssignedToMeQuery;a.sortPrefix=-1e5;b[a.id]=a;this.assignedToMe=a}else{a=new y(c,d.createdByMe);a.specialQuery=true;a.name=g.WorkItemsCreatedByMeQuery;a.sortPrefix=-1e5;b[a.id]=a;this.createdByMe=a}a=new y(c,d.unsavedWorkItems);a.specialQuery=true;a.name=g.UnsavedWorkItemsQuery;a.sortPrefix=-100;b[a.id]=a;this.unsavedWorkItems=a;this.clear();for(f in b)if(b.hasOwnProperty(f)){a=b[f];e=b[a.parentId];if(e)e.add(a);else{if(!a.specialQuery){a.specialFolder=a instanceof E;if(a.personal){this.myQueries=a;a.sortPrefix=1}else{this.sharedQueries=a;a.sortPrefix=2}}this.add(a)}}this.all=b;$(window).trigger("query-hierarchy-loaded",this)};return a}(E);e.QueryHierarchy=X;l.initClassPrototype(X,{root:true,all:null,sortModifier:-1,myQueries:null,sharedQueries:null,assignedToMe:null,createdByMe:null,unsavedWorkItems:null});var J=function(){function b(a){a&&this.update(a)}b.prototype.update=function(b){var d=false,c,e;this.store=b.store;d=this.id!==b.id||this.tempId!==b.tempId||this.isDirty!==b.isDirty();this.id=b.id;this.tempId=b.tempId;this.isDirty=b.isDirty();this.workItemTypeName=b.workItemType.name;this.projectName=b.project.name;c=b.getCaption(true);this.name=c;e=a.StringUtils.format(g.WorkItemEditorWindowTitle,c,b.getTitle());if(this.title!==e){this.title=e;d=true}return d};return b}();e.RecentWorkItem=J;l.initClassPrototype(J,{store:null,id:null,name:null,title:null,workItemTypeName:null,projectName:null,sortOrder:0,tempId:null,isDirty:false});var U=function(c){__extends(b,c);function b(a){c.call(this,null);this.name=g.RecentWorkItems;this.recentsMap={};this.children=[];a.workItemManager.attachWorkItemChanged(Bb(this,this._workItemChanged))}b.prototype.addRecent=function(c){var a;a=this.recentsMap[c.tempId]||this.recentsMap[c.id];if(!a){a=new J(c);this._fixMap(a);this.children.unshift(a)>b.MAX_COUNT&&this._fixMap(this.children.pop(),true);this._fireEvent("changed")}};b.prototype.removeRecentById=function(b){var a,c;if(this.recentsMap[b]){delete this.recentsMap[b];for(a=0,c=this.children.length;a<c;a++)if(this.children[a].id===b||this.children[a].tempId===b){this.children.splice(a,1);break}this._fireEvent("changed")}};b.prototype.attachChanged=function(a){this.attachEvent("changed",a)};b.prototype.detachChanged=function(a){this.detachEvent("changed",a)};b.prototype.fire=function(b,c,a){return this._fireEvent(b,c,a)};b.prototype._fireEvent=function(d,e,f){var c,b;if(this._events){b=this._events._getEvent(d);if(!b||b.length===0)return undefined;b=a.ArrayUtils.clone(b);for(c=b.length-1;c>=0;c--)if(b[c](e||this,f)===false)return false}};b.prototype.attachEvent=function(a,b){if(!this._events)this._events=new Sys.EventHandlerList;this._events.addHandler(a,b)};b.prototype.detachEvent=function(a,b){this._events&&this._events.removeHandler(a,b)};b.prototype._workItemChanged=function(f,e){var b,d=e.workItem,c;b=this.recentsMap[d.tempId]||this.recentsMap[d.id];if(b){if(e.change===n.Discarded){this._fixMap(b,true);a.ArrayUtils.remove(this.children,b);c=true}else if(b.update(d)){this._fixMap(b);c=true}c&&this._fireEvent("changed")}};b.prototype._fixMap=function(a,b){if(a){if(a.id)if(b)delete this.recentsMap[a.id];else this.recentsMap[a.id]=a;if(a.tempId)if(b)delete this.recentsMap[a.tempId];else this.recentsMap[a.tempId]=a}};b.MAX_COUNT=5;return b}(J);e.RecentWorkItems=U;l.initClassPrototype(U,{children:null,recentsMap:null,_events:null});var Cb=function(){function b(c,b){this.store=c;this.id=b.id;this.name=b.name;this.guid=b.guid;this.workItemTypeNames=b.workItemTypes;this.fieldIds=b.fieldIds;this.extras=b.extras;$.isArray(this.workItemTypeNames)&&this.workItemTypeNames.sort(a.StringUtils.localeIgnoreCaseComparer);this.workItemTypes={}}b.prototype.getApiLocation=function(a,b){return this.store.getTfsContext().getActionUrl(a||"","wit",$.extend({project:this.name,team:"",area:"api"},b))};b.prototype.path=function(){return this.store.path()+"/"+this.name};b.prototype.getWorkItemTypes=function(){return this.workItemTypeNames};b.prototype.beginGetWorkItemType=function(b,d,c){var a=this,e=b.toUpperCase();m(this,this.workItemTypes,e,d,c,function(d,c){a.beginGetNodes(function(){a.store.beginGetFields(function(){k.getMSJSON(a.getApiLocation("workItemTypes"),{typeNames:[b]},function(b){var e=new K(a,b[0]);if(b[0].rules&&b[0].rules.globals&&b[0].rules.globals.length>0)a.store.beginEnsureConstantSets(b[0].rules.globals,function(){d(e)},c);else d(e)},c)},c)},c)})};b.prototype.getWorkItemType=function(c){var d=c.toUpperCase(),b;b=this.workItemTypes[d];if(b&&!$.isFunction(b))return b;B(a.StringUtils.format("WorkItemType '{0}' is not ready yet. Use beginGetWorkItemType('{0}') to download work item type.",c))};b.prototype.beginGetNodes=function(b,a){var c=this;m(this,this,"nodes",b,a,function(a,b){k.getMSJSON(c.getApiLocation("nodes"),null,function(b){a(t.link(b))},b)})};b.prototype.getNodes=function(){if(this.nodes&&!$.isFunction(this.nodes))return this.nodes;B("Project nodes are not ready yet. Use beginGetNodes to download from the server.")};b.prototype.findAreaNodeByPath=function(a){return t.findByPath(this.getNodes(),a,1,1)};b.prototype.findIterationNodeByPath=function(a){return t.findByPath(this.getNodes(),a,1,2)};b.prototype.findNodeById=function(a){return t.findById(this.getNodes(),a)};b.prototype.getAreaNode=function(a){if(!this.areaNode)this.areaNode=t.findChildByStructure(this.getNodes(),1);return a?{id:this.id,name:this.name,guid:this.guid,structure:0,type:-42,children:this.areaNode.children}:this.areaNode};b.prototype.getIterationNode=function(a){if(!this.iterationNode)this.iterationNode=t.findChildByStructure(this.getNodes(),2);return a?{id:this.id,name:this.name,guid:this.guid,structure:0,type:-42,children:this.iterationNode.children}:this.iterationNode};b.prototype.beginGetQueryHierarchy=function(c,b){var a=this;m(this,this,"queryHierarchy",c,b,function(b,c){k.getMSJSON(a.getApiLocation("queries"),{includeQueryTexts:true},function(c){b(new X(a,c))},c)})};b.prototype.beginQuery=function(d,b,a,c){this.store.beginQuery(this,d,b,a,c)};b.prototype.beginSearch=function(b,c,a,d){this.store.beginSearch(this,b,c,a,d)};b.prototype.beginSaveQueries=function(a,b,e){var c=this,d;if(a&&a.length){d=$.map(a,function(a){return{id:a.id,parentId:a.parentId,name:a.name,queryText:a.queryText}});k.postMSJSON(this.getApiLocation("updateQueries"),{queries:D.stringifyMSJSON(d)},function(e){var d;if(e){d={};$.each(e,function(c,b){if(b.error)d[b.index]=b.error;else if(b.id)a[b.index].id=b.id})}$.each(a,function(e,a){var b=d[e];if(!b){a.isDirty=false;a.newQueryId&&c.queryHierarchy.findQueryById(a.name)&&c.queryHierarchy.updateNewQueryId(a.name,a.id)}else a.lastSaveFailure=b});$.isFunction(b)&&b.call(c,a,d)},e)}else $.isFunction(b)&&b.call(this,a)};b.prototype.beginDeleteQueries=function(a,b,d){var e=this,c=[];if(a&&a.length){$.each(a,function(b,a){c.push(a.id)});k.postMSJSON(this.getApiLocation("deleteQueries"),{queryIds:c},function(d){var c;if(d){c={};$.each(d,function(b,a){c[a.index]=a.error})}$.isFunction(b)&&b.call(e,a,c)},d)}else $.isFunction(b)&&b.call(this,a)};b.prototype.beginUpdateColumnOptions=function(b,d,c,a){k.postMSJSON(this.getApiLocation("updateColumnOptions"),{persistenceId:b,fields:d},c,a)};b.prototype.beginGetGroups=function(b,c,a){this.store.beginGetGroups(this,b,c,a)};b.prototype.beginGetWorkItemCategories=function(b,a){this.store.beginGetWorkItemCategories(this,b,a)};b.prototype.beginGetVisibleWorkItemTypeNames=function(a,c){var b=this;this.beginGetWorkItemCategories(function(f){var e=[],c,d={};c=f["Microsoft.HiddenCategory"];c&&$.each(c.workItemTypeNames,function(b,a){d[a.toUpperCase()]=true});$.each(b.workItemTypeNames,function(b,a){!d.hasOwnProperty(a.toUpperCase())&&e.push(a)});$.isFunction(a)&&a.call(b,e)},c)};return b}();e.Project=Cb;var Ib=/^-(1|2|10|30)(\|.*)?$/,o=function(c){__extends(b,c);function b(){c.call(this);this.constantSets={};this.allowedValues={};this.groups={};this.witCategories={};this.workItemTypeExtensions={}}b.prototype.initializeTfsObject=function(a){c.prototype.initializeTfsObject.call(this,a);this.workItemManager=new ub(this)};b.prototype.path=function(){return this.getLocation()+"/WorkItemStore"};b.prototype.getApiLocation=function(a,b){return this.getTfsContext().getActionUrl(a||"","wit",$.extend({project:"",team:"",area:"api"},b))};b.prototype.getCurrentUser=function(){return this.tfsConnection.getCurrentUser()};b.prototype.beginGetFields=function(c,b){var a=this;m(this,this,"fields",c,b,function(b,c){k.getMSJSON(a.getApiLocation("fields"),null,function(c){b(a._prepareFields(c))},c)})};b.prototype.getFieldDefinition=function(b){cb(Boolean(this.fieldMap),"Fields are not available. It must be downloaded first. Use beginGetFields method.");var a=(""+b).toUpperCase();return this.fieldMap[a]||this.fieldMapById[a]};b.prototype.beginGetRecentWorkItems=function(b,a){var c=this;m(this,this,"recentWorkItems",b,a,function(a){a(new U(c))})};b.prototype.beginGetProjects=function(c,b){var a=this;m(this,this,"projects",c,b,function(b,c){k.getMSJSON(a.getApiLocation("teamProjects"),null,function(c){b($.map(c,function(b){return new Cb(a,b)}))},c)})};b.prototype.getProjects=function(){if(this.projects&&!$.isFunction(this.projects))return this.projects;B("Projects are not ready yet. Use beginGetProjects method to download projects from the server.")};b.prototype.getProject=function(c){var b=this.getProjects(),a,d,e=c.toUpperCase();for(a=0,d=b.length;a<d;a++)if(b[a].name.toUpperCase()===e)return b[a];throw Error.projectDoesNotExist(c);};b.prototype.beginGetProject=function(d,c,b){var a=this;this.beginGetProjects(function(){var e;if($.isFunction(c)){try{e=a.getProject(d)}catch(f){i(f,b,a)}c.call(a,e)}},b)};b.prototype.beginGetWorkItemData=function(b,d,c,g){var h=this,e,f;if(!b){i(Error.argumentNull("ids"),c,this);return}else if(!$.isArray(b)){e=+b;if(isNaN(e)){i(Error.argumentOutOfRange("ids"),c,this);return}else b=[e]}b=$.map(b,function(a){return+a});f=a.validateParameters([b],[{name:"ids",type:Array,elementType:Number,mayBeNull:false,optional:false,elementInteger:true}]);if(f){i(f,c,this);return}k.getMSJSON(this.getApiLocation("workitems"),{ids:b},function(a){if($.isFunction(d))if(a&&a.length===1)d.call(h,a[0],c,g);else d.call(h,a,c,g)},c)};b.prototype.beginGetWorkItem=function(d,a,b){var c=this;this.beginGetWorkItems([d],function(b){$.isFunction(a)&&a.call(c,b&&b[0])},b)};b.prototype.beginGetWorkItems=function(e,d,c){var b=this;this.beginGetWorkItemData(e,function(f){var g,l=0,j=[];if(f)if(!$.isArray(f))g=[f];else g=f;var k=function(){$.isFunction(d)&&d.call(b,j)},e=function(a){i(a,c,b)},h=function(){var c,d;c=g&&g[l++];if(c){d=c.fields[-42];b.beginGetProject(d,function(d){var f=c.fields[25];d.beginGetWorkItemType(f,function(d){b.beginGetLinkTypes(function(){b.beginGetWorkItemTypeExtensions(c.currentExtensions,function(f){try{var g=d.create(c,f);j.push(g);a.delay(b,0,h)}catch(i){e(i)}},e)},e)},e)},e)}else k()};h()},c)};b.prototype.beginQuery=function(b,g,a,c,e){var f=this,d=b?b.getApiLocation("query"):this.getApiLocation("query");k.postMSJSON(d,$.extend({wiql:g},e),function(b){$.isFunction(a)&&a.call(f,b)},c)};b.prototype.beginSearch=function(d,c,a,b,e){var f=this;k.getMSJSON((d||this).getApiLocation("search"),$.extend({searchText:c},e),function(b){$.isFunction(a)&&a.call(f,b)},b)};b.prototype.beginGetLinkTypes=function(b,c){var a=this,d=function(){b&&b.call(a,a.linkTypes,a.registeredLinkTypes)};m(this,this,"linkTypes",d,c,function(b,c){k.getMSJSON(a.getApiLocation("linkTypes"),null,function(c){bb.bindLinkTypeEnds(c.witLinkTypes);a.registeredLinkTypes=c.registeredLinkTypes;b(c.witLinkTypes)},c)})};b.prototype.getRegisteredLinkTypes=function(){if(this.registeredLinkTypes&&!$.isFunction(this.linkTypes))return this.registeredLinkTypes;B("Registered link types are not ready yet. Use beginGetLinkTypes to download.")};b.prototype.getLinkTypes=function(){if(this.linkTypes&&!$.isFunction(this.linkTypes))return this.linkTypes;B("LinkTypes are not ready yet. Use beginGetLinkTypes to download.")};b.prototype.getLinkTypeEnds=function(){var d,b,c,e,a;a=this.linkTypeEnds;if(a)return a;d=this.getLinkTypes();this.linkTypeEnds=a=[];for(c=0,e=d.length;c<e;c++){b=d[c];a.push(b.forwardEnd);b.isDirectional&&a.push(b.reverseEnd)}return a};b.prototype.findLinkType=function(d){var a,e,f=(""+d).toUpperCase(),b=this.getLinkTypes();for(a=0,e=b.length;a<e;a++){var c=b[a];if(c.referenceName.toUpperCase()===f)return c}throw Error.linkTypeDoesNotExist(d);};b.prototype.findLinkTypeEnd=function(c){var b,f,e=(""+c).toUpperCase(),d=this.getLinkTypeEnds();for(b=0,f=d.length;b<f;b++){var a=d[b];if(a.id===c)return a;else if(a.name.toUpperCase()===e)return a;else if(a.immutableName.toUpperCase()===e)return a}throw Error.linkTypeEndDoesNotExist(c);};b.prototype.beginGetAllowedValues=function(b,d,c){var e=this;m(this,this.allowedValues,b,d,c,function(c,d){k.getMSJSON(e.getApiLocation("allowedValues"),{fieldId:b},function(b){a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);c(b)},d)})};b.prototype.beginGetGroups=function(a,b,d,c){var e=this,f=""+(a?a.id:0)+(b?"-global":"");m(this,this.groups,f,d,c,function(c,d){k.getMSJSON((a?a:e).getApiLocation("groups"),{includeGlobal:b},function(a){c(a)},d)})};b.prototype.beginGetWorkItemCategories=function(a,c,b){var d=this,e=""+(a?a.id:0);m(this,this.witCategories,e,c,b,function(b,c){k.getMSJSON((a||d).getApiLocation("workItemTypeCategories"),null,function(a){b(a)},c)})};b.prototype.beginGetWorkItemTypeExtension=function(a,d,c){var b=this;m(this,this.workItemTypeExtensions,a,d,c,function(d,c){k.getMSJSON(b.getApiLocation("workItemTypeExtensions"),{extensionIds:[a]},function(e){var a=e[0];b.beginEnsureConstantSets(a.globals,function(){d(a)},c)},c)})};b.prototype.beginGetWorkItemTypeExtensions=function(a,d,f){var c=this,b=[],e;if(a&&a.length)$.each(a,function(h,g){c.beginGetWorkItemTypeExtension(g,function(e){b.push(e);b.length===a.length&&d.call(c,b)},function(a){!e&&i(a,f,c);e=true})});else d.call(this,b)};b.prototype.beginGetConstantSet=function(b,c,e){var d=this,f=function(a){c&&c.call(d,b,a)};m(this,this.constantSets,b,f,e,function(c,e){k.getMSJSON(d.getApiLocation("constantSets"),{ids:[b]},function(e){var d=e[b];a.ArrayUtils.flagSorted(d,a.StringUtils.localeIgnoreCaseComparer);c(d)},e)})};b.prototype.beginEnsureConstantSets=function(o,r,q){var d=this,c,j,i,b,h=[],f,n=0,l=0,e=0,m=false,s=function(a){if(!m){m=true;$.isFunction(q)&&q.apply(d,a)}},p=function(){e--;if(!m&&e<=0)$.isFunction(r)&&r.apply(d)},t=function(e){var c,f,g;g=vb(d,p,s);for(c=0,f=e.length;c<f;c++){b=e[c];d.constantSets[b]=g.register}k.getMSJSON(d.getApiLocation("constantSets"),{ids:e},function(i){var b,h;for(c=0,f=e.length;c<f;c++){h=e[c];b=i[h];a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);d.constantSets[h]=b}g.finish()},function(b){var a;for(c=0,f=e.length;c<f;c++){a=e[c];delete d.constantSets[a]}g.error(b)})};if(o){var g=[];for(c=0,j=o.length;c<j;c++){b=o[c];i=this.constantSets[b];if(!i)g.push(b);else if($.isFunction(i)){e++;i(p,s)}}g.sort();for(c=0,j=g.length;c<j;c++){b=g[c];if(Ib.test(b)){h.push([b]);e++}else{l=(b+"").length+5;if(n+l>1024){n=0;f=null}if(!f){f=[b];h.push(f);e++}else f.push(b);n+=l}}}while(h.length>0)t(h.pop());e===0&&p()};b.prototype.invalidateExtensions=function(a){var b=this;d.assertParamIsObject(this.workItemTypeExtensions,"this.workItemTypeExtensions");if(!Boolean(a))this.workItemTypeExtensions={};else $.each(a,function(c,a){delete b.workItemTypeExtensions[a]})};b.prototype.getConstantSet=function(a){return this.constantSets[a]};b.prototype.beginPageWorkItems=function(e,d,c,f,b){var g=this,a;if(!$.isArray(e))throw Error.argumentType("ids",null,Array);if(!$.isArray(d))throw Error.argumentType("fields",null,Array);a={workItemIds:e.join(","),fields:d.join(",")};b&&$.extend(a,b);k.postMSJSON(this.getApiLocation("pageWorkItems"),a,function(a){$.isFunction(c)&&c.apply(g,[a])},f)};b.prototype.beginSaveWorkItems=function(b,r,t,m){var o=this,j,s,c,a,e,h=[];if(m===undefined)m=true;var l=function(b,d){var a,c;for(a=0,c=b.length;a<c;a++)b[a]._setSavingStatus(d)},d=function(){try{if(e){e=Error.workItemBulkSave(h);i(e,t,o)}else $.isFunction(r)&&r.call(o,{workItems:b})}finally{l(a,false)}},g=function(b,a){e=Error.serverError(a);m&&b.setError(e);h.push({workItem:b,error:a})},n=function(){a&&a.length===h.length&&d()};if(b&&b.length>0){var p=[],q=[];a=[];for(j=0,s=b.length;j<s;j++){c=b[j];c.fireWorkItemPreSave();if(c.isDirty()){var f=c.getUpdateData();if(f&&f.payload){q.push(f);p.push(f.payload);a.push(c)}}}if(a.length>0){l(a,true);try{k.postMSJSON(this.getApiLocation("updateWorkItems"),{updatePackage:D.stringifyMSJSON(p)},function(b){if(b.length===a.length)$.each(a,function(d,c){var a=b[d];if(a.state===R.Success)o.beginGetWorkItemTypeExtensions(a.currentExtensions,function(b){c.takeUpdateResult(a,q[d],b);h.push({workItem:c});n()},function(a){g(c,a);n()});else{g(c,a.error);n()}});else{$.each(a,function(b,a){g(a,{message:"Server data does not match with what client sent."})});d()}},function(b){$.each(a,function(c,a){g(a,b)});d()})}catch(u){l(a,false);throw u;}}else d()}else d()};b.prototype.beginSaveWorkItemsBatch=function(k,n,m){var e=this,h=[],c=[],f=[],g=false,l={};d.logTracePoint("TFS.WorkItemTracking.WorkItemStore.beginSaveWorkItemsBatch.start");$.each(k,function(b,a){if(a.isValid())h.push(a);else{g=true;f.push({workItem:a,error:Error.workItemSaveFailedDueToInvalidStatus(a)})}});h.length>0&&c.push(h);function j(){var h;if(c.length>0){h=c.pop();if(h.length>b.SAVE_PAGE_SIZE){c.push(h.slice(b.SAVE_PAGE_SIZE));h=h.slice(0,b.SAVE_PAGE_SIZE)}cb(h.length<=b.SAVE_PAGE_SIZE,"Too many work items for batch save.");e.beginSaveWorkItems(h,function(){$.each(h,function(b,a){f.push({workItem:a})});a.delay(e,0,j)},function(b){var q,w,d=0,v=false,u=false,t,s,o,n;function r(g){if(d===0){if(h.length===1&&g)c.push(h);else if(h.length>1){t=h.length/2;c.push(h.slice(t));c.push(h.slice(0,t))}else f.push(b.results[0]);a.delay(e,0,j)}}function x(){d-=1;r(true)}function y(){d-=1;g=true;r(false)}if(b&&b.name===p.WorkItemBulkSaveException){s=b.results;for(q=0,w=s.length;q<w;q++){o=s[q];n=o.workItem;if(o.error&&o.error.errorCode===600122&&!l.hasOwnProperty(n.id)){v=true;l[n.id]=true;d+=1;e._beginTryMergeWorkItem(n,x,y)}else u=true}if(!v&&u)g=true;r(false)}else{$.each(k,function(c,a){a.setError(b)});i(b,m,e)}},false)}else if(g){$.each(f,function(){this.error&&this.workItem.setError(this.error)});i(Error.workItemBulkSave(f),m,e)}else{d.logTracePoint("TFS.WorkItemTracking.WorkItemStore.beginSaveWorkItemsBatch.complete");$.isFunction(n)&&n.call(e,{workItems:k})}}j()};b.prototype.beginGetTagWorkitemIds=function(a,b,c){var d=this;if(!$.isArray(a))throw Error.argumentType("workItemIds",null,Array);k.postMSJSON(this.getApiLocation("getTagWorkitemIds"),{workitemIds:a.join(",")},function(a){var c=d._reduceTagWorkitemAssociation(a);$.isFunction(b)&&b(c)},c)};b.prototype._prepareFields=function(c){var b,d,a;this.fields=[];this.fieldMap={};this.fieldMapById={};for(b=0,d=c.length;b<d;b++){a=new I(this,c[b]);this.fieldMapById[a.id]=a;this.fieldMap[a.name.toUpperCase()]=a;this.fieldMap[a.referenceName.toUpperCase()]=a;this.fields.push(a)}return this.fields};b.prototype._reduceTagWorkitemAssociation=function(f){var b={},d={},c,e;$.each(f,function(g,f){c=d[f.tagDefinition.name.toUpperCase()];if(c==null){b[f.tagDefinition.name]=f.workitemIds;d[f.tagDefinition.name.toUpperCase()]=f.tagDefinition.name}else{e=b[c];b[c]=a.ArrayUtils.union(e,f.workitemIds)}});return b};b.prototype._beginTryMergeWorkItem=function(a,e,b){var f=this;d.assertParamIsObject(a,"workItem");d.assertParamIsFunction(e,"completedCallback");d.assertParamIsFunction(b,"errorCallback");var c={};this.beginGetWorkItemData(a.id,function(d){if(f._hasConflicts(a,d,c)){b(a);return}f._mergeWorkItem(a,d,c);a.evaluate();if(a.isValid())e(a);else b(a)},function(){b(a)})};b.prototype._hasConflicts=function(b,k,e){d.assertParamIsObject(b,"workItem");d.assertParamIsObject(k,"workItemPayload");d.assertParamIsObject(e,"mergedWorkItemUpdates");var i,a,l,j,c,h,g;i=b.getFieldUpdates();for(a in i)if(i.hasOwnProperty(a)){a=Number(a);c=b.getField(a);l=c.getValue(true);j=f.convertValueToExternal(b.store,k.fields[a],c.fieldDefinition.type);if(c.isUserChange()){h=c.getValue();if(!f.compareValues(l,j,false)){if(!f.compareValues(h,j,false))return true}else{e[a]=h;if(a===-104){g=b.getField(-105);e[-105]=g.getValue()}else if(a===-2){g=b.getField(-7);e[-7]=g.getValue()}}}}return false};b.prototype._mergeWorkItem=function(a,k,f){d.assertParamIsObject(a,"workItem");d.assertParamIsObject(k,"workItemPayload");d.assertParamIsObject(f,"mergedWorkItemUpdates");var b,h,c,j,i,e,g;c=a.getLinkUpdates();a._load(k,true);for(g in f)f.hasOwnProperty(g)&&a._setFieldValueById(g,f[g],false);if(c){if(c.addedLinks){j=c.addedLinks;for(b=0,h=j.length;b<h;b++){e=A.createFromLinkData(a,j[b]);a.addLink(e)}}if(c.deletedLinks){i=c.deletedLinks;for(b=0,h=i.length;b<h;b++){e=a.findLink(A.createFromLinkData(a,i[b]));e&&a.removeLinks([e])}}}};b.FutureDate=new Date(2533707648e5);b.SAVE_PAGE_SIZE=200;return b}(q.CollectionLevelTfsService);e.WorkItemStore=o;var Rb=function(){function a(a){this.workItemManager=a}a.prototype.workItemsChanged=function(a){a.change===n.Saved&&a.changedWorkItemLinks&&this.updateWorkItemLinkTargets(a.changedWorkItemLinks)};a.prototype.updateWorkItemLinkTargets=function(d){var c,e,a,b,f=this.workItemManager;for(c=0,e=d.length;c<e;c++){a=d[c];b=f.getWorkItem(a.targetId);if(b)if(a.command==="add")this.addWorkItemLink(b,a);else a.command==="remove"&&this.deleteWorkItemLink(b,a)}};a.prototype.addWorkItemLink=function(a,e){var f,b,d=e.linkData,g=a.store.findLinkTypeEnd(d.LinkType).oppositeEnd.id;f=this.findWorkItemLink(a,e.sourceId,g);if(f)f.linkData["Changed Date"]=d["Changed Date"];else{b=$.extend({},d);b.ID=e.sourceId;b.LinkType=g;a.allLinks.push(new s(a,b))}a.resetLinks();a.fireFieldChange([c.DalFields.RelatedLinks])};a.prototype.deleteWorkItemLink=function(a,e){var b,d=e.linkData,f=a.store.findLinkTypeEnd(d.LinkType).oppositeEnd.id;b=this.findWorkItemLink(a,e.sourceId,f);if(b){b.linkData["Revised Date"]=d["Revised Date"];b.linkData["Revised By"]=d["Revised By"]}a.resetLinks();a.fireFieldChange([c.DalFields.RelatedLinks])};a.prototype.findWorkItemLink=function(g,f,e){var b,d,a,c=g.getLinks();for(b=0,d=c.length;b<d;b++){a=c[b];if(a instanceof s&&a.getTargetId()===f&&a.getLinkType()===e)return a}};return a}(),ub=function(){function a(c){var b=this;this._downloading=false;this.hasDirtyManager=false;this.store=c;this.cache={};this.pinCounts={};this.pendingWorkitems={};this._workItemChangedDelegate=Bb(this,this.onWorkItemChanged);this.events=new Sys.EventHandlerList;this.linkManager=new Rb(this);this.cleanerTimer=window.setInterval(function(){b.cleanCache()},a.cacheCleanupTimeout);x.runningDocumentsTable.add(c.path()+"/WorkItemManager",{isDirty:function(){return b.isDirty(true)},beginSave:function(c,a){return b.beginSaveDirtyWorkItems(c,a)},getDirtyDocumentTitles:function(g){var a,f,e=[],d,c=b.getDirtyWorkItems();for(a=0,f=Math.min(g,c.length);a<f;a++){d=c[a];e.push(d.getCaption(false))}return e}})}a.prototype.dispose=function(){if(this.cleanerTimer){window.clearInterval(this.cleanerTimer);this.cleanerTimer=null}};a.prototype.invalidateCache=function(c){d.assertParamIsArray(c,"workItemIds");var b,f,e,a;for(b=0,f=c.length;b<f;b+=1){a=c[b];e=this.cache[a];if(e)if(!this.isPinned(a)&&!e.workItem.isDirty())delete this.cache[a]}};a.prototype.cleanCache=function(){var b,c,d,e=+new Date;c=this.cache;for(b in c)if(c.hasOwnProperty(b)){d=this.cache[b];if(e-d.timeStamp>a.cacheCleanupTimeout&&!this.isPinned(b))if(!d.workItem.isDirty())delete c[b]}};a.prototype.resetCache=function(){this.pinCounts={};this.cache={};this.pendingWorkitems={}};a.prototype._touchCache=function(c,b){var a=this.cache[c];if(a&&a.workItem===b)a.timeStamp=+new Date};a.prototype._decrementPinCount=function(b){var a=this.pinCounts[b]||0;a--;if(a<=0)delete this.pinCounts[b];else this.pinCounts[b]=a};a.prototype._incrementPinCount=function(b){var a=this.pinCounts[b]||0;a++;this.pinCounts[b]=a};a.prototype.pin=function(a){if(!(a instanceof u))throw Error.argumentType("workItem");if(a.id>0){this._touchCache(a.id,a);this._incrementPinCount(a.id)}if(a.tempId<0){this._touchCache(a.tempId,a);this._incrementPinCount(a.tempId)}};a.prototype.unpin=function(a){if(!(a instanceof u))throw Error.argumentType("workItem");if(a.id>0){this._touchCache(a.id,a);this._decrementPinCount(a.id)}if(a.tempId<0){this._touchCache(a.tempId,a);this._decrementPinCount(a.tempId)}};a.prototype.isPinned=function(a){return(this.pinCounts[a]||0)>0};a.prototype.createWorkItem=function(c,b,d){var a=c.create(b,d);this.setWorkItem(a);this.onWorkItemChanged(this,{workItem:a,change:n.Created});return a};a.prototype.beginGetWorkItem=function(d,a,b){var c=this;this.beginGetWorkItems([d],function(b){$.isFunction(a)&&a.call(c,b&&b[0])},b)};a.prototype.beginGetWorkItems=function(n,k,q,b){var f=this,h=[],g={},d={},c=0,l=a.PAGE_SIZE,e;b=b||{};if(b.pageSize&&Number(b.pageSize)>0)l=b.pageSize;var j=function(){if(!e&&c<=0){e=true;$.isFunction(k)&&k.call(f,$.map(n,function(a){return g[a]}))}},r=function(a,b){c--;delete d[a];g[a]=b;j()},o=function(){$.each(d,function(a,b){d.hasOwnProperty(a)&&f._cancelPendingGetWorkItem(a,b)});c=0;d={}},m=function(a){if(!e){e=true;o();i(a,q,f)}},p=function(b,a){c--;delete d[b];m(a)},s=function(){!e&&m(Error.canceled())};$.each(n,function(e,a){var b=f.getWorkItem(a);if(b){h.push(a);g[a]=b}else{c++;d[a]=f._pendWorkItem(a,r,p)}});b.cancelable&&b.cancelable.register(s);$.isFunction(b.pageOperationCallback)&&h.length>0&&b.pageOperationCallback($.map(h,function(a){return g[a]}));if(c)this._downloadPendingWorkItems(b.pageOperationCallback,l);else j()};a.prototype.getWorkItem=function(c){var b,a=this.cache[c];if(a){a.timeStamp=+new Date;b=a.workItem}return b};a.prototype.bind=function(a){if(!(a instanceof u))throw Error.argumentType("workItem");a.attachWorkItemChanged(this._workItemChangedDelegate)};a.prototype.unbind=function(a){if(!(a instanceof u))throw Error.argumentType("workItem");a.detachWorkItemChanged(this._workItemChangedDelegate)};a.prototype.setWorkItem=function(a){var b;if(!(a instanceof u))throw Error.argumentType("workItem");a._setManager(this);b={workItem:a,timeStamp:+new Date};if(a.id>0)this.cache[a.id]=b;if(a.tempId<0)this.cache[a.tempId]=b};a.prototype.removeWorkItem=function(a){if(!(a instanceof u))throw Error.argumentType("workItem");if(a.id>0){delete this.cache[a.id];delete this.pinCounts[a.id]}if(a.tempId<0){delete this.cache[a.tempId];delete this.pinCounts[a.tempId]}a._setManager(null)};a.prototype.getManagedWorkItems=function(){var a,d=[],c=this.cache,b;for(a in c)if(c.hasOwnProperty(a)){b=c[a].workItem;if(a<0&&b.id!==0)continue;d.push(b)}return d};a.prototype.getDirtyWorkItems=function(){var a,d,c=[],b=this.getManagedWorkItems();for(a=0,d=b.length;a<d;a++)b[a].isDirty()&&c.push(b[a]);return c};a.prototype.beginSaveDirtyWorkItems=function(b,a){return this.store.beginSaveWorkItemsBatch(this.getDirtyWorkItems(),b,a)};a.prototype.onWorkItemChanged=function(c,a){a.change===n.Saved&&this.setWorkItem(a.workItem);this.linkManager.workItemsChanged(a);var b=this.events.getHandler("work-item-changed");b&&b(this,a)};a.prototype.attachWorkItemChanged=function(a){this.events.addHandler("work-item-changed",a)};a.prototype.detachWorkItemChanged=function(a){this.events.removeHandler("work-item-changed",a)};a.prototype.isDirty=function(d){var a,c,b=this.getManagedWorkItems();for(a=0,c=b.length;a<c;a++)if(b[a].isDirty(d))return true;return false};a.prototype._pendWorkItem=function(c,g,f){var a=this,b=this.pendingWorkitems[c],e=function(c,b){delete a.pendingWorkitems[c];if(!a.getWorkItem(c)){a.setWorkItem(b);a.onWorkItemChanged(a,{workItem:b,change:n.Opened})}g.call(a,c,b)},d=function(b,c){delete a.pendingWorkitems[b];f.call(a,b,c)};if(b)return b.cbQueue.register(e,d);else{b={id:c,cbQueue:vb(this,e,d)};this.pendingWorkitems[c]=b;return b.cookie}};a.prototype._cancelPendingGetWorkItem=function(b,c){var a=this.pendingWorkitems[b];if(a){a.cbQueue.unregister(c);if(a.cbQueue.count()===0)delete this.pendingWorkitems[b]}};a.prototype._downloadPendingWorkItems=function(b,d){var c=this,a=[];if(!this._downloading){$.each(this.pendingWorkitems,function(e,b){if(c.pendingWorkitems.hasOwnProperty(e)){a.push(b);if(a.length>d)return false}});if(a.length){this._downloading=true;this.store.beginGetWorkItems($.map(a,function(a){return a.id}),function(f){var e={};try{$.each(f,function(b,a){e[a.id]=a});$.each(a,function(b,a){a.cbQueue.finish(a.id,e[a.id])});b&&$.isFunction(b)&&b(f)}finally{c._downloading=false;c._downloadPendingWorkItems(b,d)}},function(e){try{$.each(a,function(b,a){a.cbQueue.error(a.id,e)})}finally{c._downloading=false;c._downloadPendingWorkItems(b,d)}})}}};a.cacheCleanupTimeout=6e4;a.PAGE_SIZE=200;return a}();e.WorkItemManager=ub;var K=function(){function a(n,b){var a,c,e,d,o,g,f,j,p,k,m,l,i,h;this.project=n;this.store=n.store;this.id=b.id;this.name=b.name;e=b.fields;this.form=b.rules.form;this.triggerList=b.rules.triggerList;k=b.rules.fieldRules;m=b.rules.fieldHelpTexts;f=this.fieldMap={};j=this.fieldMapById={};g=this.fields=[];i=this.store.fieldMap;h=this.store.fieldMapById;for(d=0,o=e.length;d<o;d++){c=e[d];l=h[c]||i[c];a=new I(this,l,k[c],m[c]||"");j[a.id]=a;f[a.name.toUpperCase()]=a;f[a.referenceName.toUpperCase()]=a;g[g.length]=a}}a.prototype.path=function(){return this.project.path()+"/wit/"+this.name};a.prototype.create=function(a,b){return new u(this,a,b)};a.prototype.getFieldDefinition=function(b){var a=(""+b).toUpperCase();return this.fieldMapById[a]||this.fieldMap[a]};a.prototype.getTriggerList=function(){var b=this,a=[];this.triggerList&&$.each(this.triggerList,function(d,c){b.getFieldDefinition(c)&&a.push(c)});return a};return a}();e.WorkItemType=K;l.initClassPrototype(K,{project:null,store:null,id:null,name:null,fields:null,fieldMap:null,fieldMapById:null,form:null,triggerList:null});var I=function(){function a(b,a,d,c){if(b instanceof o)this.store=b;else{this.workItemType=b;this.store=b.store}this.id=a.id;this.name=a.name;this.referenceName=a.referenceName;this.flags=a.flags;this.type=a.type;this.usages=a.usages;this.rules=d;this.helpText=c||""}a.prototype.checkFlag=function(a){return(this.flags&+a)!==0};a.prototype.canSortBy=function(){return this.checkFlag(1)};a.prototype.isCloneable=function(){return this.checkFlag(128)};a.prototype.isComputed=function(){return this.checkFlag(2)};a.prototype.supportsTextQuery=function(){return this.checkFlag(512)};a.prototype.isEditable=function(){switch(this.id){case-7:case-105:return true;case-3:case 8:case 25:case 33:return false}return!this.isComputed()};return a}();e.FieldDefinition=I;l.initClassPrototype(I,{store:null,workItemType:null,id:null,name:null,referenceName:null,type:null,usages:0,flags:0,rules:null,helpText:""});var R;(function(a){a.NoResult="NoResult";a.Error="Error";a.Success="Success"})(R||(R={}));var N=0,u=function(){function b(a,c,b){this._saving=false;this.id=0;this.tempId=0;this.revision=0;this.workItemType=a;this.store=a.store;this.project=a.project;this.extensions=b||[];this.fields=[];this.events=new Sys.EventHandlerList;this.fieldMap={};this.fieldMapById={};this._eventsEnabled=false;this._defineWorkItemTypeFields();this._defineExtensionFields();this._load(c,false);this._eventsEnabled=true}b.getTempId=function(){return--N};b.getTempIdSeed=function(){return N};b.reserveTempId=function(a){if(N>a)N=a};b.prototype._defineField=function(c){if(!this.fieldMap.hasOwnProperty(c.toUpperCase())){var a=this.workItemType.getFieldDefinition(c);if(!a)a=this.store.getFieldDefinition(c);if(a&&!Boolean(this.fieldMapById[a.id+""])){var b=new f(this,a);this.fieldMap[a.referenceName.toUpperCase()]=b;this.fieldMap[a.name.toUpperCase()]=b;this.fieldMapById[a.id+""]=b;this.fields.push(b)}}};b.prototype._defineWorkItemTypeFields=function(){var a=this;$.each(this.workItemType.fields,function(c,b){a._defineField(b.referenceName)})};b.prototype._defineExtensionFields=function(){var a=this;this.extensions&&$.each(this.extensions,function(c,b){b.markerField&&a._defineField(b.markerField.field.referenceName);b.fields&&$.each(b.fields,function(c,b){a._defineField(b.field.referenceName)})})};b.prototype._setManager=function(a){if(this._manager!==a){this._manager&&this._manager.unbind(this);this._manager=a;this._manager&&this._manager.bind(this)}};b.prototype.discardIfNew=function(){if(this.isNew()){this.fireWorkItemDiscarded();this._manager&&this._manager.removeWorkItem(this)}};b.prototype.isNew=function(){return+this.id<1};b.prototype.resetManualFieldChanges=function(){this.manuallySetFields={}};b.prototype.isDirty=function(e){var c,b,d,a;if(this._fieldsDirty(e))return true;c=this.allLinks;for(b=0,d=c.length;b<d;b++){a=c[b];if(a.isRemoved())continue;if(a.deleted!==a.isNew())return true;else if(a.updated)return true}return false};b.prototype.isValid=function(){var a=this.getInvalidFields(true);return!a||a.length===0};b.prototype.isReadOnly=function(){return false};b.prototype.isExtensionMarkerField=function(c){var b=false;this.extensions&&$.each(this.extensions,function(e,d){if(a.StringUtils.ignoreCaseComparer(d.markerField.field.referenceName,c.referenceName)===0){b=true;return false}});if(b==false)if(a.StringUtils.startsWith(c.referenceName,"WEF")&&a.StringUtils.endsWith(c.referenceName,"System.ExtensionMarker"))b=true;return b};b.prototype.getUniqueId=function(){return this.id||this.tempId};b.prototype.setError=function(a){d.assertParamIsObject(a,"error");this._error=a;this.fireWorkItemErrorChanged()};b.prototype.clearError=function(){if(this._error){this._error=null;this.fireWorkItemErrorChanged()}};b.prototype.getError=function(){return this._error};b.prototype.hasError=function(){return this._error?true:false};b.prototype.getInvalidFields=function(f){var a,e,b,c,d=[];b=this.fields;for(a=0,e=b.length;a<e;a++){c=b[a];if(!c.isValid()){d.push(c);if(f)break}}return d};b.prototype.setFieldValue=function(b,c){var a=this.getField(b);if(a){a.setValue(c);return true}else return false};b.prototype.getFieldValue=function(b,d,c){var a=this.getField(b);if(a)return a.getValue(d,c)};b.prototype._getFieldValueById=function(d,a,f){var e=this.fieldUpdates,b;switch(d){case-31:return this._getLinkCount(M,a);case-57:return this._getLinkCount(Z,a);case-32:return this._getLinkCount(ab,a);case 75:return this._getLinkCount(s,a);case-42:return this.project?this.project.name:""}var c=d+"";if(!a&&e.hasOwnProperty(c)){b=e[c];if(b.setByRule){if(!f)return b.value}else return b.value}return d===54?"":this.fieldData[c]};b.prototype._setFieldValueById=function(d,b,c){switch(d){case-31:case-57:case-32:case 75:return;case-2:case-104:if(!this.project.findNodeById(b))throw Error.create("Invalid node id.");}var a=d+"",e=this.fieldData[a];if(!c&&this.manuallySetFields)this.manuallySetFields[a]=b;if(!f.compareValues(e,b))this.fieldUpdates[a]={value:b,setByRule:c};else{delete this.fieldUpdates[a];if(this.manuallySetFields)delete this.manuallySetFields[a]}};b.prototype.getFieldValueByRevision=function(f,a){var c,g,e,b=this.revisions,d=f+"";if(a<0)return null;else if(f===54)return a<b.length?b[a][d]:this.fieldData[d];else{e=this.getComputedFieldValue(f,a);if(e&&e.success)return e.value;g=this._getFieldValueById(f,true);for(c=b.length-1;c>=a;c--)if(b[c].hasOwnProperty(d))g=b[c][d];return g}};b.prototype.getComputedFieldValue=function(b,a){switch(b){case-42:return{success:true,value:this.project?this.project.name:""};case-12:return this.computeFieldValue(-12,-2,a);case-105:return this.computeFieldValue(-105,-104,a);case-7:return this.computeFieldValue(-7,-2,a);default:return null}};b.prototype.isSaving=function(){return this._saving};b.prototype.getTitle=function(){return this._getFieldValueById(1)||""};b.prototype.getCaption=function(c){var b;if(this.isNew())b=a.StringUtils.format(g.WorkItemEditorCaptionNew,this.workItemType.name,-this.tempId);else b=a.StringUtils.format(g.WorkItemEditorCaption,this.workItemType.name,this.id);if(c&&this.isDirty(true))b=a.StringUtils.format(g.WorkItemEditorDirtyCaption,b);return b};b.prototype.getInfoText=function(){var b,a={};b=this.getInvalidFields(true);if(b&&b.length>0){a.text=b[0].getErrorText();a.invalid=true}else if(this.hasError()){a.text=Mb(this.getError());a.invalid=true}else a.text=this.getTitle();return a};b.prototype.getState=function(){return this._getFieldValueById(2)||""};b.prototype.getPerson=function(a){return this.referencedPersons[a]||this.store.getCurrentUser()};b.prototype.getIdentity=function(a){return this.referencedIdentities[a]};b.prototype.addRef=function(){this._manager&&this._manager.pin(this)};b.prototype.release=function(){this._manager&&this._manager.unpin(this)};b.prototype.attachEvent=function(a,b){this.events.addHandler(a,b)};b.prototype.detachEvent=function(a,b){this.events.removeHandler(a,b)};b.prototype.fireEvent=function(c,b){if(this._eventsEnabled){var a=this.events.getHandler(c);a&&a(this,b)}};b.prototype.attachWorkItemChanged=function(a){this.attachEvent("workitem-changed",a)};b.prototype.detachWorkItemChanged=function(a){this.detachEvent("workitem-changed",a)};b.prototype.fireWorkItemChanged=function(a){a&&a.change!==n.ErrorChanged&&a.change!==n.SaveCompleted&&this.clearError();this.fireEvent("workitem-changed",a)};b.prototype.fireWorkItemPreSave=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.PreSave},a))};b.prototype.fireWorkItemSaved=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.Saved},a))};b.prototype.fireWorkItemSaving=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.Saving},a))};b.prototype.fireWorkItemRefresh=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.Refresh},a))};b.prototype.fireWorkItemReset=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.Reset},a))};b.prototype.fireWorkItemDiscarded=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.Discarded},a))};b.prototype.fireWorkItemSaveComplete=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.SaveCompleted},a))};b.prototype.fireWorkItemErrorChanged=function(a){this.fireWorkItemChanged($.extend({workItem:this,change:n.ErrorChanged},a))};b.prototype.fireFieldChange=function(e){var g,i,f,a,b={};if(this._eventsEnabled)if(e){for(g=0,i=e.length;g<i;g++){a=e[g];if(!b.hasOwnProperty(a)){f=this.getField(a);if(f){var h=f.fieldDefinition.id,d;b[h]=f;switch(h){case c.DalFields.AttachedFiles:d=-31;break;case c.DalFields.RelatedLinks:d=75;break;case c.DalFields.LinkedFiles:d=-32;break;case c.DalFields.BISURI:d=-57}if(d)b[d]=this.getField(d)}else b[a]=null}}e=[];for(a in b)if(b.hasOwnProperty(a)){f=b[a];e[e.length]=a;this.fireEvent("field-change:"+a,f)}}this.fireWorkItemChanged({workItem:this,change:n.FieldChange,changedFields:b})};b.prototype.attachFieldChange=function(a,b){var c=this.getField(a);if(c)this.attachEvent("field-change:"+c.fieldDefinition.id,b);else this.attachEvent("field-change:"+a,b)};b.prototype.detachFieldChange=function(a,b){var c=this.getField(a);if(c)this.detachEvent("field-change:"+c.fieldDefinition.id,b);else this.detachEvent("field-change:"+a,b)};b.prototype.getField=function(b){var a=(""+b).toUpperCase();return this.fieldMapById[a]||this.fieldMap[a]};b.prototype.computeFieldValue=function(j,k,l){var i,b,d={success:false},h=this.project,a;i=j instanceof f?j.fieldDefinition.id:j;if(l>=0)b=this.getFieldValueByRevision(k,l);else b=this._getFieldValueById(k);function e(c){if(b){a=h.findNodeById(b);if(a){d.value=t.getNodeSegments(a)[c];d.success=true}}}switch(i){case-2:case-104:if(b){a=i===-2?h.findAreaNodeByPath(b):h.findIterationNodeByPath(b);if(a){d.value=a.id;d.success=true}}break;case c.DalFields.AreaLevel1:case c.DalFields.IterationLevel1:e(0);break;case c.DalFields.AreaLevel2:case c.DalFields.IterationLevel2:e(2);break;case c.DalFields.AreaLevel3:case c.DalFields.IterationLevel3:e(3);break;case c.DalFields.AreaLevel4:case c.DalFields.IterationLevel4:e(4);break;case c.DalFields.AreaLevel5:case c.DalFields.IterationLevel5:e(5);break;case c.DalFields.AreaLevel6:case c.DalFields.IterationLevel6:e(6);break;case c.DalFields.AreaLevel7:case c.DalFields.IterationLevel7:e(7);break;case-7:case-105:if(b){a=h.findNodeById(b);if(a){d.value=t.getPath(a,1);d.success=true}else{d.value=i===-7?g.DeletedAreaPath:g.DeletedIterationPath;d.success=true}}break;case-12:if(b){a=h.findNodeById(b);if(a){d.value=a.name;d.success=true}}}return d};b.prototype.beginSave=function(b,a){var c=this;return this.store.beginSaveWorkItemsBatch([this],b,function(b){if(b&&b.name===p.WorkItemBulkSaveException)b=b.results[0].error;i(b,a,c)})};b.prototype.getFieldUpdates=function(){var f={},b,a,c,e,d=this.fieldUpdates,h=this.workItemType.fieldMap,g=this.workItemType.fieldMapById;for(a in d)if(d.hasOwnProperty(a)){c=g[a]||h[a];if(c&&c.checkFlag(2))continue;b=d[a].value;if(typeof b==="undefined")b=null;f[a]=b;e=true}return e?f:null};b.prototype.getTemplateFieldValues=function(){var c=this,b={},a=this.initialValues||{};$.each(this.manuallySetFields,function(k,j){var d=+k,g=c.getField(d),e,h,i=d+"";if(d===-2||d===-104)return;e=g.getValue();if(e instanceof v)return;if(a.hasOwnProperty(i))h=!f.compareValues(a[i].value,j);else h=!f.compareValues(g.getValue(true),j);if(h)b[g.fieldDefinition.referenceName]=e});return b};b.prototype.getLinkUpdates=function(c){var g,i,h,a,d,e,f,b=null;h=this.allLinks;d=[];e=[];f=[];for(g=0,i=h.length;g<i;g++){a=h[g];if(a.isRemoved())continue;if(a.deleted){d.push(a.linkData);c&&c.deletedLinks.push(a)}else if(a.isNew()){f.push(a.linkData);c&&c.addedLinks.push(a)}else if(a.updated){e.push(a.linkData);c&&c.updatedLinks.push(a)}}if(d.length>0){b=b||{};b.deletedLinks=d}if(e.length>0){b=b||{};b.updatedLinks=e}if(f.length>0){b=b||{};b.addedLinks=f}return b};b.prototype.getUpdateData=function(){var b=false,c={uniqueId:this.getUniqueId(),id:this.id,tempId:this.tempId,rev:this.revision,projectId:this.project.guid,addedLinks:[],deletedLinks:[],updatedLinks:[]},a={id:this.id,rev:this.revision,projectId:this.project.guid,isDirty:this._fieldsDirty()};if(this.isNew())a.tempId=this.tempId;var d=this.getFieldUpdates();if(d){a.fields=d;b=true}var e=this.getLinkUpdates(c);if(e){a.links=e;b=true}if(b)c.payload=a;return c};b.prototype.takeUpdateResult=function(c,l,j){var k=this.id;this.ruleEngine=null;this.extensions=j;this._defineExtensionFields();if(c.rev!==this.revision){this._setFieldValueById(-3,c.id);this.id=c.id;this._setFieldValueById(8,c.rev);this.revision=c.rev;var a,h=c.fields;if(h)for(a in h)h.hasOwnProperty(a)&&this._setFieldValueById(+a,h[a]);var e=this.fieldUpdates,b=this.fieldData,d;if(c.rev===1){for(a in e)if(e.hasOwnProperty(a))b[a]=e[a].value}else{d={};for(a in e)if(e.hasOwnProperty(a)){d[a]=b[a];b[a]=e[a].value}var f="54";if(b.hasOwnProperty(f)&&!d.hasOwnProperty(f)){d[f]=b[f];delete b[f]}this.revisions.push(d)}var g="9";if(d&&b.hasOwnProperty(g))d[g]=b[g];b[g]=this.store.getCurrentUser();this.fieldUpdates={}}var i=this._takeLinkUpdateResult(c,l);this.resetHistory();this.evaluate(i.changedFields);this.resetManualFieldChanges();this.fireWorkItemSaved({changedWorkItemLinks:i.changedWorkItemLinks,firstSave:k!==this.id})};b.prototype._takeLinkUpdateResult=function(i,l){var a=this,j=this.allLinks,b={},d=[],f=function(b){return b.SourceID==a.id?{targetId:b.TargetID,linkType:b.LinkType}:{targetId:b.SourceID,linkType:a.store.findLinkTypeEnd(b.LinkType).oppositeEnd.id}},g=function(c,b){var a=null;$.each(j,function(f,e){if(e instanceof s&&!e.isRemoved()){var d=e;if(d.getTargetId()==c)if(d.getLinkType()==b){a=d;return false}}});return a};$.each(l.deletedLinks,function(e,d){if(!(d instanceof s)){b[""+d.getFieldId()]=true;d.linkData.RemovedDate=a._getFieldValueById(c.DalFields.LastChangedDateId)}});$.each(i.deletedLinks,function(i,e){var h=f(e),c=g(h.targetId,h.linkType);if(c){b[""+c.getFieldId()]=true;c.linkData["Revised Date"]=e.ChangedDate;c.linkData["Revised By"]=e.ChangedBy;d.push({command:"remove",sourceId:a.id,targetId:c.getTargetId(),linkData:c.linkData})}});var e=[];$.each(l.addedLinks,function(b,a){!(a instanceof s)&&e.push(a)});$.each(i.addedLinks,function(m,i){var k;if(i.ExtID){k=e.shift();if(k){b[""+k.getFieldId()]=true;k.linkData.ExtID=i.ExtID;k.linkData.AddedDate=a._getFieldValueById(c.DalFields.LastChangedDateId)}}else{var l=f(i),h=g(l.targetId,l.linkType);if(!h){h=s.create(a,l.linkType,l.targetId,null);j.push(h)}b[""+h.getFieldId()]=true;h.linkData["Changed Date"]=i.ChangedDate;h.linkData["Changed By"]=i.ChangedBy;d.push({command:"add",sourceId:a.id,targetId:h.getTargetId(),linkData:h.linkData})}});this.resetLinks();var h=[];for(var k in b)b.hasOwnProperty(k)&&h.push(+k);return{changedFields:h,changedWorkItemLinks:d}};b.prototype._getRuleEngine=function(){if(!this.ruleEngine){var a=[];$.each(this.workItemType.fields,function(c,b){b.rules&&a.push({fieldId:b.id,rules:b.rules})});this.extensions&&$.each(this.extensions,function(c,b){b.fieldRules&&$.each(b.fieldRules,function(b,c){a.push({fieldId:b,rules:c})})});this.ruleEngine=new Sb(this,a)}return this.ruleEngine};b.prototype.evaluate=function(c){var b=[],a={};$.each(this.workItemType.getTriggerList(),function(e,d){var c=d+"";if(!a.hasOwnProperty(c)){b.push(d);a[c]=true}});$.each(this.fields,function(f,e){var d=e.fieldDefinition.id,c=d+"";if(!a.hasOwnProperty(c)){b.push(d);a[c]=true}});this.evaluateFields(b,c)};b.prototype.evaluateField=function(c,a,b){return this._getRuleEngine().evaluateField(c,a,b)};b.prototype.evaluateFields=function(e,c){var b={};c&&$.each(c,function(c,a){b[a+""]=true});var d=this._getRuleEngine().evaluateFields(e);d&&$.each(d,function(c,a){b[a+""]=true});this.fireFieldChange(a.keys(b))};b.prototype.resetLinks=function(e){var a,d,b,c;this.links=null;if(e){b=this.allLinks;for(a=0,d=b.length;a<d;a++){c=b[a];if(c.deleted&&c.isNew()){b.splice(a--,1);d--}}}};b.prototype.getLinks=function(){var d,b,e,c,a;if(!this.links){this.links=d=[];c=this.allLinks;for(b=0,e=c.length;b<e;b++){a=c[b];!a.deleted&&!a.isRemoved()&&d.push(a)}}return this.links};b.prototype.findLink=function(c){d.assertParamIsObject(c,"link");var a,e,b=this.allLinks;for(a=0,e=b.length;a<e;a++)if(b[a].equals(c))return b[a];return undefined};b.prototype.addLink=function(a){this.addLinks([a])};b.prototype.addLinks=function(b){var a,f,c={};for(a=0,f=b.length;a<f;a++){c[b[a].getFieldId()]=true;this.allLinks.push(b[a])}if(b.length){this.resetLinks();var d=[];for(var e in c)c.hasOwnProperty(e)&&d.push(+e);this.evaluateFields(d,d)}};b.prototype.removeLinks=function(g){for(var e=0,a={},d=0,h=g.length;d<h;d++){var c=g[d];if(!c.getIsLocked()){c.remove({preventEvent:true});a[c.getFieldId()]=true;e++}}if(e){var b=[];for(var f in a)a.hasOwnProperty(f)&&b.push(+f);this.resetLinks(true);this.evaluateFields(b,b)}};b.prototype.getHistory=function(){if(!this.history)this.history=new tb(this);return this.history};b.prototype.resetHistory=function(){this.history=null};b.prototype.reset=function(){var a,e,d,b;this.fieldUpdates={};this.evaluate();this.resetManualFieldChanges();this.links=null;b=this.allLinks;for(a=0,e=b.length;a<e;a++){d=b[a];if(d.isNew()){b.splice(a--,1);e--}else d.deleted=false}this.fireFieldChange([c.DalFields.RelatedLinks,c.DalFields.BISURI,c.DalFields.LinkedFiles,c.DalFields.AttachedFiles,c.DalFields.Tags]);this.fireWorkItemReset()};b.prototype.beginRefresh=function(a,c){var b=this;if(this.isNew())try{this.reset();$.isFunction(a)&&a.call(this,this)}catch(d){i(d,c,this)}else this.store.beginGetWorkItemData(this.id,function(c){b._load(c,true);b.fireWorkItemRefresh();$.isFunction(a)&&a.call(b,b)},c)};b.prototype._copyField=function(d,a,e){var c,b;if(a.isCloneable()){c=this.getField(a.id);if(c){b=c.getValue();if(!f.isEmpty(b)){if(a.id===-2||a.id===-104)if(typeof b!=="number"||this.project.id!==e.project.id)return;d.setFieldValue(a.id,b)}}}};b.prototype.copy=function(b,m,k,o,u){var d,f,x,i,w,v,h,r,q,p=[],e,n,j={},t,l;b=b instanceof K?b:this.workItemType;m=typeof m!=="boolean"?true:m;k=typeof k!=="boolean"?true:k;o=typeof o!=="boolean"?true:o;$.each(u||[],function(b,a){j[a]=true});e=b.store.workItemManager.createWorkItem(b);for(d=0,f=b.triggerList.length;d<f;d++){t=b.triggerList[d];l=t.toString();if(!j.hasOwnProperty(l)){i=b.fieldMapById[l];this._copyField(e,i,b);j[l]=true}}for(d=0,f=b.fields.length;d<f;d++){i=b.fields[d];!j.hasOwnProperty(i.id.toString())&&this._copyField(e,i,b)}if(k){if(!this.isNew()){h=a.StringUtils.format("<a href='x-mvwit:workitem/{0}'>{1} {0}</a>",this.id,this.workItemType.name);n=a.StringUtils.format(g.CreateCopyCopiedFrom,h)}else n=g.CreateCopyCopiedFromNewWorkItem;e.setFieldValue(54,n)}if(m){r=this.getLinks();for(d=0,f=r.length;d<f;d++){h=r[d];if(h instanceof M)continue;q=h.clone(e);q&&p.push(q)}!this.isNew()&&p.push(s.create(e,this.store.findLinkTypeEnd("System.LinkTypes.Related-Forward"),this.id,""));e.addLinks(p)}e.evaluate([c.DalFields.RelatedLinks,c.DalFields.AttachedFiles,c.DalFields.BISURI,c.DalFields.LinkedFiles]);return e};b.prototype.getTagNames=function(){return this._splitTagNames(this.getFieldValue(c.DalFields.Tags))};b.prototype._splitTagNames=function(a){return a?$.trim(a).split(/;\s*/):[]};b.prototype._load=function(d,j){var k=this,f,i,e,h,g,l;d=d||{};this.fieldData=d.fields||{};this.revisions=d.revisions||[];this.fieldUpdates={};$.each(this.fieldData,function(a){k._defineField(a)});j&&$.each(this.fields,function(b,a){a._reset()});e=[];d.files&&a.ArrayUtils.addRange(e,d.files);d.relations&&a.ArrayUtils.addRange(e,d.relations);d.relationRevisions&&a.ArrayUtils.addRange(e,d.relationRevisions);this.allLinks=h=[];this.links=null;for(f=0,i=e.length;f<i;f++)h.push(A.createFromLinkData(this,e[f]));this.referencedPersons=d.referencedPersons||{};this.referencedIdentities=d.referencedIdentities||{};this.id=this._getFieldValueById(-3)||0;if(this.id===0)if(d.tempId){this.tempId=d.tempId;b.reserveTempId(this.tempId)}else this.tempId=b.getTempId();this.revision=this._getFieldValueById(8)||0;if(this.isNew()){g=this.project.id;this._setFieldValueById(-2,g,true);this._setFieldValueById(-104,g,true);this._setFieldValueById(25,this.workItemType.name,true)}this.resetHistory();this.evaluate([c.DalFields.RelatedLinks,c.DalFields.AttachedFiles,c.DalFields.BISURI,c.DalFields.LinkedFiles]);if(this.isNew())this.initialValues=$.extend({},this.fieldUpdates);this.resetManualFieldChanges()};b.prototype._fieldsDirty=function(c){var a,b;if(c){if(this.manuallySetFields)for(a in this.manuallySetFields)if(this.manuallySetFields.hasOwnProperty(a))return true}else if(this.isNew())return true;else{b=this.fieldUpdates;for(a in b)if(b.hasOwnProperty(a))if(!b[a].setByRule)return true}return false};b.prototype._setSavingStatus=function(a){if(this._saving!==a){this._saving=a;if(a)this.fireWorkItemSaving();else this.fireWorkItemSaveComplete()}};b.prototype._getLinkCount=function(b,c){var a=0,d=this.getLinks();$.each(d,function(e,d){if(c&&d.isNew())return;if(b){if(d instanceof b)a++}else a++});return a};b.MAX_TITLE_LENGTH=255;return b}();e.WorkItem=u;var pb=function(b){__extends(a,b);function a(a){b.call(this);this._workItem=a}a.prototype.save=function(a,b){this._workItem.beginSave(a,b)};a.prototype.getMoniker=function(){return q.LinkingUtilities.encodeUri({tool:qb.ToolNames.WorkItemTracking,type:qb.ArtifactTypeNames.WorkItem,id:this._workItem.id.toString()})};return a}(x.Document);e.WorkItemDocument=pb;l.initClassPrototype(pb,{_workItem:null});var tb=function(){function b(a){this._init(a)}b.prototype._init=function(a){if(!a.isNew()){var b=[];this._populateActions(b,a);this._sortActions(b,a);this.actionSets=this._groupActions(b,a)}else this.actionSets=[]};b.prototype._populateActions=function(e,d){for(var g=d.revisions.length+1,a,f=d.allLinks.length,b=0;b<g;b++)e.push({index:b,type:1,changedDate:d.getFieldValueByRevision(-4,b),changedBy:d.getFieldValueByRevision(c.DalFields.PersonID,b)});for(b=0;b<f;b++){a=d.allLinks[b];!a.isNew()&&e.push({index:b,type:jb(a.getFieldId()),changedDate:a.getAddedDate(),changedBy:jQuery.isFunction(a.getAddedBy)?a.getAddedBy():0});a.isRemoved()&&e.push({index:b,type:jb(a.getFieldId())+1,changedDate:a.getRemovedDate(),changedBy:jQuery.isFunction(a.getRemovedBy)?a.getRemovedBy():0})}};b.prototype._getActionObject=function(b,a){return a.type!==0?a.type===1?b.revisions[a.index]:b.allLinks[a.index]:null};b.prototype._sortActions=function(e,b){var c=this,d=function(e,f){var d=0,g,h;d=a.DateUtils.compare(e.changedDate,f.changedDate);if(d===0)d=e.type-f.type;if(d===0&&e.changedBy>0&&f.changedBy>0)d=e.changedBy-f.changedBy;if(d===0&&(e.type===8||e.type===9)){g=c._getActionObject(b,e);h=c._getActionObject(b,f);if(g&&h){d=g.getLinkType()-h.getLinkType();if(d===0)d=g.getTargetId()-h.getTargetId()}}return d};e.sort(d)};b.prototype._groupActions=function(f,e){var d,g=[],b,c;function h(){var a=new Y;g.push(a);return a}for(d=0;d<f.length;d++){c=f[d];if(!b||c.changedDate&&!a.DateUtils.equals(c.changedDate,b.getChangedDate())||c.changedBy&&c.changedBy!==b.getChangedBy()){b&&b.finalize(e);b=h()}b.add(c);b.flags|=1<<c.type/2}b&&b.finalize(e);return g};b.prototype.getActions=function(){return this.actionSets};b.prototype.getMessageActions=function(){var b,d,a,c;if(!this.messageActionSets){c=[];for(b=0,d=this.actionSets.length;b<d;b++){a=this.actionSets[b];a&&a.message&&c.push(a)}this.messageActionSets=c}return this.messageActionSets};b.prototype.findMessageActionSetByRev=function(e){var a,d,b,c=this.getMessageActions();for(a=0,d=c.length;a<d;a++){b=c[a];if(e===b.getRev())return b}return null};return b}();e.WorkItemHistory=tb;var Y=function(){function a(){this.actions=[]}a.prototype.add=function(a){this.actions.push(a);if(a.type===1)this.fieldAction=a};a.prototype.finalize=function(a){var c,d,b=this.fieldAction;this.authorizedAs=a.getPerson(this.getChangedBy());this.changedByName=this.fieldsChanged()?a.getFieldValueByRevision(9,this.getRev()):this.authorizedAs;this.changedByIdentity=a.getIdentity(this.changedByName);if(b){if(b.index>0){c=a.getFieldValueByRevision(2,b.index)||"";d=a.getFieldValueByRevision(2,b.index-1)||"";if(c!==d)this.stateChanges=[d,c]}this.message=a.getFieldValueByRevision(54,b.index)}};a.prototype.getRev=function(){return this.actions.length>0?this.actions[0].index:-1};a.prototype.getChangedDate=function(){return this.actions.length>0?this.actions[0].changedDate:null};a.prototype.getChangedBy=function(){return this.actions.length>0?this.actions[0].changedBy:0};a.prototype.messageAdded=function(){return this.message&&this.message.length>0};a.prototype.stateChanged=function(){return this.stateChanges&&this.stateChanges.length===2};a.prototype.fieldsChanged=function(){return this.isChanged(1)};a.prototype.linksChanged=function(){return this.isChanged(28)};a.prototype.attachmentsChanged=function(){return this.isChanged(2)};a.prototype.isChanged=function(a){return(this.flags&a)>0};a.prototype.getActions=function(e){var a,d,b,c=[];for(a=0,d=this.actions.length;a<d;a++){b=this.actions[a];e(b.type)&&c.push(b)}return c};a.prototype.getFieldChanges=function(){return this.getActions(function(a){return a===1})};a.prototype.getLinkChanges=function(){return this.getActions(function(a){return a>3})};a.prototype.getAttachmentChanges=function(){return this.getActions(function(a){return a===2||a===3})};a.prototype.attachmentAdded=function(){return this.getActions(function(a){return a===2}).length>0};a.prototype.attachmentDeleted=function(){return this.getActions(function(a){return a===3}).length>0};a.prototype.linkAdded=function(){return this.getActions(function(a){return a===4||a===6||a===8}).length>0};a.prototype.linkDeleted=function(){return this.getActions(function(a){return a===5||a===7||a===9}).length>0};a.prototype.getSafeHtmlMessage=function(){if(!this.htmlMessage)if(this.message)this.htmlMessage=Ub.HtmlNormalizer.normalize(this.message);else this.htmlMessage="";return this.htmlMessage};return a}();e.EditActionSet=Y;l.initClassPrototype(Y,{actions:null,fieldAction:null,message:null,htmlMessage:null,stateChanges:null,changedByName:null,authorizedAs:null,changedByIdentity:null,flags:0,description:null});var f=function(){function b(b,a){this.workItem=b;this.fieldDefinition=a}b.isEmpty=function(a){return a===null||typeof a==="undefined"||typeof a==="string"&&$.trim(a).length===0};b.compareValues=function(d,c,e){if(d instanceof v)return c instanceof v&&d.type===c.type?b.compareValues(d.value,c.value,e):false;else if(c instanceof v)return false;if(d===null||typeof d==="undefined")d="";if(c===null||typeof c==="undefined")c="";d=""+d;c=""+c;return e?a.StringUtils.localeIgnoreCaseComparer(d,c)===0:a.StringUtils.localeComparer(d,c)===0};b.isMatch=function(a,b){if(!a)return true;a=a.replace(/[.*+?|()\[\]\^\${}\\]/g,"\\$&");a=a.replace(/n/gi,"\\d").replace(/a/gi,"[a-zA-Z]").replace(/x/gi,"[a-zA-Z0-9]");a="^"+a+"$";return new RegExp(a,"i").test(b)};b.hashset=function(a,f){var d={},b,e,c;if(f){if(a.__hashSetCaseInsensitive)return a.__hashSetCaseInsensitive;for(b=0,e=a.length;b<e;b++){c=a[b];d[c.toLocaleUpperCase()]=c}a.__hashSetCaseInsensitive=d}else{if(a.__hashSet)return a.__hashSet;for(b=0,e=a.length;b<e;b++){c=a[b];d[c]=c}a.__hashSet=d}return d};b.contains=function(a,c,d){if(!d)return $.inArray(c,a)>=0;else{var e=b.hashset(a,true);return e.hasOwnProperty(c.toLocaleUpperCase())}};b.normalize=function(d,a){if(a){var c=b.hashset(d,true);return c[a.toLocaleUpperCase()]||a}return a};b.intersect=function(h,c,j){var g,e,d,i,f;if(!c)return h;if(c.length===0)return[];if(h.length<c.length)g=b.hashset(h,j);else{g=b.hashset(c,j);c=h}e=[];a.ArrayUtils.copySortFlag(e,c);if(j)for(d=0,i=c.length;d<i;d++){f=c[d];if(g.hasOwnProperty(f.toLocaleUpperCase()))e[e.length]=f}else for(d=0,i=c.length;d<i;d++){f=c[d];if(g.hasOwnProperty(f))e[e.length]=f}return e};b.union=function(e,f,m){var b,c,d,k,l,i,h,j,g=m?a.StringUtils.localeIgnoreCaseComparer:a.StringUtils.localeComparer;if(!f||f.length===0)return e;if(!e||e.length===0)return f;a.ArrayUtils.sortIfNotSorted(e,g);a.ArrayUtils.sortIfNotSorted(f,g);b=[];a.ArrayUtils.flagSorted(b,g);c=0;k=e.length;d=0;l=f.length;while(c<k&&d<l){h=e[c];j=f[d];i=g(h,j);if(i===0){b[b.length]=h;c++;d++}else if(i>0){b[b.length]=j;d++}else{b[b.length]=h;c++}}while(c<k){b[b.length]=e[c];c++}while(d<l){b[b.length]=f[d];d++}return b};b.subtract=function(f,i,j){var c,g,e,h,d;if(!i||i.length===0)return f;d=[];a.ArrayUtils.copySortFlag(d,f);h=b.hashset(i,j);if(j)for(c=0,g=f.length;c<g;c++){e=f[c];if(!h.hasOwnProperty(e.toLocaleUpperCase()))d[d.length]=e}else for(c=0,g=f.length;c<g;c++){e=f[c];if(!h.hasOwnProperty(e))d[d.length]=e}return d};b.inList=function(i,j,h,e,f){d.assertParamIsObject(i,"store");d.assertParamIsBool(f,"caseInsensitive");var c,k,g;if(h&&b.contains(h,j,f))return true;if(e)for(c=0,k=e.length;c<k;c++){g=i.getConstantSet(e[c]);!g&&B(a.StringUtils.format("Constant set {0} is not ready. Operation cannot continue.",e[c]));if(b.contains(g,j,f))return true}return false};b.unionLists=function(i,e,f){var c,d,h,g;if(f){if(e){c=e.slice(0);a.ArrayUtils.copySortFlag(c,e)}else{c=[];a.ArrayUtils.flagSorted(c,a.StringUtils.localeIgnoreCaseComparer)}for(d=0,h=f.length;d<h;d++){g=i.getConstantSet(f[d]);!g&&B(a.StringUtils.format("Constant set {0} is not ready. Operation cannot continue.",f[d]));c=b.union(c,g,true)}return c}else return e};b.isLongTextField=function(a){switch(a){case 5:case 7:case 9:return true;default:return false}};b.isNumericField=function(a){switch(a){case 2:case 10:return true;default:return false}};b.isStringField=function(a){switch(a){case 5:case 7:case 9:case 1:return true;default:return false}};b.convertValueToDisplayString=function(a){if(a!==null&&typeof a!=="undefined"&&a instanceof v)a=a.value;return D.convertValueToDisplayString(a)};b.isValidStringFieldValue=function(b,c){return!c&&a.StringUtils.containsControlChars(b)?false:!a.StringUtils.containsMismatchedSurrogateChars(b)};b.normalizeStringValue=function(a,b){d.assertParamIsString(a,"value");if(!b)a=a.replace(Fb," ");return a.replace(Db," ")};b.convertValueToInternal=function(i,c,g){var f=0,d,h,e;if(c===null||typeof c==="undefined")d=null;else if(typeof c==="string"&&c.length===0)d=null;else if(c instanceof v)d=c;else try{switch(g){case 12:if(typeof c==="boolean")d=c?1:0;else if(typeof c==="number")d=c!==0?1:0;else if(typeof c==="string")if(/^\d+$/.test(c))d=a.NumberUtils.parseLocale(c)!==0?1:0;else d=a.BoolUtils.parse(c)?1:0;else throw Error.invalidOperation("Invalid Boolean field value.");break;case 2:if(typeof c==="number")d=Math.round(c);else if(typeof c==="boolean")d=c?0:1;else if(typeof c==="string")if(/^[\-+]?\d+$/.test(c))d=a.NumberUtils.parseLocale(c);if(typeof d==="undefined"||isNaN(d)||!isFinite(d))throw Error.invalidOperation(a.StringUtils.format("Invalid Integer field value.",c));break;case 10:if(typeof c==="number")d=c;else if(typeof c==="boolean")d=c?0:1;else if(typeof c==="string")d=a.NumberUtils.parseLocale(c);if(typeof d==="undefined"||isNaN(d)||!isFinite(d))throw Error.invalidOperation(a.StringUtils.format("Invalid Double field value.",c));break;case 3:if(c instanceof Date)d=c;else if(typeof c==="string")d=a.DateUtils.parseDateString(c);else d=null;if(d===null||isNaN(d))throw Error.invalidOperation("Invalid DateTime field value.");h=d.getFullYear();if(h<1753||h>9999)f=8192;break;case 11:if(typeof c==="string"){e=Tb.exec(c);if(!e)throw Error.invalidOperation("Invalid GUID field value.");d=e[1]+"-"+e[2]+"-"+e[3]+"-"+e[4]+"-"+e[5]}else throw Error.invalidOperation("Invalid GUID field value.");break;default:if(typeof c==="string")d=c;else if(typeof c==="number")d=a.NumberUtils.localeFormat(c,"N");else if(typeof c==="boolean")d=c?"True":"False";else if(c instanceof Date)d=a.DateUtils.localeFormat(c,"F");else throw Error.invalidOperation("Invalid String field type.");if(typeof d==="undefined")d=null;if(d!==null){d=$.trim(d);if(d.length===0)d=null}if(d!==null){if(g===1)if(d.length>u.MAX_TITLE_LENGTH)f=65536;if(!b.isValidStringFieldValue(d,b.isLongTextField(g)))f=131072}}}catch(j){return{value:c,error:j,status:4096}}return{value:d,status:f}};b.convertValueToExternal=function(d,a,c){if(typeof a==="undefined")a=null;if(a===null&&b.isStringField(c))a="";else if(c===12)a=a?true:false;return a};b.getFieldErrorText=function(b,c,d){switch(c){case 1:return a.StringUtils.format(g.FieldStatusInvalidEmptyError,b);case 2:return a.StringUtils.format(g.FieldStatusInvalidNotEmptyError,b);case 3:return a.StringUtils.format(g.FieldStatusInvalidFormatError,b);case 4:return a.StringUtils.format(g.FieldStatusInvalidListValueError,b,d);case 5:return a.StringUtils.format(g.FieldStatusInvalidOldValueError,b);case 6:return a.StringUtils.format(g.FieldStatusInvalidNotOldValueError,b);case 7:return a.StringUtils.format(g.FieldStatusInvalidEmptyOrOldValueError,b);case 8:return a.StringUtils.format(g.FieldStatusInvalidNotEmptyOrOldValueError,b);case 9:return a.StringUtils.format(g.FieldStatusInvalidValueInOtherFieldError,b);case 10:return a.StringUtils.format(g.FieldStatusInvalidValueNotInOtherFieldError,b);case 11:return a.StringUtils.format(g.FieldStatusInvalidDateErrorError,b);case 12:return a.StringUtils.format(g.FieldStatusInvalidTooLongError,b);case 13:return a.StringUtils.format(g.FieldStatusInvalidTypeError,b);case 14:return a.StringUtils.format(g.FieldStatusInvalidComputedFieldError,b);case 15:return a.StringUtils.format(g.FieldStatusInvalidPathError,b);case 16:return a.StringUtils.format(g.FieldStatusInvalidCharactersError,b);default:return a.StringUtils.format(g.FieldStatusInvalidUnknownError,b)}};b.getFieldStatus=function(b){if((b&2147479552)!==0){for(var a=1,c=V.length;a<c;a++)if((b&V[a])!==0)return a;return 17}else return 0};b.prototype.resetUpdate=function(){delete this.workItem.fieldUpdates[this.fieldDefinition.id+""]};b.prototype.getValue=function(c,a){return b.convertValueToExternal(this.workItem.store,this._getValue(c,a),this.fieldDefinition.type)};b.prototype.getDisplayText=function(c,a){return b.convertValueToDisplayString(this.getValue(c,a))};b.prototype.setValue=function(f,a){if(typeof a==="undefined")a=false;var d=this.workItem._getFieldValueById(this.fieldDefinition.id),c=b.convertValueToInternal(this.workItem.store,this._tryNormalizeValue(f),this.fieldDefinition.type);this._setValue(c.value,false);if(!b.compareValues(d,c.value)){var e=this.workItem.evaluateField(this.fieldDefinition.id,true,d);this._status|=c.status;!a&&this.workItem.fireFieldChange(e)}};b.prototype.isDirty=function(){var b=this.fieldDefinition.id,a;a=this.workItem.fieldUpdates.hasOwnProperty(b+"");if(!a)switch(b){case-105:a=this.workItem.fieldUpdates.hasOwnProperty("-104");break;case-7:a=this.workItem.fieldUpdates.hasOwnProperty("-2")}return a};b.prototype.isUserChange=function(){var a=this.workItem.fieldUpdates[this.fieldDefinition.id+""];return a?a.setByRule?(this._status&512)!==0?true:false:true:false};b.prototype.isValid=function(){return(this._status&2147479552)===0};b.prototype.isHistoricalRevision=function(){return this.workItem.isReadOnly()};b.prototype.isEditable=function(){var a;if(this.isHistoricalRevision()||!this.fieldDefinition.isEditable())return false;a=this.fieldDefinition.id;switch(a){case 8:case 25:case 33:return false;case-7:a=-2;break;case-105:a=-104;break;default:return(this._status&2)===0}return this.workItem.getField(a).isEditable()};b.prototype.isReadOnly=function(){return!this.isEditable()};b.prototype.isRequired=function(){var a=this.fieldDefinition.id;switch(a){case-105:a=-104;break;case-7:a=-2;break;default:return(this._status&1)!==0}return this.workItem.getField(a).isRequired()};b.prototype.getErrorText=function(){return b.getFieldErrorText(this.fieldDefinition.name,this.getStatus(),this.getDisplayText())};b.prototype.getStatus=function(){return b.getFieldStatus(this._status)};b.prototype.validate=function(a){this.customValidators=this.customValidators||[];this.customValidators.push(a)};b.prototype.hasList=function(){return(this._status&4)!==0};b.prototype.isLimitedToAllowedValues=function(){return(this._status&8)!==0};b.prototype.getAllowedValues=function(){var e,f,h,g,c=this._allowedValues;if(!c){if(this.hasList()){var d=this._lists,i=this.workItem.store;if(d.allowedValues&&d.allowedValues.length>0){c=b.unionLists(i,d.allowedValues[0].items,d.allowedValues[0].globals);for(e=1,f=d.allowedValues.length;e<f;e++)c=b.intersect(c,b.unionLists(i,d.allowedValues[e].items,d.allowedValues[e].globals),true)}if(d.suggestedValues&&d.suggestedValues.length>0){g=[];for(e=0,f=d.suggestedValues.length;e<f;e++)g=b.union(g,b.unionLists(i,d.suggestedValues[e].items,d.suggestedValues[e].globals),true);if(c)c=b.intersect(c,g);else c=g}if(d.allowExistingValue){h=this._getValue(true);if(!b.isEmpty(h))if(c)c=b.union(c,[b.convertValueToDisplayString(h)],true);else c=[b.convertValueToDisplayString(h)]}if(c&&d.prohibitedValues&&d.prohibitedValues.length>0)for(e=0,f=d.prohibitedValues.length;e<f;e++)c=b.subtract(c,b.unionLists(i,d.prohibitedValues[e].items,d.prohibitedValues[e].globals),true)}c=c||[];if(b.isNumericField(this.fieldDefinition.type))a.ArrayUtils.sortIfNotSorted(c,a.NumberUtils.defaultComparer);else a.ArrayUtils.sortIfNotSorted(c,a.StringUtils.localeIgnoreCaseComparer);this._allowedValues=c}return c};b.prototype.isChangedInRevision=function(b){var a=this.fieldDefinition.id;switch(a){case-7:case-12:case-42:case c.DalFields.AreaLevel1:case c.DalFields.AreaLevel2:case c.DalFields.AreaLevel3:case c.DalFields.AreaLevel4:case c.DalFields.AreaLevel5:case c.DalFields.AreaLevel6:case c.DalFields.AreaLevel7:a=-2;break;case-105:case c.DalFields.IterationLevel1:case c.DalFields.IterationLevel2:case c.DalFields.IterationLevel3:case c.DalFields.IterationLevel4:case c.DalFields.IterationLevel5:case c.DalFields.IterationLevel6:case c.DalFields.IterationLevel7:a=-104;break;case-1:a=c.DalFields.PersonID;break;case-31:case-32:case-57:case 75:return null}return b===0?this.workItem.getFieldValueByRevision(a,b)!==null:this.workItem.revisions[b-1].hasOwnProperty(a+"")};b.prototype._reset=function(){this._status=0;this._allowedValues=null;this._lists=null};b.prototype._getValue=function(b,a){return this.workItem._getFieldValueById(this.fieldDefinition.id,b,a)};b.prototype._setValue=function(b,a){this.workItem._setFieldValueById(this.fieldDefinition.id,b,a)};b.prototype._tryNormalizeValue=function(a){var c;if(a&&typeof a==="string"&&this.hasList()){c=this.getAllowedValues();a=b.normalize(c,a)}return a};return b}();e.Field=f;l.initClassPrototype(f,{workItem:null,fieldDefinition:null,_status:0,_allowedValues:null,_lists:null,customValidators:null});V=[0,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,8192,65536,4096,536870912,32768,131072];var z=function(){function b(a){if(typeof a==="undefined")a=[];this._filterProviders={};this._workItems=[];this._originalWorkItemIds=[];this._originalWorkItemIds=a;this._workItems=this._originalWorkItemIds.slice(0)}b.prototype.getFilterProvider=function(a){d.assertParamIsString(a,"type");return this._filterProviders[a]};b.prototype.registerFilterProvider=function(b,a){d.assertParamIsString(b,"type");d.assertParamIsObject(a,"filterProvider");this._filterProviders[b]=a};b.prototype.unregisterFilterProvider=function(a){d.assertParamIsString(a,"type");delete this._filterProviders[a]};b.prototype.addFilter=function(e,c){d.assertParamIsString(e,"type");d.assertParamIsString(c,"content");d.logTracePoint("FilterManager.addFilter.start");var a=this.getFilterProvider(e),f=this._workItems;if(a){a.addFilter(c);this._workItems=a.getMatchingWorkItems(this._workItems);this._fireEvent(b.EVENT_FILTER_CHANGED)}};b.prototype.removeFilter=function(c,e){d.assertParamIsString(c,"type");d.logTracePoint("FilterManager.removeFilter.start");var a=this.getFilterProvider(c);if(a){a.removeFilter(e);this.rebuildMatchingWorkItems();if(!this._areProvidersFiltering())this._fireEvent(b.EVENT_FILTER_CLEARED);else this._fireEvent(b.EVENT_FILTER_CHANGED)}};b.prototype.clearFilters=function(a){if(a)this._filterProviders[a].clearFilters();else $.each(this._filterProviders,function(b,a){a.clearFilters()});this.rebuildMatchingWorkItems();if(!this._areProvidersFiltering())this._fireEvent(b.EVENT_FILTER_CLEARED);else this._fireEvent(b.EVENT_FILTER_CHANGED)};b.prototype.rebuildMatchingWorkItems=function(){var b=this;this._workItems=this._originalWorkItemIds.slice(0);$.each(this._filterProviders,function(d,c){b._workItems=a.ArrayUtils.intersectPrimitives(b._workItems,c.getMatchingWorkItems(b._workItems))})};b.prototype.getMatchingWorkItems=function(){return this._workItems};b.prototype.isFiltered=function(){return this._areProvidersFiltering()};b.prototype._areProvidersFiltering=function(){var a=false;$.each(this._filterProviders,function(c,b){if(b.isFiltering()){a=true;return false}});return a};b.prototype.fire=function(b,c,a){return this._fireEvent(b,c,a)};b.prototype._fireEvent=function(d,e,f){var c,b;if(this._events){b=this._events._getEvent(d);if(!b||b.length===0)return undefined;b=a.ArrayUtils.clone(b);for(c=b.length-1;c>=0;c--)if(b[c](e||this,f)===false)return false}};b.prototype.attachEvent=function(a,b){if(!this._events)this._events=new Sys.EventHandlerList;this._events.addHandler(a,b)};b.prototype.detachEvent=function(a,b){this._events&&this._events.removeHandler(a,b)};b.prototype.updateWorkItemId=function(c,b){d.assertParamIsInteger(c,"oldId");d.assertParamIsInteger(b,"newId");var a;a=$.inArray(c,this._originalWorkItemIds);if(a>=0)this._originalWorkItemIds[a]=b;a=$.inArray(c,this._workItems);if(a>=0)this._workItems[a]=b;$.each(this._filterProviders,function(d,a){a.updateWorkItemId(c,b)})};b.prototype.setOriginalWorkItems=function(a){var b=this;d.assertParamIsArray(a,"workItems");this._originalWorkItemIds=a;this._workItems=a;$.each(this._filterProviders,function(c,a){b._workItems=a.getMatchingWorkItems(b._workItems)})};b.EVENT_FILTER_CHANGED="filter-changed";b.EVENT_FILTER_CLEARED="filter-cleared";b.EVENT_WORK_ITEM_UPDATED="work-item-updated";b.EVENT_FILTER_ACTIVATED="filter-activated";b.EVENT_FILTER_DEACTIVATED="filter-deactivated";return b}();e.FilterManager=z;l.initClassPrototype(z,{_filterProviders:null,_originalWorkItems:null,_workItems:null,_events:null});var mb=function(){function b(a){if(typeof a==="undefined")a={};this._tagsDictionary={};this._activeFilterTags=[];this._isActive=!a.deactivatedOnCreate;if(a&&a.filterManager)this._filterManager=a.filterManager}b.prototype.addFilter=function(b){d.assertParamIsStringNotEmpty(b,"tag");if(a.ArrayUtils.contains(this._activeFilterTags,b,a.StringUtils.localeIgnoreCaseComparer))return;this._activeFilterTags.push(b);this._tagCountCache=null};b.prototype.removeFilter=function(b){d.assertParamIsStringNotEmpty(b,"tag");var a=$.inArray(b,this._activeFilterTags);a>=0&&this._activeFilterTags.splice(a,1);this._tagCountCache=null};b.prototype.clearFilters=function(){this._activeFilterTags=[];this._tagCountCache=null};b.prototype.getMatchingWorkItems=function(e){var d=this,c,b=e;$.each(this._activeFilterTags,function(f,e){if(d._tagsDictionary.hasOwnProperty(e)){c=d._tagsDictionary[e];b=a.ArrayUtils.intersectPrimitives(b,c)}else{b=[];return false}});return b};b.prototype.setTags=function(a){if(this.isActive()){d.assertParamIsObject(a,"tagsDictionary");var b=this._activeFilterTags.slice(0);this._validateDictionary(a);this._tagsDictionary=$.extend(true,{},a);this._repopulateFilterTags(b);this._tagCountCache=null;this._filterManager.fire(z.EVENT_WORK_ITEM_UPDATED,this,{})}};b.prototype.unsetTags=function(a){this._tagsDictionary={};this._activeFilterTags=[];this._tagCountCache=null;d.assertParamIsStringNotEmpty(a,"eventType");this._filterManager.fire(a,this,{})};b.prototype.updateWorkItemId=function(f,e){var c,b,a;if(this.isActive()){d.assertParamIsInteger(f,"oldId");d.assertParamIsInteger(e,"newId");for(b in this._tagsDictionary)if(this._tagsDictionary.hasOwnProperty(b)){a=this._tagsDictionary[b];c=$.inArray(f,a);if(c>=0)a[c]=e}}};b.prototype.updateWorkItem=function(e,f,i){if(this.isActive()){d.assertParamIsInteger(e,"workItemId");d.assertParamIsArray(f,"tags");var c,g,b,h=this._activeFilterTags.slice(0);for(b in this._tagsDictionary)if(this._tagsDictionary.hasOwnProperty(b)){c=$.inArray(e,this._tagsDictionary[b]);if(c>=0&&!a.ArrayUtils.contains(f,b)){this._tagsDictionary[b].splice(c,1);if(this._tagsDictionary[b].length===0)delete this._tagsDictionary[b]}}for(c=0,g=f.length;c<g;c++){b=f[c];if(this._tagsDictionary.hasOwnProperty(b))!a.ArrayUtils.contains(this._tagsDictionary[b],e)&&this._tagsDictionary[b].push(e);else this._tagsDictionary[b]=[e]}this._repopulateFilterTags(h);this._tagCountCache=null;!i&&this._filterManager.fire(z.EVENT_WORK_ITEM_UPDATED,this,{})}};b.prototype.getActiveFilterTags=function(){return this._activeFilterTags.slice(0)};b.prototype.getAvailableFilterTags=function(){var b=[],a;for(a in this._tagsDictionary)this._tagsDictionary.hasOwnProperty(a)&&$.inArray(a,this._activeFilterTags)===-1&&this.getTagItemCount(a)>0&&b.push(a);return b};b.prototype.getAllFilterTags=function(){var b=[],a;for(a in this._tagsDictionary)this._tagsDictionary.hasOwnProperty(a)&&b.push(a);return b};b.prototype.getTagItemCount=function(a){d.assertParamIsStringNotEmpty(a,"tagName");!this._tagCountCache&&this._recalculateTagCounts();return this._tagCountCache.hasOwnProperty(a)?this._tagCountCache[a]:0};b.prototype._recalculateTagCounts=function(){var a;this._tagCountCache={};for(a in this._tagsDictionary)this._tagsDictionary.hasOwnProperty(a)&&this._recalculateTagCount(a)};b.prototype._recalculateTagCount=function(c){var b=this._tagsDictionary[c];if(this._filterManager.isFiltered())b=a.ArrayUtils.intersectPrimitives(b,this._filterManager.getMatchingWorkItems());this._tagCountCache[c]=b.length};b.prototype.isActive=function(){return this._isActive};b.prototype.toggleFilterActivation=function(){if(this.isActive())this.deactivateFilter();else{d.logTracePoint("TagFilterProvider.activating");this.activateFilter()}};b.prototype.deactivateFilter=function(a){if(this._isActive){this._isActive=false;this._filterManager.fire(z.EVENT_FILTER_DEACTIVATED,this,{});if(a)this.unsetTags(z.EVENT_WORK_ITEM_UPDATED);else this.unsetTags(z.EVENT_FILTER_CLEARED)}};b.prototype.activateFilter=function(){if(!this._isActive){this._isActive=true;this._filterManager.fire(z.EVENT_FILTER_ACTIVATED,this,{})}};b.prototype._validateDictionary=function(a){var b,c,e;d.assertParamIsObject(a,"tagsDictionary");if(d.getDebugMode())for(b in a)if(a.hasOwnProperty(b)){d.assertIsArray(a[b]);for(c=0,e=a[b].length;c<e;c++)d.assertIsInteger(a[b][c])}};b.prototype._repopulateFilterTags=function(a){var b=this;d.assertParamIsArray(a,"desiredFilterSet");this._activeFilterTags=[];$.each(a,function(c,a){b.addFilter(a)})};b.prototype.isFiltering=function(){return this._activeFilterTags.length!==0};b.PROVIDER_TYPE="tag";return b}();e.TagFilterProvider=mb;l.initClassPrototype(mb,{_isActive:null,_tagsDictionary:null,_activeFilterTags:null});var A=function(){function b(b,a){this.workItem=b;this.linkData=a;this.updated=false;this.deleted=false;this.baseLinkType="Link"}b.createFromLinkData=function(d,a){var e;a=a||{};if(!a.FldID)a.FldID=c.DalFields.RelatedLinks;e=a.FldID;switch(e){case c.DalFields.AttachedFiles:return new M(d,a);case c.DalFields.LinkedFiles:return new ab(d,a);case c.DalFields.BISURI:return new Z(d,a);case c.DalFields.RelatedLinks:return new s(d,a);default:return new b(d,a)}};b.prototype._fireChanged=function(){this.workItem.fireFieldChange([this.getFieldId()])};b.prototype.isNew=function(){return a.DateUtils.equals(o.FutureDate,this.getAddedDate())};b.prototype.isRemoved=function(){return!a.DateUtils.equals(o.FutureDate,this.getRemovedDate())};b.prototype.getComment=function(){return this.linkData.Comment};b.prototype.setComment=function(a){this.linkData.Comment=a;this.updated=true;this.linkData.CommentChanged=true;this._fireChanged()};b.prototype.remove=function(a){var b=a&&a.preventEvent===true;this.deleted=true;if(!b){this.workItem.resetLinks(true);this._fireChanged()}};b.prototype.clone=function(){return null};b.prototype.getFieldId=function(){return this.linkData.FldID};b.prototype.getIsLocked=function(){return this.linkData.Lock||false};b.prototype.setIsLocked=function(a){this.linkData.Lock=a;this.updated=true;this.linkData.LockChanged=true;this._fireChanged()};b.prototype.getAddedDate=function(){return this.linkData.AddedDate};b.prototype.getRemovedDate=function(){return this.linkData.RemovedDate};b.prototype.equals=function(b){var a,d,c;if(b&&this.baseLinkType===b.baseLinkType){for(a in this)if(a.substr(0,3)==="get"&&$.isFunction(this[a])){d=this[a].call(this);c=b[a].call(b);if(!f.compareValues(d,c,false))return false}}else return false;return true};b.prototype.getArtifactLinkType=function(){return""};return b}();e.Link=A;var Z=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.baseLinkType="ExternalLink"}a.create=function(e,b,d,f){return new a(e,{OriginalName:b,FilePath:d,Comment:f||"",FldID:c.DalFields.BISURI,AddedDate:o.FutureDate,RemovedDate:o.FutureDate})};a.prototype.getArtifactLinkType=function(){return this.linkData.OriginalName};a.prototype.getLinkedArtifactUri=function(){return this.linkData.FilePath};a.prototype.clone=function(b){return a.create(b,this.getArtifactLinkType(),this.getLinkedArtifactUri(),this.getComment())};return a}(A);e.ExternalLink=Z;var ab=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.baseLinkType="HyperLink"}a.create=function(d,b,e){return new a(d,{OriginalName:"",FilePath:b,Comment:e||"",FldID:c.DalFields.LinkedFiles,AddedDate:o.FutureDate,RemovedDate:o.FutureDate})};a.prototype.getArtifactLinkType=function(){return"Workitem Hyperlink"};a.prototype.getLocation=function(){return this.linkData.FilePath};a.prototype.clone=function(b){return a.create(b,this.getLocation(),this.getComment())};return a}(A);e.Hyperlink=ab;var s=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.baseLinkType="WorkItemLink"}a.create=function(e,b,g,h){var d;if(typeof b==="object")d=b.id;else{var f=e.store.findLinkTypeEnd(b);d=f.id}return new a(e,{ID:g,LinkType:d,Comment:h||"",FldID:c.DalFields.RelatedLinks,"Changed Date":o.FutureDate,"Revised Date":o.FutureDate})};a.prototype.getSourceId=function(){return this.workItem.id};a.prototype.getTargetId=function(){return this.linkData.ID};a.prototype.getAddedDate=function(){return this.linkData["Changed Date"]};a.prototype.getAddedBy=function(){return this.linkData["Changed By"]};a.prototype.getRemovedDate=function(){return this.linkData["Revised Date"]};a.prototype.getRemovedBy=function(){return this.linkData["Revised By"]||-1};a.prototype.getLinkType=function(){return this.linkData.LinkType};a.prototype.getLinkTypeEnd=function(){if(!this.linkTypeEnd)this.linkTypeEnd=this.workItem.store.findLinkTypeEnd(this.getLinkType());return this.linkTypeEnd};a.prototype.clone=function(d){var c=this.getLinkTypeEnd(),b=c.linkType;if(b&&b.isActive&&b.topology!=="Unknown"&&!(b.isOneToMany&&c.isForwardLink))return a.create(d,c,this.getTargetId(),this.getComment())};return a}(A);e.WorkItemLink=s;var M=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.baseLinkType="Attachment";this.uploaded=true}a.create=function(j,i,h,k,b,g,f){d.assertParamIsNumber(b,"fileLength");var e=new a(j,{OriginalName:i,FilePath:h,Comment:k||"",ExtID:0,FldID:c.DalFields.AttachedFiles,Length:b,CreationDate:g||new Date,LastWriteDate:f||new Date,AddedDate:o.FutureDate,RemovedDate:o.FutureDate});e.uploaded=b>0;return e};a.prototype.getName=function(){return this.linkData.OriginalName};a.prototype.setName=function(a){this.linkData.OriginalName=a;this._fireChanged()};a.prototype.getLength=function(){return this.linkData.Length};a.prototype.setLength=function(a){this.linkData.Length=a;this._fireChanged()};a.prototype.getFilePath=function(){return this.linkData.FilePath};a.prototype.setFilePath=function(a){this.linkData.FilePath=a;this._fireChanged()};a.prototype.getUri=function(c){var b=this.linkData.ExtID,a={fileName:this.getName()};if(b)a.attachmentId=b;else a.fileGuid=this.getFilePath();if(c)a.contentOnly=true;return this.workItem.store.getApiLocation("DownloadAttachment",a)};a.prototype.open=function(){x.ActionManager.performAction(x.CommonActions.ACTION_WINDOW_OPEN,{url:this.getUri(true),target:"_blank"})};a.prototype.save=function(){x.ActionManager.performAction(x.CommonActions.ACTION_WINDOW_OPEN,{url:this.getUri(false),target:"_blank"})};a.prototype._uploadComplete=function(a,b,c){this.uploaded=true;this.linkData.OriginalName=a;this.linkData.FilePath=b;this.linkData.Length=c;this._fireChanged()};return a}(A);e.Attachment=M;var wb;(function(a){a[a.Value=1]="Value";a[a.CurrentValue=2]="CurrentValue";a[a.OriginalValue=4]="OriginalValue";a[a.OtherFieldCurrentValue=8]="OtherFieldCurrentValue";a[a.OtherFieldOriginalValue=16]="OtherFieldOriginalValue";a[a.CurrentUser=32]="CurrentUser";a[a.Clock=64]="Clock"})(wb||(wb={}));var Pb=function(){function b(e,d,f,g,b,a,c){this.executionPhase=1;this.userChange=false;this.valueLocked=false;this.setByRule=false;this.setByDefaultRule=false;this.setByComputedRule=false;this.readOnly=false;this.empty=false;this.required=false;this.frozen=false;this.cannotLoseValue=false;this.otherField=false;this.allowExistingValue=false;this.validUser=false;this.serverDefault=false;this.fieldId=e;this.workItem=d;this.field=f;this.value=g;this.originalValue=b;this.valueLocked=a;this.userChange=a;this.evalState=c}b.compareLists=function(b,c){var d,a;if(b!==c){if(!b||!c)return false;d=b.length;if(d!==c.length)return false;for(a=0;a<d;a++){if(b[a].items!==c[a].items)return false;if(b[a].globals!==c[a].globals)return false}}return true};b.compareFieldLists=function(c,a){if(c!==a){if(!c||!a)return false;if(c.allowExistingValue!==a.allowExistingValue)return false;if(!b.compareLists(c.allowedValues,a.allowedValues))return false;if(!b.compareLists(c.suggestedValues,a.suggestedValues))return false;if(!b.compareLists(c.prohibitedValues,a.prohibitedValues))return false}return true};b.prototype.setExecutionPhase=function(a){this.executionPhase=a};b.prototype.evaluate=function(a){if(a){this.setExecutionPhase(2);this.Block(a);this.setExecutionPhase(1);this.Block(a);this.setExecutionPhase(3);this.Block(a)}this.validate()};b.prototype.Block=function(a){var b=0,e=a.length;while(b<e){var d=a[b++],c=a[b++]||[];this[d].apply(this,c)}};b.prototype.When=function(b,d,a,c,e){a=this._getValueFrom(c,a);(f.compareValues(this._getFieldValue(d,false),a,true)?!b:b)&&this.Block(e)};b.prototype.WhenWas=function(b,d,a,c,e){a=this._getValueFrom(c,a);(f.compareValues(this._getFieldValue(d,true),a,true)?!b:b)&&this.Block(e)};b.prototype.WhenChanged=function(b,a,c){(f.compareValues(this._getFieldValue(a,false),this._getFieldValue(a,true),true)?b:!b)&&this.Block(c)};b.prototype.WhenBecameNonEmpty=function(b,a,c){(f.compareValues(this._getFieldValue(a,true),null,true)&&!f.compareValues(this._getFieldValue(a,false),null,true)?!b:b)&&this.Block(c)};b.prototype.WhenRemainedNonEmpty=function(b,a,c){(f.compareValues(this._getFieldValue(a,true),null,true)||f.compareValues(this._getFieldValue(a,false),null,true)?b:!b)&&this.Block(c)};b.prototype.OtherField=function(c,b,a){if(this.executionPhase===3){this.otherField=this._getFieldValue(c,a);this.otherFieldCheck=b;if(b==="same-as")if(!this.userChange&&a){this.value=this.otherField;this.setByRule=true}}};b.prototype.Map=function(e,m,c,h){var n=this;if(this.executionPhase===2){var j=this._getFieldValue(e,false),b;if(!m){if(!this.userChange){c!=null&&$.each(c,function(c,a){if(f.compareValues(j,a["case"],true)){b=a;return false}});if(!b)b=h;if(b){var k=false;b.values&&$.each(b.values,function(b,a){if(f.compareValues(a,n.value,true)){k=true;return false}});if(!k)if(!b["default"]){this.value=b.values&&b.values[0];this.valueLocked=true;this.setByRule=true}else if(a.ArrayUtils.contains(b.values,this.originalValue)){this.value=this.originalValue;this.valueLocked=true;this.setByRule=true}else if(!f.compareValues(b["default"],this.value,true)){this.value=b["default"];this.valueLocked=true;this.setByRule=true}}}if(!this.allowedValues)this.allowedValues=[];var d=[];c!=null&&$.each(this._getAllowedValues(e),function(e,b){var a;$.each(c,function(d,c){if(f.compareValues(b,c["case"],true)){a=c;return false}});if(a)d=f.union(d,a.values,true)});if(h)d=f.union(d,h.values,true);this.allowedValues.push({items:d})}else{var i=this.evalState[e+""],l=i&&i.prevValue!==undefined?i.prevValue:this._getFieldValue(e,false);if(!f.compareValues(this._getFieldValue(e,false),l,true)&&!this.userChange){var g;c!=null&&$.each(c,function(b,a){a.values&&$.each(a.values,function(c,b){if(f.compareValues(j,b,true)){g=a["case"];return false}});if(g)return false});if(!f.compareValues(g,this.value,true)){this.value=g;this.valueLocked=true;this.setByRule=true}}}}};b.prototype.AllowExistingValue=function(){if(this.executionPhase===3)this.allowExistingValue=true};b.prototype.ReadOnly=function(){if(this.executionPhase===3){this.readOnly=true;if(!this.userChange){this.value=this.originalValue;this.setByRule=true}}};b.prototype.Empty=function(){if(this.executionPhase===3){this.empty=true;if(!this.userChange){this.value=undefined;this.setByRule=true}}};b.prototype.Required=function(){if(this.executionPhase===3)this.required=true};b.prototype.Frozen=function(){if(this.executionPhase===3){this.frozen=true;if(!this.userChange&&this.originalValue){this.value=this.originalValue;this.setByRule=true}}};b.prototype.CannotLoseValue=function(){if(this.executionPhase===3)this.cannotLoseValue=true};b.prototype.ValidUser=function(){if(this.executionPhase===3)this.validUser=true};b.prototype.Copy=function(b,a){if(this.executionPhase===2)if(!this.valueLocked){this.value=this._getValueFrom(b,a);this.valueLocked=true;this.setByRule=true}};b.prototype.Default=function(b,a){if(this.executionPhase===1)if(!this.valueLocked)if(f.isEmpty(this.value)){this.value=this._getValueFrom(b,a);this.valueLocked=true;this.setByRule=true;this.setByDefaultRule=true}};b.prototype.AllowedValues=function(b,c){if(this.executionPhase===3){if(!this.allowedValues)this.allowedValues=[];b&&a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);this.allowedValues.push({items:b,globals:c})}};b.prototype.SuggestedValues=function(b,c){if(this.executionPhase===3){if(!this.suggestedValues)this.suggestedValues=[];b&&a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);this.suggestedValues.push({items:b,globals:c})}};b.prototype.ProhibitedValues=function(b,c){if(this.executionPhase===3){if(!this.prohibitedValues)this.prohibitedValues=[];b&&a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);this.prohibitedValues.push({items:b,globals:c})}};b.prototype.Match=function(b,c){if(this.executionPhase===3){if(!this.patterns)this.patterns=[];b&&a.ArrayUtils.flagSorted(b,a.StringUtils.localeIgnoreCaseComparer);this.patterns.push({items:b,globals:c})}};b.prototype.ServerDefault=function(a){if(this.executionPhase===2){this.value=new v(a,this.originalValue);this.serverDefault=true;this.valueLocked=true;this.setByRule=true;this.setByDefaultRule=true}};b.prototype.Computed=function(b){if(this.executionPhase===1)if(!this.valueLocked){var a=this.workItem.computeFieldValue(this.field,b);if(a&&a.success){this.value=a.value;this.valueLocked=true;this.setByRule=true;this.setByComputedRule=true}}};b.prototype.Trigger=function(b){var a=this;if(this.executionPhase===3)if(b){if(!this.triggerFields){this.triggerFieldMap={};this.triggerFields=[]}$.each(b,function(d,c){var b=c+"";if(!a.triggerFieldMap.hasOwnProperty(b)){a.triggerFieldMap[b]=true;a.triggerFields.push(c)}})}};b.prototype.validate=function(){var c,g,d,e,l,k,h,a=this.field,m,n,i,j;a._status=0;h=a.workItem.store;i=f.convertValueToInternal(h,this.originalValue,a.fieldDefinition.type);l=f.convertValueToInternal(h,this.value,a.fieldDefinition.type);e=l.value;a._status|=l.status;if(this.setByRule){a._setValue(e,this.setByRule);a._status|=128}if(this.setByDefaultRule)a._status|=256;if(this.setByComputedRule)a._status|=512;if(this.readOnly||this.serverDefault||this.empty)a._status|=2;if(this.cannotLoseValue)if(!f.isEmpty(this.originalValue))this.required=true;if(this.required)a._status|=1;d={};d.allowedValues=this.allowedValues;if(this.allowedValues&&this.allowedValues.length>0){a._status|=4;a._status|=8}d.suggestedValues=this.suggestedValues;if(this.suggestedValues&&this.suggestedValues.length>0){a._status|=4;a._status&=-9}d.prohibitedValues=this.prohibitedValues;d.allowExistingValue=this.allowExistingValue;if(!b.compareFieldLists(a._lists,d)){a._lists=d;a._allowedValues=null}if(this.allowExistingValue)a._status|=64;if(this.patterns&&this.patterns.length>0){j=f.unionLists(h,this.patterns[0].items,this.patterns[0].globals);for(c=1,g=this.patterns.length;c<g;c++)j=f.intersect(j,f.unionLists(h,this.patterns[c].items,this.patterns[c].globals),true)}a.patterns=j;if(j)a._status|=16;if(f.isEmpty(e)){if(!this.empty){if(a.isRequired()){a._status|=1;a._status|=524288;return}if(typeof this.otherFieldCheck!=="undefined")if(f.isEmpty(this.otherField)){if(this.otherFieldCheck==="not-same-as"){a._status|=1;a._status|=268435456;return}}else if(this.otherFieldCheck==="same-as"){a._status|=1;a._status|=134217728;return}}return}if(this.empty){a._status&=-3;a._status|=1048576;return}if(this.readOnly&&!this.serverDefault&&!this.setByDefaultRule&&!f.compareValues(e,i.value)){a._status|=16777216;return}if(typeof this.otherFieldCheck!=="undefined")if(f.compareValues(e,this.otherField)){if(this.otherFieldCheck==="not-same-as"){a._status|=134217728;return}}else if(this.otherFieldCheck==="same-as"){a._status|=268435456;return}if(this.frozen)if(!f.isEmpty(i.value))if(!f.compareValues(e,i.value)){a._status|=67108864;return}if(a.fieldDefinition.type===8){if(a.fieldDefinition.id===-7)n=this.workItem.project.findAreaNodeByPath(e);else n=this.workItem.project.findIterationNodeByPath(e);if(!n){a._status|=32768;return}}if(!(this.serverDefault||e instanceof v)){k=e===undefined||e===null?"":""+e;if(a.patterns){m=false;for(c=0,g=a.patterns.length;c<g;c++)if(f.isMatch(a.patterns[c],k)){m=true;break}if(!m){a._status|=2097152;return}}if(d.prohibitedValues)for(c=0,g=d.prohibitedValues.length;c<g;c++)if(f.inList(h,k,d.prohibitedValues[c].items,d.prohibitedValues[c].globals,true)){a._status|=4194304;return}if(this.allowExistingValue&&!f.isEmpty(i.value))if(f.compareValues(e,i.value))return;if(d.allowedValues)for(c=0,g=d.allowedValues.length;c<g;c++)if(!f.inList(h,k,d.allowedValues[c].items,d.allowedValues[c].globals,true)){a._status|=4194304;return}}a.customValidators};b.prototype._getFieldValue=function(b,a){return b===this.fieldId?a?this.originalValue:this.value:this.workItem._getFieldValueById(b,a)};b.prototype._getValueFrom=function(b,a){switch(b){case 64:return new Date;case 32:return this.workItem.store.getCurrentUser();case 16:return this._getFieldValue(a,true);case 8:return this._getFieldValue(a,false);case 1:return a;case 2:return this.value;case 4:return this.originalValue;default:return a}};b.prototype._getAllowedValues=function(a){return this.workItem.getField(a).getAllowedValues()};return b}(),Sb=function(){function a(g,c){this.workItem=g;this.fieldRules={};if(c){var b,f;for(b=0,f=c.length;b<f;b++){var e=c[b],d=e.fieldId+"",a=this.fieldRules[d];if(!a)this.fieldRules[d]=a=[];a.push("Block");a.push([e.rules])}}}a.prototype.evaluateFields=function(b){var c={};if(b){var a,d;for(a=0,d=b.length;a<d;a++){var e=b[a];this._evaluateFieldRule(e,c,false)}}return this._evalStateToChangedFields(c)};a.prototype.evaluateField=function(d,b,c){var a={};this._evaluateFieldRule(d,a,b,c);return this._evalStateToChangedFields(a)};a.prototype._evalStateToChangedFields=function(b){var a=[];for(var c in b)b.hasOwnProperty(c)&&a.push(+c);return a};a.prototype._evaluateFieldRule=function(h,a,i,j){var k=this,b=this.workItem.getField(h);if(b){var e=h+"",g=b._getValue();a[e]={state:true,prevValue:j===undefined?g:j};var d=new Pb(h,this.workItem,b,g,b._getValue(true),i||false,a);d.evaluate(this.fieldRules[e]);var c;if(i)c=true;else c=!f.compareValues(g,b._getValue());c&&d.triggerFields&&$.each(d.triggerFields,function(d,c){var b=a[c+""];(!b||!b.state)&&k._evaluateFieldRule(c,a,false)});a[e].state=false}};return a}(),v=function(){function a(b,a){this.type=0;this.type=b;this.value=a}a.prototype.toString=function(){return""+this.value};a.prototype.valueOf=function(){return this.value};return a}();e.ServerDefaultValue=v;var ob,sb,db,xb,eb,nb,kb,lb,Kb,F,S,P,W,T={},G={},ib={};ob=[b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorIn];sb=[b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorGreaterThan,b.OperatorLessThan,b.OperatorGreaterThanOrEqualTo,b.OperatorLessThanOrEqualTo,b.OperatorContains,b.OperatorNotContains,b.OperatorIn,b.OperatorInGroup,b.OperatorNotInGroup];db=[b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorGreaterThan,b.OperatorLessThan,b.OperatorGreaterThanOrEqualTo,b.OperatorLessThanOrEqualTo,b.OperatorContains,b.OperatorNotContains,b.OperatorContainsWords,b.OperatorNotContainsWords,b.OperatorIn,b.OperatorInGroup,b.OperatorNotInGroup];xb=[b.OperatorContains,b.OperatorNotContains];eb=[b.OperatorContainsWords,b.OperatorNotContainsWords];nb=[b.OperatorUnder,b.OperatorNotUnder,b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorIn];kb=[b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorGreaterThan,b.OperatorLessThan,b.OperatorGreaterThanOrEqualTo,b.OperatorLessThanOrEqualTo,b.OperatorIn];lb=[b.OperatorEqualTo,b.OperatorNotEqualTo];Kb=[b.OperatorAnd,b.OperatorOr];W={};$.each([b.OperatorInGroup,b.OperatorNotInGroup],function(b,a){W[a.toUpperCase()]=true});F={};$.each([b.OperatorEqualTo,b.OperatorNotEqualTo,b.OperatorGreaterThan,b.OperatorLessThan,b.OperatorGreaterThanOrEqualTo,b.OperatorLessThanOrEqualTo],function(b,a){F[a.toUpperCase()]=true});S={};$.each([1,3,2,10,12,11],function(b,a){S[a]=true});P={};$.each([1,3,2,10,12,11],function(b,a){P[a]=true});function j(a,b){T[a.toUpperCase()]=b;G[b.toLocaleUpperCase()]=a}function r(a){return T[$.trim(a).toUpperCase()]||a}function Eb(a){return $.map(a,function(a){return r(a)})}function hb(a){return ib.hasOwnProperty($.trim(a).toLocaleUpperCase())}function gb(a){return r(a)+h.WiqlOperators_FieldComparisonQualifier}function yb(c,d){return d?a.StringUtils.startsWith(c,r(b.MacroToday),a.StringUtils.localeIgnoreCaseComparer):a.StringUtils.startsWith(c,b.MacroToday,a.StringUtils.ignoreCaseComparer)}function Gb(a){return b.MacroToday+a.substring(r(b.MacroToday).length)}function Q(c){return a.StringUtils.format(h.WiqlOperators_MacroTodayMinusDaysFormat,r(b.MacroToday),c)}function Qb(c,d){c=$.trim(c);return!a.StringUtils.startsWith(c,b.MacroStart,a.StringUtils.ignoreCaseComparer)?false:yb(c,d)?true:d?G.hasOwnProperty(c.toLocaleUpperCase()):T.hasOwnProperty(c.toUpperCase())}function C(a){var b=G[$.trim(a).toLocaleUpperCase()];if(!b){if(yb(a,true))return Gb(a)}else return b;return a}function rb(a){return W.hasOwnProperty(C(a).toUpperCase())}j(b.OperatorAnd,h.WiqlOperators_And);j(b.OperatorOr,h.WiqlOperators_Or);j(b.OperatorContains,h.WiqlOperators_Contains);j(b.OperatorNotContains,h.WiqlOperators_NotContains);j(b.OperatorContainsWords,h.WiqlOperators_ContainsWords);j(b.OperatorNotContainsWords,h.WiqlOperators_NotContainsWords);j(b.OperatorIn,h.WiqlOperators_In);j(b.OperatorEver,h.WiqlOperators_Ever);j(b.OperatorNotEver,h.WiqlOperators_NotEver);j(b.OperatorUnder,h.WiqlOperators_Under);j(b.OperatorNotUnder,h.WiqlOperators_NotUnder);j(b.OperatorEqualTo,h.WiqlOperators_EqualTo);j(b.OperatorNotEqualTo,h.WiqlOperators_NotEqualTo);j(b.OperatorGreaterThan,h.WiqlOperators_GreaterThan);j(b.OperatorLessThan,h.WiqlOperators_LessThan);j(b.OperatorGreaterThanOrEqualTo,h.WiqlOperators_GreaterThanOrEqualTo);j(b.OperatorLessThanOrEqualTo,h.WiqlOperators_LessThanOrEqualTo);j(b.OperatorInGroup,h.WiqlOperators_InGroup);j(b.OperatorNotInGroup,h.WiqlOperators_NotInGroup);j(b.MacroToday,b.MacroStart+h.WiqlOperators_MacroToday);j(b.MacroMe,b.MacroStart+h.WiqlOperators_MacroMe);j(b.MacroProject,b.MacroStart+h.WiqlOperators_MacroProject);$.each(F,function(a){var b=gb(a);G[b.toLocaleUpperCase()]=a;ib[b.toLocaleUpperCase()]=a});function Jb(a){return a===2||a===25||a===100}function L(a){return"'"+(a||"").replace(/\'/g,"''")+"'"}function Hb(b){return a.DateUtils.format(b,"yyyy-MM-ddT00:00:00.0000000")}var zb=function(d){__extends(c,d);function c(){d.call(this);this.availableOperators={};this.availableFieldValues={}}c.prototype.initializeTfsObject=function(a){d.prototype.initializeTfsObject.call(this,a);this.store=a.getService(o)};c.prototype.getInvariantFieldName=function(a,c){var b;a=$.trim(a);b=this.getField(a);if(b)return b.referenceName;else if(!c)return a;else throw Error.invalidQuerySyntax(g.QueryReferencesFieldThatDoesNotExist,a);};c.prototype.getInvariantFieldValue=function(h,s,c){var t=this,q,j,e,r,m,o,p,n,l,i,d="",f,k;if(c!==null&&c!==undefined){c=$.trim(c);q=c?false:true;if(s===b.OperatorIn){j=[];$.each(c.split(","),function(b,a){a&&j.push(t.getInvariantFieldValue(h,"",a))});d="("+j.join(",")+")"}else if(a.StringUtils.ignoreCaseComparer(h,"System.LinkType")===0){try{l=this.store.findLinkTypeEnd(c)}catch(u){throw Error.invalidQuerySyntax(u.message,c);}d=L(l.immutableName)}else if(q)d="''";else{e=this.getFieldType(null,h);r=a.StringUtils.startsWith(c,b.MacroStart);if(r)if(Qb(c,true))d=C(c);else throw Error.invalidQuerySyntax(a.StringUtils.format(g.QueryFilterInvalidMacro,c),c);else{m=e===3;o=e===2;p=e===10;n=e===12;if(m){f=a.DateUtils.parseDateString(c,undefined,true);if(f===null||isNaN(f))throw Error.invalidQuerySyntax(g.ErrorExpectingDateTime,c);k=f.getFullYear();if(k<1753||k>9999)throw Error.invalidQuerySyntax(g.ErrorDateTimeValueOutOfRange,c);d=L(Hb(f))}else if(o){if(!/^[0-9]+?$/.test(c))throw Error.invalidQuerySyntax(g.ErrorExpectingIntegerValue,c);d=c}else if(p){i=Number(c);if(isNaN(i))throw Error.invalidQuerySyntax(g.ErrorExpectingNumericValue,c);else d=a.NumberUtils.toDecimalLocaleString(i,false,Sys.CultureInfo.InvariantCulture)}else if(n)if(/^true$/i.test(c))d="true";else if(/^false$/i.test(c))d="false";else if(/^[0-9]+?$/.test(c))d=parseInt(c,10)?"true":"false";else throw Error.invalidQuerySyntax(g.ErrorExpectingBooleanValue,c);else d=L(c)}}}return d};c.prototype.processClause=function(a){return this._fieldSupportsAnySyntax(null,a.fieldName)?this._convertFromSpecialAnySyntax(a):a};c.prototype.beginEnsureFields=function(b,a){this.store.beginGetFields(b,a)};c.prototype.beginGetOneHopLinkTypes=function(c,b){var a=this;m(this,this,"oneHopLinkTypes",c,b,function(b,c){a.store.beginGetLinkTypes(function(){b(a.store.getLinkTypeEnds())},c)})};c.prototype.beginGetRecursiveLinkTypes=function(d,c){var b=this;m(this,this,"recursiveLinkTypes",d,c,function(c,d){b.store.beginGetLinkTypes(function(){c($.map(b.store.getLinkTypeEnds(),function(b){if(b.isForwardLink&&a.StringUtils.ignoreCaseComparer(b.linkType.topology,"tree")===0)return b}))},d)})};c.prototype.beginGetQueryableFields=function(c,b){var a=this;m(this,this,"queryableFields",c,b,function(b,c){a.store.beginGetFields(function(c){b(a._prepareQueryableFields(c))},c)})};c.prototype.beginGetAvailableOperators=function(a,b,e){var d=this,c;a=$.trim(a);c=a.toLocaleUpperCase();if(c)m(this,this.availableOperators,c,b,e,function(b,c){d.store.beginGetFields(function(){b(d._prepareAvailableOperators(a))},c)});else $.isFunction(b)&&b.call(this,[])};c.prototype.getField=function(a){return this.store.getFieldDefinition(a)};c.prototype.getFieldType=function(a,b){a=a||(b?this.getField(b):null);return a?a.id===-42?0:a.type:1};c.prototype.beginGetAvailableFieldValues=function(c,d,e,g,f,h){var b=this;d=$.trim(d);if(d){e=$.trim(e);var i=(c?c.id:0)+"|"+d.toLocaleUpperCase()+"|"+e.toLocaleUpperCase()+(g?"|includesPredefined":"");m(this,this.availableFieldValues,i,f,h,function(f,h){b.store.beginGetFields(function(){var i=b.getField(d);if(!i)f([]);else{var j=b.getFieldType(i);if(j===8)c.beginGetNodes(function(){var a=[];if(i.id===-7)a.push(c.getAreaNode(true));else a.push(c.getIterationNode(true));f(a)},h);else if(j===12)f(["True","False"]);else if(hb(e))b.beginGetQueryableFields(function(e){var c=[];$.each(e,function(f,e){a.StringUtils.localeIgnoreCaseComparer(e,d)!==0&&j===b.getFieldType(null,e)&&c.push(e)});f(c)},h);else if(i.id===80){var l=q.TfsTeamProjectCollection.getConnection(x.TfsContext.getDefault()).getService(q.TagService);l.beginQueryTagDefinitions([q.TagService.WORK_ITEM_ARTIFACT_KIND],c.guid,function(b){var a=$.map(b||[],function(a){return a.name});f(a)},function(a){if(a.type==="Microsoft.TeamFoundation.Framework.Server.AccessCheckException")f([]);else h(a)})}else{var k=C(e).toUpperCase();if(rb(k))if(i.id===25)b.store.beginGetWorkItemCategories(c,function(c){var b=[];$.each(c,function(c,a){b.push(a.referenceName)});b.sort(a.StringUtils.localeIgnoreCaseComparer);f(b)},h);else b.store.beginGetGroups(c,true,function(a){f(a)},h);else b.store.beginGetAllowedValues(i.id,function(a){if(g)a=(b._getPredefinedFieldValues(i,j)||[]).concat(a);f(a)},h)}}},h)})}else $.isFunction(f)&&f.call(this,[])};c.prototype.beginGenerateWiql=function(b,f,e,d,c){var a=this;this.store.beginGetLinkTypes(function(){a.beginEnsureFields(function(){var g=[],j,h,k;try{g.push(a._generateSelectClause(f));if(b.mode<=w.WorkItems)g.push("FROM WorkItems");else g.push("FROM WorkItemLinks");j=$.trim(a._generateFilter(b));j&&g.push("WHERE "+j);h=a._generateOrderByClause(e,w.isLinkQuery(b.mode));h&&g.push(h);k=a._getModeClause(b.mode);k&&g.push(k);$.isFunction(d)&&d.call(a,g.join(" "))}catch(l){i(l,c,a)}},c)},c)};c.prototype._fieldSupportsAnySyntax=function(a,b){a=a||(b?this.getField(b):null);return a&&Jb(a.id)};c.prototype._convertFromSpecialAnySyntax=function(c){var d;if(c.value){d=c.value.replace(/[\s'"()]+$/,"").replace(/^[\s'"()]+/,"");if(a.StringUtils.localeIgnoreCaseComparer(d,h.WiqlOperators_Any)===0&&C(c.operator)===b.OperatorEqualTo)return $.extend({},c,{operator:r(b.OperatorNotEqualTo),value:""})}return c};c.prototype._prepareQueryableFields=function(e){var d,f,b,c=[],g=1;for(d=0,f=e.length;d<f;d++){b=e[d];if(b.checkFlag(16)&&b.usages&g&&(b.id!==80||q.FeatureAvailabilityService.isFeatureEnabled(Nb.FeatureAvailabilityFlags.QueryOnTags)))c[c.length]=b.name}c.sort(a.StringUtils.localeIgnoreCaseComparer);return c};c.prototype._prepareAvailableOperators=function(h){var d,e,c,g,f;d=this.getField(h);e=this.getFieldType(d);c=[];switch(e){case 0:a.ArrayUtils.addRange(c,ob);break;case 1:a.ArrayUtils.addRange(c,d&&d.supportsTextQuery()?db:sb);break;case 2:case 3:case 10:a.ArrayUtils.addRange(c,kb);break;case 5:case 7:case 9:a.ArrayUtils.addRange(c,d&&d.supportsTextQuery()?eb:xb);break;case 8:a.ArrayUtils.addRange(c,nb);break;case 12:case 11:a.ArrayUtils.addRange(c,lb)}g=d?d.checkFlag(2):false;!g&&S.hasOwnProperty(e)&&c.push(b.OperatorEver);f=Eb(c);P.hasOwnProperty(e)&&$.each(c,function(b,a){F.hasOwnProperty(a.toUpperCase())&&f.push(gb(a))});return f};c.prototype._isUsernameField=function(a){return a&&(a.id===24||a.id===33||a.id===9||a.id===-1)};c.prototype._getPredefinedFieldValues=function(a,c){switch(c){case 0:return[r(b.MacroProject)];case 3:return[r(b.MacroToday),Q(1),Q(7),Q(30)];case 1:return this._isUsernameField(a)?[r(b.MacroMe)]:this._fieldSupportsAnySyntax(a)?[h.WiqlOperators_Any]:[];default:return[]}};c.prototype._checkOperator=function(d,e,f){var c=true,b;this.beginGetAvailableOperators(d,function(d){c=false;if(d&&d.length)if(!a.ArrayUtils.contains(d,$.trim(e),a.StringUtils.localeIgnoreCaseComparer))b=Error.invalidQueryFilterRow(g.QueryFilterErrorUnrecognizedOperator,f)},function(a){c=false;b=a});cb(!c,"Fields are not ready yet.");if(b)throw b;};c.prototype._generateSelectClause=function(a){return a&&a.length?"SELECT "+$.map(a,function(a){return"["+a+"]"}).join(","):"SELECT [System.Id]"};c.prototype._generateFilterExpression=function(h,e){var d=this,j=[],i=[],c=h.groups,f;if(h.clauses){c=c&&$.map(c,function(a){return $.extend({},a)});f=0;$.each(h.clauses,function(k,e){var i,h;i=$.trim(e.fieldName);if(i){h=$.trim(e.operator);if(!h)throw Error.invalidQueryFilterRow(g.QueryFilterErrorMissingOperator,e.index);if(!$.trim(e.value))if(d.isFieldComparisonOperator(h)||a.StringUtils.ignoreCaseComparer(b.OperatorIn,C(h))===0||d.getFieldType(null,i)===12)throw Error.invalidQueryFilterRow(g.QueryFilterErrorEmptyValue,e.index);j.push($.extend({},e,{index:f,originalIndex:e.index}));f++}else if(c&&c.length)c=D.updateFilterGroups(c,f+1,false)});$.each(j,function(o,a){var b=[],f="",k,h,m,g,l,j,n;o>0&&b.push(d.getInvariantOperator(a.logicalOperator));if(c&&c.length){$.each(c,function(c,b){if(b.start===a.index+1)f+="("});f&&b.push(f)}a=d.processClause(a);k=a.fieldName;h=a.operator;m=a.value;g=d.getInvariantFieldName(k,true);d._checkOperator(k,h,a.originalIndex);l=d.getInvariantOperator(h);if(d.isFieldComparisonOperator(h)){n=d.getInvariantFieldName(m,true);if(e)j="["+e+"].["+n+"]";else j="["+n+"]"}else j=d.getInvariantFieldValue(g,l,m);if(e)b.push("["+e+"].["+g+"]");else b.push("["+g+"]");b.push(l);b.push(j);if(c&&c.length){f="";$.each(c,function(c,b){if(b.end===a.index+1)f+=")"});f&&b.push(f)}i.push(b.join(" "))})}return i.join(" ")};c.prototype._generateLinkFilter=function(c){var d=this,b=[];c&&$.each(c.split(","),function(g,c){var e;c=$.trim(c);if(a.StringUtils.localeIgnoreCaseComparer(c,h.WiqlOperators_Any)===0){b=["[System.Links.LinkType] <> ''"];return false}else try{e=d.store.findLinkTypeEnd(c);b.push("[System.Links.LinkType] = "+L(e.immutableName))}catch(f){throw Error.invalidQuerySyntax(f.message,c);}});return b.join(" OR ")};c.prototype._generateFilter=function(b){var d,e,a,c;if(w.isLinkQuery(b.mode)){if(w.isTreeQuery(b.mode)){d=b.treeTargetFilter;e=b.treeLinkTypes}else{d=b.linkTargetFilter;e=b.linkTypes}c=[];a=$.trim(this._generateFilterExpression(b.sourceFilter,"Source"));a&&c.push("("+a+")");a=$.trim(this._generateLinkFilter(e));a&&c.push("("+a+")");a=$.trim(this._generateFilterExpression(d,"Target"));a&&c.push("("+a+")");return c.join(" AND ")}else return $.trim(this._generateFilterExpression(b.sourceFilter,""))};c.prototype._generateOrderByClause=function(c,d){var b=c;if(!d)if(c&&c.length){b=[];$.each(c,function(d,c){a.StringUtils.ignoreCaseComparer(c.name,"System.Links.LinkType")!==0&&b.push(c)})}return b&&b.length?"ORDER BY "+$.map(b,function(a){return"["+a.name+"]"+(a.descending?" DESC":"")}).join(","):""};c.prototype._getModeClause=function(a){switch(a){case w.LinksMustContain:return"mode(MustContain)";case w.LinksMayContain:return"mode(MayContain)";case w.LinksDoesNotContain:return"mode(DoesNotContain)";case w.LinksRecursive:return"mode(Recursive)";case w.LinksRecursiveReturnMatchingChildren:return"mode(Recursive, ReturnMatchingChildren)"}return""};return c}(q.CollectionLevelTfsService);e.QueryAdapter=zb;l.initClassPrototype(zb,{store:null,queryableFields:null,availableOperators:null,availableFieldValues:null,oneHopLinkTypes:null,recursiveLinkTypes:null,getLocalizedOperator:r,getInvariantOperator:C,isGroupOperator:rb,isFieldComparisonOperator:hb});var Ob=function(){function b(){}b.prototype.beginUpdateWorkItems=function(h,e,f,g,c){var i=this;d.assertParamIsArray(h,"workItemIds");d.assertParamIsArray(e,"changes");d.logTracePoint("TFS.WorkItemTracking.BulkOperation.beginUpdateWorkItems.start");var k=x.TfsContext.getDefault(),m=q.TfsTeamProjectCollection.getConnection(k).getService(o).workItemManager;c=$.extend({pageOperationCallback:function(h){var f,j,o,k=0;o=$.browser&&$.browser.msie&&Number($.browser.version)<=8;var n=function(a){$.each(e,function(c,b){try{f=a.getField(b.fieldName);if(f&&!f.isReadOnly()&&f.isEditable()){if(f.fieldDefinition.id===54)j=b.value+"<BR>"+f.getValue();else j=b.value;f.setValue(j)}}catch(e){d.log(1,"An error occured while bulk-editing a work item: "+l.getErrorMessage(e))}})},m=function(a){c&&c.immediateSave&&i._saveWorkItems(a,e,g,c)};d.logTracePoint("TFS.WorkItemTracking.BulkOperation.beginUpdateWorkItems.page-start");if(o)$.each(h,function(d,c){k++;a.delay(i,b.SCRIPT_RELIEF_TIMEOUT,function(){n(c);k--;k===0&&m(h)})});else{$.each(h,function(b,a){n(a)});m(h)}d.logTracePoint("TFS.WorkItemTracking.BulkOperation.beginUpdateWorkItems.page-complete")}},c);var j=function(){d.logTracePoint("TFS.WorkItemTracking.BulkOperation.beginUpdateWorkItems.complete");$.isFunction(f)&&f()};m.beginGetWorkItems(h,j,g,c)};b.prototype._saveWorkItems=function(b,c,e,a){d.assertParamIsArray(b,"workItems");d.assertParamIsArray(c,"changes");var f=x.TfsContext.getDefault(),g=q.TfsTeamProjectCollection.getConnection(f).getService(o);a&&$.isFunction(a.beforeSave)&&a.beforeSave(b);g.beginSaveWorkItemsBatch(b,function(){a&&$.isFunction(a.afterSave)&&a.afterSave(b,c)},e)};b.SCRIPT_RELIEF_TIMEOUT=10;return b}();e.BulkOperation=Ob;var Lb=function(){function a(){d.fail("WorkItemUtil should not be instantiated. It only contains static helpers.")}a.beginTrySetWorkItemTeamDefaults=function(a,g,j){d.assertParamIsType(a,u,"workItem");var b,f,e;function h(){$.isFunction(g)&&g.call(H,a)}b=a.store.getTfsContext();if(H.contextSupports(b)){f=q.TfsTeamProjectCollection.getConnection(b).getService(H);f.beginGetTeamSettings(function(b){var d=[];if(b.currentIteration)d.push({fieldName:c.CoreFieldRefNames.IterationPath,value:b.currentIteration.friendlyPath});else b.backlogIteration&&d.push({fieldName:c.CoreFieldRefNames.IterationPath,value:b.backlogIteration.friendlyPath});b.teamFieldName&&d.push({fieldName:b.teamFieldName,value:b.teamFieldDefaultValue});$.each(d,function(c,b){e=a.getField(b.fieldName);e&&e.setValue(b.value)});h()},function(a){i(a,j,H)})}else h()};return a}();e.WorkItemTeamUtil=Lb;l.tfsModuleLoaded("TFS.WorkItemTracking",e)});
// SIG // Begin signature block
// SIG // MIIaswYJKoZIhvcNAQcCoIIapDCCGqACAQExCzAJBgUr
// SIG // DgMCGgUAMGcGCisGAQQBgjcCAQSgWTBXMDIGCisGAQQB
// SIG // gjcCAR4wJAIBAQQQEODJBs441BGiowAQS9NQkAIBAAIB
// SIG // AAIBAAIBAAIBADAhMAkGBSsOAwIaBQAEFBzAxPLi2UgN
// SIG // gXG8zXQsx0vXJ9kWoIIVejCCBLswggOjoAMCAQICEzMA
// SIG // AABZ1nPNUY7wIsUAAAAAAFkwDQYJKoZIhvcNAQEFBQAw
// SIG // dzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0
// SIG // b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1p
// SIG // Y3Jvc29mdCBDb3Jwb3JhdGlvbjEhMB8GA1UEAxMYTWlj
// SIG // cm9zb2Z0IFRpbWUtU3RhbXAgUENBMB4XDTE0MDUyMzE3
// SIG // MTMxNVoXDTE1MDgyMzE3MTMxNVowgasxCzAJBgNVBAYT
// SIG // AlVTMQswCQYDVQQIEwJXQTEQMA4GA1UEBxMHUmVkbW9u
// SIG // ZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9u
// SIG // MQ0wCwYDVQQLEwRNT1BSMScwJQYDVQQLEx5uQ2lwaGVy
// SIG // IERTRSBFU046RjUyOC0zNzc3LThBNzYxJTAjBgNVBAMT
// SIG // HE1pY3Jvc29mdCBUaW1lLVN0YW1wIFNlcnZpY2UwggEi
// SIG // MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDGbE7P
// SIG // aFP974De6IvEsfB+B84ePOwMjDWHTOlROry2sJZ3Qvr/
// SIG // PM/h2uKJ+m5CAJlbFt0JZDjiUvvfjvqToz27h49uuIfJ
// SIG // 0GBPz5yCkW2RG3IQs9hDfFlKYF3GsFXQJ9vy9r3yIMYi
// SIG // LJ5riy1s6ngEyUvBcAnnth2vmowGP3hw+nbu0iQUdrKu
// SIG // ICiDHKnwSJI/ooX3g8rFUdCVIAN50le8E7VOuLRsVh9T
// SIG // HhW7zzA//TsBzV9yaPfK85lmM6hdIo8dbsraZdIrHCSs
// SIG // n3ypEIqF4m0uXEr9Sbl7QLFTxt9HubMjTiJHHNPBuUl2
// SIG // QnLOkIYOJPXCPLkJNj+oU1xW/l9hAgMBAAGjggEJMIIB
// SIG // BTAdBgNVHQ4EFgQUWygas811DWM9/Zn1mxUCSBrLpqww
// SIG // HwYDVR0jBBgwFoAUIzT42VJGcArtQPt2+7MrsMM1sw8w
// SIG // VAYDVR0fBE0wSzBJoEegRYZDaHR0cDovL2NybC5taWNy
// SIG // b3NvZnQuY29tL3BraS9jcmwvcHJvZHVjdHMvTWljcm9z
// SIG // b2Z0VGltZVN0YW1wUENBLmNybDBYBggrBgEFBQcBAQRM
// SIG // MEowSAYIKwYBBQUHMAKGPGh0dHA6Ly93d3cubWljcm9z
// SIG // b2Z0LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0VGltZVN0
// SIG // YW1wUENBLmNydDATBgNVHSUEDDAKBggrBgEFBQcDCDAN
// SIG // BgkqhkiG9w0BAQUFAAOCAQEAevAN9EVsNJYOd/DiwEIF
// SIG // YfeI03r9iNWn9fd/8gj21f3LynR82wmp39YVB5m/0D6H
// SIG // hGJ7wgaOyoto4j3fnlrFjLKpXP5ZYib11/l4tm60CpBl
// SIG // ZulRCPF8yaO3BDdGxeeCPihc709xpOexJVrlQ1QzCH+k
// SIG // sFUt0YJwSBEgDSaBDu8GJXSrhcPDjOIUX+gFVI+6homq
// SIG // lq6UYiX5r2mICgyxUcQJ77iAfFOQebvpj9BI8GLImfFl
// SIG // NDv3zrX7Zpi5olmZXT6VnxS/NbT7mHIkKQzzugR6gjn7
// SIG // Rs3x4LIWvH0g+Jw5FSWhJi3Wi4G9xr2wnVT+RwtfLU4q
// SIG // 9IfqtQ+1t+2SKTCCBOwwggPUoAMCAQICEzMAAADKbNUy
// SIG // EjXE4VUAAQAAAMowDQYJKoZIhvcNAQEFBQAweTELMAkG
// SIG // A1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAO
// SIG // BgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29m
// SIG // dCBDb3Jwb3JhdGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0
// SIG // IENvZGUgU2lnbmluZyBQQ0EwHhcNMTQwNDIyMTczOTAw
// SIG // WhcNMTUwNzIyMTczOTAwWjCBgzELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjENMAsGA1UECxMETU9QUjEeMBwGA1UEAxMVTWlj
// SIG // cm9zb2Z0IENvcnBvcmF0aW9uMIIBIjANBgkqhkiG9w0B
// SIG // AQEFAAOCAQ8AMIIBCgKCAQEAlnFd7QZG+oTLnVu3Rsew
// SIG // 4bQROQOtsRVzYJzrp7ZuGjw//2XjNPGmpSFeVplsWOSS
// SIG // oQpcwtPcUi8MZZogYUBTMZxsjyF9uvn+E1BSYJU6W7lY
// SIG // pXRhQamU4K0mTkyhl3BJJ158Z8pPHnGERrwdS7biD8XG
// SIG // J8kH5noKpRcAGUxwRTgtgbRQqsVn0fp5vMXMoXKb9CU0
// SIG // mPhU3xI5OBIvpGulmn7HYtHcz+09NPi53zUwuux5Mqnh
// SIG // qaxVTUx/TFbDEwt28Qf5zEes+4jVUqUeKPo9Lc/PhJiG
// SIG // cWURz4XJCUSG4W/nsfysQESlqYsjP4JJndWWWVATWRhz
// SIG // /0MMrSvUfzBAZwIDAQABo4IBYDCCAVwwEwYDVR0lBAww
// SIG // CgYIKwYBBQUHAwMwHQYDVR0OBBYEFB9e4l1QjVaGvko8
// SIG // zwTop4e1y7+DMFEGA1UdEQRKMEikRjBEMQ0wCwYDVQQL
// SIG // EwRNT1BSMTMwMQYDVQQFEyozMTU5NStiNDIxOGYxMy02
// SIG // ZmNhLTQ5MGYtOWM0Ny0zZmM1NTdkZmM0NDAwHwYDVR0j
// SIG // BBgwFoAUyxHoytK0FlgByTcuMxYWuUyaCh8wVgYDVR0f
// SIG // BE8wTTBLoEmgR4ZFaHR0cDovL2NybC5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jcmwvcHJvZHVjdHMvTWljQ29kU2lnUENB
// SIG // XzA4LTMxLTIwMTAuY3JsMFoGCCsGAQUFBwEBBE4wTDBK
// SIG // BggrBgEFBQcwAoY+aHR0cDovL3d3dy5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jZXJ0cy9NaWNDb2RTaWdQQ0FfMDgtMzEt
// SIG // MjAxMC5jcnQwDQYJKoZIhvcNAQEFBQADggEBAHdc69eR
// SIG // Pc29e4PZhamwQ51zfBfJD+0228e1LBte+1QFOoNxQIEJ
// SIG // ordxJl7WfbZsO8mqX10DGCodJ34H6cVlH7XPDbdUxyg4
// SIG // Wojne8EZtlYyuuLMy5Pbr24PXUT11LDvG9VOwa8O7yCb
// SIG // 8uH+J13oxf9h9hnSKAoind/NcIKeGHLYI8x6LEPu/+rA
// SIG // 4OYdqp6XMwBSbwe404hs3qQGNafCU4ZlEXcJjzVZudiG
// SIG // qAD++DF9LPSMBZ3AwdV3cmzpTVkmg/HCsohXkzUAfFAr
// SIG // vFn8/hwpOILT3lKXRSkYTpZbnbpfG6PxJ1DqB5XobTQN
// SIG // OFfcNyg1lTo4nNTtaoVdDiIRXnswggW8MIIDpKADAgEC
// SIG // AgphMyYaAAAAAAAxMA0GCSqGSIb3DQEBBQUAMF8xEzAR
// SIG // BgoJkiaJk/IsZAEZFgNjb20xGTAXBgoJkiaJk/IsZAEZ
// SIG // FgltaWNyb3NvZnQxLTArBgNVBAMTJE1pY3Jvc29mdCBS
// SIG // b290IENlcnRpZmljYXRlIEF1dGhvcml0eTAeFw0xMDA4
// SIG // MzEyMjE5MzJaFw0yMDA4MzEyMjI5MzJaMHkxCzAJBgNV
// SIG // BAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYD
// SIG // VQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQg
// SIG // Q29ycG9yYXRpb24xIzAhBgNVBAMTGk1pY3Jvc29mdCBD
// SIG // b2RlIFNpZ25pbmcgUENBMIIBIjANBgkqhkiG9w0BAQEF
// SIG // AAOCAQ8AMIIBCgKCAQEAsnJZXBkwZL8dmmAgIEKZdlNs
// SIG // PhvWb8zL8epr/pcWEODfOnSDGrcvoDLs/97CQk4j1XIA
// SIG // 2zVXConKriBJ9PBorE1LjaW9eUtxm0cH2v0l3511iM+q
// SIG // c0R/14Hb873yNqTJXEXcr6094CholxqnpXJzVvEXlOT9
// SIG // NZRyoNZ2Xx53RYOFOBbQc1sFumdSjaWyaS/aGQv+knQp
// SIG // 4nYvVN0UMFn40o1i/cvJX0YxULknE+RAMM9yKRAoIsc3
// SIG // Tj2gMj2QzaE4BoVcTlaCKCoFMrdL109j59ItYvFFPees
// SIG // CAD2RqGe0VuMJlPoeqpK8kbPNzw4nrR3XKUXno3LEY9W
// SIG // PMGsCV8D0wIDAQABo4IBXjCCAVowDwYDVR0TAQH/BAUw
// SIG // AwEB/zAdBgNVHQ4EFgQUyxHoytK0FlgByTcuMxYWuUya
// SIG // Ch8wCwYDVR0PBAQDAgGGMBIGCSsGAQQBgjcVAQQFAgMB
// SIG // AAEwIwYJKwYBBAGCNxUCBBYEFP3RMU7TJoqV4ZhgO6gx
// SIG // b6Y8vNgtMBkGCSsGAQQBgjcUAgQMHgoAUwB1AGIAQwBB
// SIG // MB8GA1UdIwQYMBaAFA6sgmBAVieX5SUT/CrhClOVWeSk
// SIG // MFAGA1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwubWlj
// SIG // cm9zb2Z0LmNvbS9wa2kvY3JsL3Byb2R1Y3RzL21pY3Jv
// SIG // c29mdHJvb3RjZXJ0LmNybDBUBggrBgEFBQcBAQRIMEYw
// SIG // RAYIKwYBBQUHMAKGOGh0dHA6Ly93d3cubWljcm9zb2Z0
// SIG // LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0Um9vdENlcnQu
// SIG // Y3J0MA0GCSqGSIb3DQEBBQUAA4ICAQBZOT5/Jkav629A
// SIG // sTK1ausOL26oSffrX3XtTDst10OtC/7L6S0xoyPMfFCY
// SIG // gCFdrD0vTLqiqFac43C7uLT4ebVJcvc+6kF/yuEMF2nL
// SIG // pZwgLfoLUMRWzS3jStK8cOeoDaIDpVbguIpLV/KVQpzx
// SIG // 8+/u44YfNDy4VprwUyOFKqSCHJPilAcd8uJO+IyhyugT
// SIG // pZFOyBvSj3KVKnFtmxr4HPBT1mfMIv9cHc2ijL0nsnlj
// SIG // VkSiUc356aNYVt2bAkVEL1/02q7UgjJu/KSVE+Traeep
// SIG // oiy+yCsQDmWOmdv1ovoSJgllOJTxeh9Ku9HhVujQeJYY
// SIG // XMk1Fl/dkx1Jji2+rTREHO4QFRoAXd01WyHOmMcJ7oUO
// SIG // jE9tDhNOPXwpSJxy0fNsysHscKNXkld9lI2gG0gDWvfP
// SIG // o2cKdKU27S0vF8jmcjcS9G+xPGeC+VKyjTMWZR4Oit0Q
// SIG // 3mT0b85G1NMX6XnEBLTT+yzfH4qerAr7EydAreT54al/
// SIG // RrsHYEdlYEBOsELsTu2zdnnYCjQJbRyAMR/iDlTd5aH7
// SIG // 5UcQrWSY/1AWLny/BSF64pVBJ2nDk4+VyY3YmyGuDVyc
// SIG // 8KKuhmiDDGotu3ZrAB2WrfIWe/YWgyS5iM9qqEcxL5rc
// SIG // 43E91wB+YkfRzojJuBj6DnKNwaM9rwJAav9pm5biEKgQ
// SIG // tDdQCNbDPTCCBgcwggPvoAMCAQICCmEWaDQAAAAAABww
// SIG // DQYJKoZIhvcNAQEFBQAwXzETMBEGCgmSJomT8ixkARkW
// SIG // A2NvbTEZMBcGCgmSJomT8ixkARkWCW1pY3Jvc29mdDEt
// SIG // MCsGA1UEAxMkTWljcm9zb2Z0IFJvb3QgQ2VydGlmaWNh
// SIG // dGUgQXV0aG9yaXR5MB4XDTA3MDQwMzEyNTMwOVoXDTIx
// SIG // MDQwMzEzMDMwOVowdzELMAkGA1UEBhMCVVMxEzARBgNV
// SIG // BAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1JlZG1vbmQx
// SIG // HjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlvbjEh
// SIG // MB8GA1UEAxMYTWljcm9zb2Z0IFRpbWUtU3RhbXAgUENB
// SIG // MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
// SIG // n6Fssd/bSJIqfGsuGeG94uPFmVEjUK3O3RhOJA/u0afR
// SIG // TK10MCAR6wfVVJUVSZQbQpKumFwwJtoAa+h7veyJBw/3
// SIG // DgSY8InMH8szJIed8vRnHCz8e+eIHernTqOhwSNTyo36
// SIG // Rc8J0F6v0LBCBKL5pmyTZ9co3EZTsIbQ5ShGLieshk9V
// SIG // UgzkAyz7apCQMG6H81kwnfp+1pez6CGXfvjSE/MIt1Nt
// SIG // UrRFkJ9IAEpHZhEnKWaol+TTBoFKovmEpxFHFAmCn4Tt
// SIG // VXj+AZodUAiFABAwRu233iNGu8QtVJ+vHnhBMXfMm987
// SIG // g5OhYQK1HQ2x/PebsgHOIktU//kFw8IgCwIDAQABo4IB
// SIG // qzCCAacwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU
// SIG // IzT42VJGcArtQPt2+7MrsMM1sw8wCwYDVR0PBAQDAgGG
// SIG // MBAGCSsGAQQBgjcVAQQDAgEAMIGYBgNVHSMEgZAwgY2A
// SIG // FA6sgmBAVieX5SUT/CrhClOVWeSkoWOkYTBfMRMwEQYK
// SIG // CZImiZPyLGQBGRYDY29tMRkwFwYKCZImiZPyLGQBGRYJ
// SIG // bWljcm9zb2Z0MS0wKwYDVQQDEyRNaWNyb3NvZnQgUm9v
// SIG // dCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHmCEHmtFqFKoKWt
// SIG // THNY9AcTLmUwUAYDVR0fBEkwRzBFoEOgQYY/aHR0cDov
// SIG // L2NybC5taWNyb3NvZnQuY29tL3BraS9jcmwvcHJvZHVj
// SIG // dHMvbWljcm9zb2Z0cm9vdGNlcnQuY3JsMFQGCCsGAQUF
// SIG // BwEBBEgwRjBEBggrBgEFBQcwAoY4aHR0cDovL3d3dy5t
// SIG // aWNyb3NvZnQuY29tL3BraS9jZXJ0cy9NaWNyb3NvZnRS
// SIG // b290Q2VydC5jcnQwEwYDVR0lBAwwCgYIKwYBBQUHAwgw
// SIG // DQYJKoZIhvcNAQEFBQADggIBABCXisNcA0Q23em0rXfb
// SIG // znlRTQGxLnRxW20ME6vOvnuPuC7UEqKMbWK4VwLLTiAT
// SIG // UJndekDiV7uvWJoc4R0Bhqy7ePKL0Ow7Ae7ivo8KBciN
// SIG // SOLwUxXdT6uS5OeNatWAweaU8gYvhQPpkSokInD79vzk
// SIG // eJkuDfcH4nC8GE6djmsKcpW4oTmcZy3FUQ7qYlw/FpiL
// SIG // ID/iBxoy+cwxSnYxPStyC8jqcD3/hQoT38IKYY7w17gX
// SIG // 606Lf8U1K16jv+u8fQtCe9RTciHuMMq7eGVcWwEXChQO
// SIG // 0toUmPU8uWZYsy0v5/mFhsxRVuidcJRsrDlM1PZ5v6oY
// SIG // emIp76KbKTQGdxpiyT0ebR+C8AvHLLvPQ7Pl+ex9teOk
// SIG // qHQ1uE7FcSMSJnYLPFKMcVpGQxS8s7OwTWfIn0L/gHkh
// SIG // gJ4VMGboQhJeGsieIiHQQ+kr6bv0SMws1NgygEwmKkgk
// SIG // X1rqVu+m3pmdyjpvvYEndAYR7nYhv5uCwSdUtrFqPYmh
// SIG // dmG0bqETpr+qR/ASb/2KMmyy/t9RyIwjyWa9nR2HEmQC
// SIG // PS2vWY+45CHltbDKY7R4VAXUQS5QrJSwpXirs6CWdRrZ
// SIG // kocTdSIvMqgIbqBbjCW/oO+EyiHW6x5PyZruSeD3AWVv
// SIG // iQt9yGnI5m7qp5fOMSn/DsVbXNhNG6HY+i+ePy5VFmvJ
// SIG // E6P9MYIEpTCCBKECAQEwgZAweTELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0IENvZGUgU2ln
// SIG // bmluZyBQQ0ECEzMAAADKbNUyEjXE4VUAAQAAAMowCQYF
// SIG // Kw4DAhoFAKCBvjAZBgkqhkiG9w0BCQMxDAYKKwYBBAGC
// SIG // NwIBBDAcBgorBgEEAYI3AgELMQ4wDAYKKwYBBAGCNwIB
// SIG // FTAjBgkqhkiG9w0BCQQxFgQUbaBKgFuFp0u39P6CHDtX
// SIG // qZ+9j08wXgYKKwYBBAGCNwIBDDFQME6gNIAyAFQARgBT
// SIG // AC4AVwBvAHIAawBJAHQAZQBtAFQAcgBhAGMAawBpAG4A
// SIG // ZwBfADIALgBqAHOhFoAUaHR0cDovL21pY3Jvc29mdC5j
// SIG // b20wDQYJKoZIhvcNAQEBBQAEggEANsMcCUzfgbsK0vdz
// SIG // uEr73sb9k7Pm1qeZ8cP3L784ETFC9ojAdsbh78BQUrDM
// SIG // IU18slODGJHLpo9vi7r/gXKZn+FZ8HaPL1jGPgCpVEpz
// SIG // k3NadKgRqFfYzyMKxMu4aOMZBMSTMygwMKMs0ihNCZCR
// SIG // QcoS/eyd2IHBuRS5Et+O3Uv7nWHBtVcbLiAOyfa8tDUC
// SIG // llBj2/Idzbv1X6d52Ralk5L8CWuh+KyAvpQhqj/BE2SZ
// SIG // OGO3LTqte9yBvrg9lMa4tyOokiL7GeqA0wWU+tR5SkKv
// SIG // FQr1vIcDYB4s2T/dnveYhF9sQAPl1x+luHSAqn07v36V
// SIG // P6B3c8S9NEoGYUR3TaGCAigwggIkBgkqhkiG9w0BCQYx
// SIG // ggIVMIICEQIBATCBjjB3MQswCQYDVQQGEwJVUzETMBEG
// SIG // A1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9u
// SIG // ZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9u
// SIG // MSEwHwYDVQQDExhNaWNyb3NvZnQgVGltZS1TdGFtcCBQ
// SIG // Q0ECEzMAAABZ1nPNUY7wIsUAAAAAAFkwCQYFKw4DAhoF
// SIG // AKBdMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJ
// SIG // KoZIhvcNAQkFMQ8XDTE0MDcyMzA5MTAyMlowIwYJKoZI
// SIG // hvcNAQkEMRYEFIYkvEng7VCEu2TeizUVUS2/UIgbMA0G
// SIG // CSqGSIb3DQEBBQUABIIBAFnJAaIjVMgvFwlzS0MES0EC
// SIG // jLJnNbqg7nnnX4GmXCEUOtt6V2kr3zwnhDRk8CkLMfTO
// SIG // AATc5zHghyczFWmRfb26CzQZ53eDWJNaoqQnrnfVEMTb
// SIG // I5yQrnj7/4vD8JqtDEjww9ERwzkQ51ntN1akL//z96/h
// SIG // UZyKQc+eYfGo1QM7Ygi56hks6S2e9rhpCcFpAGovqDRs
// SIG // dvEhhYw9T67SKYDMMb/nQfGZD2T5zsJ+TJZCN9QghWOu
// SIG // minHCIDiNb+iSH4T1lHjY8v7A2WS00poeaq2lT08YRPm
// SIG // hJlf/oYjoovyi3WkwbqfZDbP4c33peBJnE9QV4+zGR9U
// SIG // 8N4EL/BSr4Y=
// SIG // End signature block
